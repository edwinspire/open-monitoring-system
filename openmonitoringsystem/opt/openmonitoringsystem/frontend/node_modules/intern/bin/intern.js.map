{"version":3,"file":"intern.js","sourceRoot":"","sources":["../../../src/bin/intern.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n\n//\n// This is the runner script used to start Intern in a Node environment.\n//\n\nimport { execSync } from 'child_process';\nimport global from '@dojo/shim/global';\n\nimport { getConfig } from '../lib/node/util';\nimport { getConfigDescription } from '../lib/common/util';\nimport intern from '../index';\nimport * as console from '../lib/common/console';\n\ngetConfig()\n\t.then(({ config, file }) => {\n\t\tif (config.help) {\n\t\t\tprintHelp(config, file);\n\t\t} else if (config.showConfigs) {\n\t\t\tconsole.log(getConfigDescription(config));\n\t\t} else {\n\t\t\tif (!file) {\n\t\t\t\tconsole.warn('No config file was loaded');\n\t\t\t}\n\n\t\t\tintern.configure({ reporters: 'runner' });\n\t\t\tintern.configure(config);\n\t\t\treturn intern.run();\n\t\t}\n\t})\n\t.catch(error => {\n\t\t// If intern wasn't initialized, then this error won't have been\n\t\t// reported\n\t\tif (!error.reported) {\n\t\t\ttry {\n\t\t\t\tconsole.error(intern.formatError(error));\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t}\n\t\tglobal.process.exitCode = 1;\n\t});\n\nfunction printHelp(config: any, file?: string) {\n\tconst $ = (cmd: string) => execSync(cmd, { encoding: 'utf8' }).trim();\n\tconst pkg = require('../package.json');\n\tconst npmVersion = $('npm -v');\n\tconst nodeVersion = $('node -v');\n\tconsole.log(`intern version ${pkg.version}`);\n\tconsole.log(`npm version ${npmVersion}`);\n\tconsole.log(`node version ${nodeVersion}`);\n\tconsole.log();\n\tconsole.log(\n\t\t'Usage: intern [config=<file>] [showConfig|showConfigs] [options]'\n\t);\n\tconsole.log();\n\tconsole.log('  config      - path to a config file');\n\tconsole.log('  showConfig  - show the resolved config');\n\tconsole.log('  showConfigs - show information about configFile');\n\tconsole.log();\n\tconsole.log(\"Options (set with 'option=value' or 'option'):\\n\");\n\n\tconst internConfig = (<any>intern)._config;\n\tconst opts = Object.keys(internConfig)\n\t\t.map(key => {\n\t\t\treturn { name: key, value: JSON.stringify(internConfig[key]) };\n\t\t})\n\t\t.sort((a, b) => {\n\t\t\tif (a.name < b.name) {\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t\tif (a.name > b.name) {\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\treturn 0;\n\t\t});\n\tconst width = opts.reduce((max, opt) => Math.max(opt.name.length, max), 0);\n\n\tfor (const { name, value } of opts) {\n\t\tconst pad = Array(width - name.length + 1).join(' ');\n\t\tconsole.log(`  ${name}${pad} - ${value}`);\n\t}\n\n\tif (file) {\n\t\tconsole.log();\n\t\tconst description = getConfigDescription(config, '  ');\n\t\tif (description) {\n\t\t\tconsole.log(`Using config file '${file}':\\n`);\n\t\t\tconsole.log(description);\n\t\t} else {\n\t\t\tconsole.log(`Using config file '${file}'`);\n\t\t}\n\t}\n}\n"]}