{"version":3,"file":"systemjs.js","sourceRoot":"","sources":["../../../src/loaders/systemjs.ts"],"names":[],"mappings":";AAQA,MAAM,CAAC,cAAc,CAAC,UAAA,OAAO;IAC5B,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,IAAI,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;IAC5D,IAAM,SAAS,GAAQ,OAAO,MAAM,KAAK,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC;IAEvE,EAAE,CAAC,CAAC,MAAM,CAAC,WAAW,KAAK,SAAS,CAAC,CAAC,CAAC;QACtC,MAAM,CAAC,MAAM;aACX,UAAU,CAAC,0CAA0C,CAAC;aACtD,IAAI,CAAC;YACL,MAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;IACL,CAAC;IAAC,IAAI,CAAC,CAAC;QAEP,IAAM,UAAQ,GAAG,SAAS,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;QAC/C,MAAM,CAAC,aAAa,CAAC,UAAQ,CAAC,CAAC;IAChC,CAAC;IAED,uBAAuB,MAAuB;QAC7C,MAAM,CAAC,GAAG,CAAC,uBAAuB,CAAC,CAAC;QAEpC,MAAM,CAAC,GAAG,CAAC,4BAA4B,EAAE,OAAO,CAAC,CAAC;QAClD,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;QAEvB,MAAM,CAAC,UAAC,OAAiB;YACxB,MAAM,CAAC,GAAG,CAAC,gCAAgC,EAAE,OAAO,CAAC,CAAC;YACtD,MAAM,CAAC,OAAO,CAAC,MAAM,CACpB,UAAC,QAAQ,EAAE,KAAK;gBACf,EAAE,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACd,MAAM,CAAC,QAAQ,CAAC,IAAI,CAAC,cAAM,OAAA,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,EAApB,CAAoB,CAAC,CAAC;gBAClD,CAAC;gBACD,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;YAC7B,CAAC,EACI,IAAI,CACT,CAAC;QACH,CAAC,CAAC;IACH,CAAC;AACF,CAAC,CAAC,CAAC","sourcesContent":["/// <reference types=\"systemjs\"/>\n\n/**\n * A loader script for setting up the SystemJS loader.\n *\n * Note that loader scripts must be simple scripts, not modules.\n */\n\nintern.registerLoader(options => {\n\toptions.baseURL = options.baseURL || intern.config.basePath;\n\tconst globalObj: any = typeof window !== 'undefined' ? window : global;\n\n\tif (intern.environment === 'browser') {\n\t\treturn intern\n\t\t\t.loadScript('node_modules/systemjs/dist/system.src.js')\n\t\t\t.then(() => {\n\t\t\t\treturn configAndLoad(SystemJS);\n\t\t\t});\n\t} else {\n\t\t// Use globalObj to get to require to improve testability\n\t\tconst SystemJS = globalObj.require('systemjs');\n\t\treturn configAndLoad(SystemJS);\n\t}\n\n\tfunction configAndLoad(loader: typeof SystemJS) {\n\t\tintern.log('Using SystemJS loader');\n\n\t\tintern.log('Configuring SystemJS with:', options);\n\t\tloader.config(options);\n\n\t\treturn (modules: string[]) => {\n\t\t\tintern.log('Loading modules with SystemJS:', modules);\n\t\t\treturn modules.reduce(\n\t\t\t\t(previous, suite) => {\n\t\t\t\t\tif (previous) {\n\t\t\t\t\t\treturn previous.then(() => loader.import(suite));\n\t\t\t\t\t}\n\t\t\t\t\treturn loader.import(suite);\n\t\t\t\t},\n\t\t\t\t<any>null\n\t\t\t);\n\t\t};\n\t}\n});\n"]}