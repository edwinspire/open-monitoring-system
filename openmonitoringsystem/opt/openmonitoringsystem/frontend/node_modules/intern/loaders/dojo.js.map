{"version":3,"file":"dojo.js","sourceRoot":"","sources":["../../../src/loaders/dojo.ts"],"names":[],"mappings":";AAKA,MAAM,CAAC,cAAc,CAAC,UAAA,OAAO;IAC5B,IAAM,SAAS,GAAQ,OAAO,MAAM,KAAK,WAAW,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC;IAEvE,OAAO,CAAC,OAAO,GAAG,OAAO,CAAC,OAAO,IAAI,MAAM,CAAC,MAAM,CAAC,QAAQ,CAAC;IAC5D,IAAI,CAAC,CAAC,OAAO,IAAI,OAAO,CAAC,EAAE;QAC1B,OAAO,CAAC,KAAK,GAAG,IAAI,CAAC;KACrB;IAED,MAAM,CAAC,GAAG,CAAC,+BAA+B,EAAE,OAAO,CAAC,CAAC;IACrD,SAAS,CAAC,UAAU,GAAG,OAAO,CAAC;IAE/B,OAAO,MAAM,CAAC,UAAU,CAAC,2BAA2B,CAAC,CAAC,IAAI,CAAC;QAC1D,IAAM,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC;QAClC,MAAM,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;QAEhC,OAAO,UAAC,OAAiB;YACxB,IAAI,MAA0B,CAAC;YAE/B,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;gBAClC,MAAM,GAAG,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE,UAAC,KAAY;oBACzC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;oBAC5B,MAAM,CAAC,IAAI,KAAK,CAAC,wBAAsB,KAAK,CAAC,OAAS,CAAC,CAAC,CAAC;gBAC1D,CAAC,CAAC,CAAC;gBAEH,MAAM,CAAC,GAAG,CAAC,kBAAkB,EAAE,OAAO,CAAC,CAAC;gBACxC,OAAO,CAAC,OAAO,EAAE;oBAChB,OAAO,EAAE,CAAC;gBACX,CAAC,CAAC,CAAC;YACJ,CAAC,CAAC,CAAC,IAAI,CACN;gBACC,MAAM,CAAC,MAAM,EAAE,CAAC;YACjB,CAAC,EACD,UAAA,KAAK;gBACJ,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE,CAAC;gBAC1B,MAAM,KAAK,CAAC;YACb,CAAC,CACD,CAAC;QACH,CAAC,CAAC;IACH,CAAC,CAAC,CAAC;AACJ,CAAC,CAAC,CAAC","sourcesContent":["/**\n * A loader script for setting up the Dojo loader.\n *\n * Note that loader scripts must be simple scripts, not modules.\n */\nintern.registerLoader(options => {\n\tconst globalObj: any = typeof window !== 'undefined' ? window : global;\n\n\toptions.baseUrl = options.baseUrl || intern.config.basePath;\n\tif (!('async' in options)) {\n\t\toptions.async = true;\n\t}\n\n\tintern.log('Configuring Dojo loader with:', options);\n\tglobalObj.dojoConfig = options;\n\n\treturn intern.loadScript('node_modules/dojo/dojo.js').then(() => {\n\t\tconst require = globalObj.require;\n\t\tintern.log('Using Dojo loader');\n\n\t\treturn (modules: string[]) => {\n\t\t\tlet handle: { remove(): void };\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\thandle = require.on('error', (error: Error) => {\n\t\t\t\t\tintern.emit('error', error);\n\t\t\t\t\treject(new Error(`Dojo loader error: ${error.message}`));\n\t\t\t\t});\n\n\t\t\t\tintern.log('Loading modules:', modules);\n\t\t\t\trequire(modules, () => {\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t}).then<void>(\n\t\t\t\t() => {\n\t\t\t\t\thandle.remove();\n\t\t\t\t},\n\t\t\t\terror => {\n\t\t\t\t\thandle && handle.remove();\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t);\n\t\t};\n\t});\n});\n"]}