{"version":3,"file":"Channel.js","sourceRoot":"","sources":["../../../src/lib/Channel.ts"],"names":[],"mappings":";;;;;;;;;;;IACA,kDAAoD;IACpD,wCAA0C;IAK1C;QAMC,iBAAY,OAAuB;YAClC,IAAI,CAAC,OAAO,GAAG,OAAO,CAAC;QACxB,CAAC;QAED,6BAAW,GAAX,UAAY,IAAwB,EAAE,IAAS;YAA/C,iBAIC;YAHA,OAAO,IAAI,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC;gBAC9B,OAAO,KAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;YAC9C,CAAC,CAAC,CAAC;QACJ,CAAC;QAES,6BAAW,GAArB;YAAA,iBA2BC;YA1BA,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;gBACvB,IAAI,CAAC,YAAY,GAAG,IAAI,OAAO,CAAO,UAAA,OAAO;oBAC5C,IAAI,KAAI,CAAC,OAAO,CAAC,IAAI,EAAE;wBACtB,IAAI;4BACH,KAAI,CAAC,QAAQ,GAAG,IAAI,mBAAgB,CAAC,KAAI,CAAC,OAAO,CAAC,CAAC;4BACnD,KAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,cAAc,EAAE,MAAM,CAAC,CAAC,IAAI,CACrD;gCACC,OAAO,EAAE,CAAC;4BACX,CAAC,EACD,UAAA,MAAM;gCACL,KAAI,CAAC,QAAQ,GAAG,IAAI,cAAW,CAAC,KAAI,CAAC,OAAO,CAAC,CAAC;gCAC9C,OAAO,EAAE,CAAC;4BACX,CAAC,CACD,CAAC;yBACF;wBAAC,OAAO,KAAK,EAAE;4BACf,KAAI,CAAC,QAAQ,GAAG,IAAI,cAAW,CAAC,KAAI,CAAC,OAAO,CAAC,CAAC;4BAC9C,OAAO,EAAE,CAAC;yBACV;qBACD;yBAAM;wBACN,KAAI,CAAC,QAAQ,GAAG,IAAI,cAAW,CAAC,KAAI,CAAC,OAAO,CAAC,CAAC;wBAC9C,OAAO,EAAE,CAAC;qBACV;gBACF,CAAC,CAAC,CAAC;aACH;YAED,OAAO,IAAI,CAAC,YAAY,CAAC;QAC1B,CAAC;QACF,cAAC;IAAD,CAAC,AA5CD,IA4CC","sourcesContent":["import { RemoteEvents } from './RemoteSuite';\nimport WebSocketChannel from './channels/WebSocket';\nimport HttpChannel from './channels/Http';\nimport BaseChannel, { ChannelOptions } from './channels/Base';\n\nexport { ChannelOptions };\n\nexport default class Channel {\n\treadonly options: ChannelOptions;\n\n\tprivate _channel!: BaseChannel;\n\tprivate _initialized!: Promise<void>;\n\n\tconstructor(options: ChannelOptions) {\n\t\tthis.options = options;\n\t}\n\n\tsendMessage(name: keyof RemoteEvents, data: any) {\n\t\treturn this._initialize().then(() => {\n\t\t\treturn this._channel.sendMessage(name, data);\n\t\t});\n\t}\n\n\tprotected _initialize() {\n\t\tif (!this._initialized) {\n\t\t\tthis._initialized = new Promise<void>(resolve => {\n\t\t\t\tif (this.options.port) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis._channel = new WebSocketChannel(this.options);\n\t\t\t\t\t\tthis._channel.sendMessage('remoteStatus', 'ping').then(\n\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t_error => {\n\t\t\t\t\t\t\t\tthis._channel = new HttpChannel(this.options);\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tthis._channel = new HttpChannel(this.options);\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis._channel = new HttpChannel(this.options);\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this._initialized;\n\t}\n}\n"]}