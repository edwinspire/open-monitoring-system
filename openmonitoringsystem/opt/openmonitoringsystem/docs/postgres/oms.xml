<?xml version="1.0" encoding="UTF-8" ?>
<!-- $Header: /cvsroot/autodoc/autodoc/xml.tmpl,v 1.2 2006/05/16 19:01:27 rbt Exp $ -->

<book id="database.oms" xreflabel="oms database schema"><title>oms Model</title>




  <chapter id="accounts.schema"
           xreflabel="accounts">
    <title>Schema accounts</title>
    <para></para>


      <section id="accounts.table.contacts"
               xreflabel="accounts.contacts">
        <title id="accounts.table.contacts-title">
         Table:
         
         <structname>contacts</structname>
        </title>
 

        <para>
          Usuarios de un abonado (cliente).
No hay como usar idacount como llave foranea porque es una tabla heredada, hay que hacer la comprobacion manualmente.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>contacts</structname>
            </title>


            <varlistentry>
              <term><structfield>idaccountuser</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>










              </para>

              <para>
                ID de la cuenta
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>










              </para>

              <para>
                ID asociado de la lista de contactos
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>appointment</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT 5</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on contacts</title>

          <varlistentry>
            <term>index_account_contacts_appointment</term>
            <listitem><para>appointment) WHERE (appointment = &apos;oams_assigned&apos;::text</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="accounts.table.datas"
               xreflabel="accounts.datas">
        <title id="accounts.table.datas-title">
         Table:
         
         <structname>datas</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>datas</structname>
            </title>


            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>account_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>groups</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccountstate</structfield></term>
              <listitem><para>
                <type>bigint</type>








                      <literal>UNIQUE#1</literal>









                <literal>REFERENCES</literal> <xref linkend="accounts.table.states"/>




              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccounttype</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="accounts.table.types"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>start_date</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>end_date</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddivision</structfield></term>
              <listitem><para>
                <type>bigint</type>








                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="accounts.table.divisions"/>




              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>cost_center</structfield></term>
              <listitem><para>
                <type>character varying(6)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaddress</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.address"/>


              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing accounts.devices via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="accounts.table.devices"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="accounts.table.numbers"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="accounts.table.devices"
               xreflabel="accounts.devices">
        <title id="accounts.table.devices-title">
         Table:
         
         <structname>devices</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>devices</structname>
            </title>


            <varlistentry>
              <term><structfield>iddevice</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>keydev</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="accounts.table.datas"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>device</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>mark</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>model</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>serial_number</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idprovider</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>provider_serial</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>installation_date</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>uninstall_date</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>operability</structfield></term>
              <listitem><para>
                <type>smallint</type>





                <literal>DEFAULT 100</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>eventtypes</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcustodian</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>additional_properties</structfield></term>
              <listitem><para>
                <type>jsonb</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on devices</title>

          <varlistentry>
            <term>fki_fk_devices_idaccount</term>
            <listitem><para>idaccount</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="accounts.table.divisions"
               xreflabel="accounts.divisions">
        <title id="accounts.table.divisions-title">
         Table:
         
         <structname>divisions</structname>
        </title>
 

        <para>
          Division, area, grupo empresarial, etc
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>divisions</structname>
            </title>


            <varlistentry>
              <term><structfield>iddivision</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notes</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing accounts.datas via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="accounts.table.datas"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.groups"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="accounts.table.number-types"
               xreflabel="accounts.number_types">
        <title id="accounts.table.number-types-title">
         Table:
         
         <structname>number_types</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>number_types</structname>
            </title>


            <varlistentry>
              <term><structfield>idaccountnumbertype</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>type</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing accounts.numbers via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="accounts.table.numbers"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="accounts.table.numbers"
               xreflabel="accounts.numbers">
        <title id="accounts.table.numbers-title">
         Table:
         
         <structname>numbers</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>numbers</structname>
            </title>


            <varlistentry>
              <term><structfield>idaccountnumber</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>








                      <literal>UNIQUE#1</literal>









                <literal>REFERENCES</literal> <xref linkend="accounts.table.datas"/>




              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>account</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccountnumbertype</structfield></term>
              <listitem><para>
                <type>bigint</type>








                      <literal>UNIQUE#1</literal>









                <literal>REFERENCES</literal> <xref linkend="accounts.table.number-types"/>




              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on numbers</title>

          <varlistentry>
            <term>fki_fk_account_number_id</term>
            <listitem><para>idaccount</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>fki_fk_account_number_numtype</term>
            <listitem><para>idaccountnumbertype</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="accounts.table.states"
               xreflabel="accounts.states">
        <title id="accounts.table.states-title">
         Table:
         
         <structname>states</structname>
        </title>
 

        <para>
          Lista de posibles estados de un abonado
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>states</structname>
            </title>


            <varlistentry>
              <term><structfield>idaccountstate</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>state</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing accounts.datas via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="accounts.table.datas"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="accounts.table.types"
               xreflabel="accounts.types">
        <title id="accounts.table.types-title">
         Table:
         
         <structname>types</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>types</structname>
            </title>


            <varlistentry>
              <term><structfield>idaccounttype</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>type</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing accounts.datas via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="accounts.table.datas"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="accounts.table.users"
               xreflabel="accounts.users">
        <title id="accounts.table.users-title">
         Table:
         
         <structname>users</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>users</structname>
            </title>


            <varlistentry>
              <term><structfield>idaccountuser</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;account_users_idaccountuser_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>appointment</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT 5</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>account_user</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>account_pwd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>date_start</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>date_end</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>user</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on users</title>

          <varlistentry>
            <term>index_account_user__user_pwd</term>
            <listitem><para>account_user, account_pwd</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>



  </chapter>

  <chapter id="contacts.schema"
           xreflabel="contacts">
    <title>Schema contacts</title>
    <para></para>


      <section id="contacts.table.address"
               xreflabel="contacts.address">
        <title id="contacts.table.address-title">
         Table:
         
         <structname>address</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>address</structname>
            </title>


            <varlistentry>
              <term><structfield>idaddress</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="contacts.table.contacts"
               xreflabel="contacts.contacts">
        <title id="contacts.table.contacts-title">
         Table:
         
         <structname>contacts</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>contacts</structname>
            </title>


            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

              <para>
                Indica si el contacto esta habilitado o no.
Por ejemplo si el contacto debe usarse o no para otras areas de la aplicacion.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>first_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

              <para>
                Nombre del contacto.
Este campo es oblogatorio y no puede ser nulo.

              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>










              </para>

              <para>
                Apellido del contacto.
Este valor puede ser nulo aunque no se recomienda.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>birthday</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>identification</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

              <para>
                Este campo es importante, obligatorio y unico entre todos los registros.
Es un identificador unico entre el resto de contactos.

              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ididtype</structfield></term>
              <listitem><para>
                <type>integer</type>








                      <literal>UNIQUE#1</literal>









                <literal>REFERENCES</literal> <xref linkend="contacts.table.identification-types"/>




              </para>

              <para>
                Tipo de identificacion (Ej.: Cedula, RUC, etc)
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>postal_code</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

              <para>
                Codigo Postal
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>gender</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

              <para>
                Genero:
0 - No establecido
1 - Hombre
2 - Mujer
3 - No aplica
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geox</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

              <para>
                Geolocalizacion X
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geoy</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

              <para>
                Geolocalizacion Y
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>address</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

              <para>
                Direccion del contacto
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>address_ref</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

              <para>
                Puntos referenciales para ubucacion del contacto
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>groups</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

              <para>
                Id de los grupos a los que pertenece este abonado
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing public.admins via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="public.table.admins"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="services.table.datas"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="users.table.devices"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="users.table.users"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="contacts.table.emails"
               xreflabel="contacts.emails">
        <title id="contacts.table.emails-title">
         Table:
         
         <structname>emails</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>emails</structname>
            </title>


            <varlistentry>
              <term><structfield>idemail</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>email</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT 1</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_if_administrator</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

              <para>
                Habilita envio de email de notificacion a esta direccion de corre cuando el email corresponde a un usuario administrador del sistema
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="contacts.table.identification-types"
               xreflabel="contacts.identification_types">
        <title id="contacts.table.identification-types-title">
         Table:
         
         <structname>identification_types</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>identification_types</structname>
            </title>


            <varlistentry>
              <term><structfield>ididtype</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing contacts.contacts via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="contacts.table.contacts"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="contacts.table.phone-providers"
               xreflabel="contacts.phone_providers">
        <title id="contacts.table.phone-providers-title">
         Table:
         
         <structname>phone_providers</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>phone_providers</structname>
            </title>


            <varlistentry>
              <term><structfield>idprovider</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enable</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>provider</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing contacts.phones via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="contacts.table.phones"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="contacts.table.phone-types"
               xreflabel="contacts.phone_types">
        <title id="contacts.table.phone-types-title">
         Table:
         
         <structname>phone_types</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>phone_types</structname>
            </title>


            <varlistentry>
              <term><structfield>idphonetype</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>type</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing contacts.phones via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="contacts.table.phones"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="contacts.table.phones"
               xreflabel="contacts.phones">
        <title id="contacts.table.phones-title">
         Table:
         
         <structname>phones</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>phones</structname>
            </title>


            <varlistentry>
              <term><structfield>idphone</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

              <para>
                Validar si existe este contacto hay que hacerlo manualmente ya que hay una tabla heredada accounts.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idprovider</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="contacts.table.phone-providers"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idphonetype</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="contacts.table.phone-types"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>number</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ext</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT 10</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="contacts.table.xmpps"
               xreflabel="contacts.xmpps">
        <title id="contacts.table.xmpps-title">
         Table:
         
         <structname>xmpps</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>xmpps</structname>
            </title>


            <varlistentry>
              <term><structfield>idxmpp</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>account</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>



  </chapter>

  <chapter id="events.schema"
           xreflabel="events">
    <title>Schema events</title>
    <para>Almacenado y procesado de eventos en este schema</para>


      <section id="events.table.comments"
               xreflabel="events.comments">
        <title id="events.table.comments-title">
         Table:
         
         <structname>comments</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>comments</structname>
            </title>


            <varlistentry>
              <term><structfield>idcomment</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idadmin</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>seconds</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>comment_event</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idstatustype</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idevent</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>originator_idevent</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

              <para>
                idevent originador de este comentario, por ejemplo el idevent que cierra un evento anterior por restauracion.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on comments</title>

          <varlistentry>
            <term>index_ec_idevent</term>
            <listitem><para>idevent</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="events.table.comments-201709"
               xreflabel="events.comments_201709">
        <title id="events.table.comments-201709-title">
         Table:
         
         <structname>comments_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>comments_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idcomment</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;comments_idcomment_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idadmin</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>seconds</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>comment_event</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idstatustype</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idevent</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>originator_idevent</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

              <para>
                idevent originador de este comentario, por ejemplo el idevent que cierra un evento anterior por restauracion.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on comments_201709</title>

          <varlistentry>
            <term>comments_201709_idevent_idx</term>
            <listitem><para>idevent</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="events.table.comments-201710"
               xreflabel="events.comments_201710">
        <title id="events.table.comments-201710-title">
         Table:
         
         <structname>comments_201710</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>comments_201710</structname>
            </title>


            <varlistentry>
              <term><structfield>idcomment</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;events.comments_idcomment_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idadmin</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>seconds</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>comment_event</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idstatustype</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idevent</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>originator_idevent</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

              <para>
                idevent originador de este comentario, por ejemplo el idevent que cierra un evento anterior por restauracion.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on comments_201710</title>

          <varlistentry>
            <term>comments_201710_idevent_idx</term>
            <listitem><para>idevent</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="events.table.comments-attachments"
               xreflabel="events.comments_attachments">
        <title id="events.table.comments-attachments-title">
         Table:
         
         <structname>comments_attachments</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>comments_attachments</structname>
            </title>


            <varlistentry>
              <term><structfield>ideventcommentattach</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idevent</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idattachment</structfield></term>
              <listitem><para>
                <type>integer</type>








                      <literal>UNIQUE#1</literal>









                <literal>REFERENCES</literal> <xref linkend="public.table.attachments"/>




              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="events.table.datas-201710-2-1"
               xreflabel="events.datas_201710_2_1">
        <title id="events.table.datas-201710-2-1-title">
         Table:
         
         <structname>datas_201710_2_1</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>datas_201710_2_1</structname>
            </title>


            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>loaded</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dateevent</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idstatustype</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT &apos;-1&apos;::integer</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ideventtype</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>source</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddevice</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idreceptionmode</structfield></term>
              <listitem><para>
                <type>bigint</type>





                <literal>DEFAULT 1</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>html_text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>details</structfield></term>
              <listitem><para>
                <type>jsonb</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{}&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ip</structfield></term>
              <listitem><para>
                <type>inet</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;0.0.0.0&apos;::inet</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idadmin_assigned</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>creator</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isopen</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on datas_201710_2_1</title>

          <varlistentry>
            <term>index_datas_201710_2_1_isopen</term>
            <listitem><para>isopen) WHERE (isopen = true</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="events.table.datas-201710-2-40"
               xreflabel="events.datas_201710_2_40">
        <title id="events.table.datas-201710-2-40-title">
         Table:
         
         <structname>datas_201710_2_40</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>datas_201710_2_40</structname>
            </title>


            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>loaded</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dateevent</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idstatustype</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT &apos;-1&apos;::integer</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ideventtype</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>source</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddevice</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idreceptionmode</structfield></term>
              <listitem><para>
                <type>bigint</type>





                <literal>DEFAULT 1</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>html_text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>details</structfield></term>
              <listitem><para>
                <type>jsonb</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{}&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ip</structfield></term>
              <listitem><para>
                <type>inet</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;0.0.0.0&apos;::inet</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idadmin_assigned</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>creator</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isopen</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on datas_201710_2_40</title>

          <varlistentry>
            <term>index_datas_201710_2_40_isopen</term>
            <listitem><para>isopen) WHERE (isopen = true</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="events.table.eventtype-groups"
               xreflabel="events.eventtype_groups">
        <title id="events.table.eventtype-groups-title">
         Table:
         
         <structname>eventtype_groups</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>eventtype_groups</structname>
            </title>


            <varlistentry>
              <term><structfield>idgroup</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>group</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing events.eventtypes via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="events.table.eventtypes"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="events.table.eventtypes"
               xreflabel="events.eventtypes">
        <title id="events.table.eventtypes-title">
         Table:
         
         <structname>eventtypes</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>eventtypes</structname>
            </title>


            <varlistentry>
              <term><structfield>ideventtype</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eventtypes_ideventtype_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT 100</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>treatment</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>manual</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>date_editable</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_timeout</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT 5</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_closable</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_img</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_snd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>label</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>code</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_all_users</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>expiration</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT 525600</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>auto_close_on_event_defined</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

              <para>
                Cierra los eventos cuyo ideventtype este en esta matriz seleccionando por idaccount y source (opcional)
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enable_auto_close_on_event_defined</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idgroup</structfield></term>
              <listitem><para>
                <type>integer</type>








                      <literal>UNIQUE#1</literal>









                <literal>REFERENCES</literal> <xref linkend="events.table.eventtype-groups"/>




              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>eventtype_attention_group</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>source_required_to_restore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

              <para>
                Requiere el codigo del source para hacer la restauracion de la alarma.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>as_services</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>structure_name</structfield></term>
              <listitem><para>
                <type>character(20)</type>




                      <literal>UNIQUE#1</literal>










              </para>

              <para>
                Es el nombre que tendr el item en la estructura en C#.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

              <para>
                habilita las notificaciones
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>as_summary</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idrg</structfield></term>
              <listitem><para>
                <type>bigint</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                Grupo de restauracion	

              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="events.table.last-idevent"
               xreflabel="events.last_idevent">
        <title id="events.table.last-idevent-title">
         Table:
         
         <structname>last_idevent</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>last_idevent</structname>
            </title>


            <varlistentry>
              <term><structfield>uuidevent</structfield></term>
              <listitem><para>
                <type>uuid</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idevent</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="events.table.reception-modes"
               xreflabel="events.reception_modes">
        <title id="events.table.reception-modes-title">
         Table:
         
         <structname>reception_modes</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>reception_modes</structname>
            </title>


            <varlistentry>
              <term><structfield>idreceptionmode</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;reception_modes_idreceptionmode_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>mode</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>label_mode</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="events.table.restoration-group"
               xreflabel="events.restoration_group">
        <title id="events.table.restoration-group-title">
         Table:
         
         <structname>restoration_group</structname>
        </title>
 

        <para>
          Permite crear grupos, donde los ideventtype que pertenezcan al grupo se cancelaran entre ellos, es decir si llega un nuevo evento cerrar todos los que al momento esten abierto.

        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>restoration_group</structname>
            </title>


            <varlistentry>
              <term><structfield>idrg</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="events.table.statustypes"
               xreflabel="events.statustypes">
        <title id="events.table.statustypes-title">
         Table:
         
         <structname>statustypes</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>statustypes</structname>
            </title>


            <varlistentry>
              <term><structfield>idstatustype</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;statustypes_ideventstatustype_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>status</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>label_status</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>internal</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isopen</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="events.view.view-eventtypes-to-client"
               xreflabel="events.view_eventtypes_to_client">
        <title id="events.view.view-eventtypes-to-client-title">
         View:
         
         <structname>view_eventtypes_to_client</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_eventtypes_to_client</structname>
            </title>


            <varlistentry>
              <term><structfield>ideventtype</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>label</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_eventtypes_to_client</title>
         <programlisting>
SELECT eventtypes.ideventtype
,
    eventtypes.label
   
FROM events.eventtypes
  
WHERE (eventtypes.manual = true);</programlisting>
        </figure>



      </para>
    </section>

      <section id="events.view.view-groups-events"
               xreflabel="events.view_groups_events">
        <title id="events.view.view-groups-events-title">
         View:
         
         <structname>view_groups_events</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_groups_events</structname>
            </title>


            <varlistentry>
              <term><structfield>idgroup</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>group</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ideventtype</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>structure_name</structfield></term>
              <listitem><para>
                <type>character(20)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>priority</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>treatment</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>manual</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>date_editable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_timeout</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_closable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_img</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_snd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>label</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>code</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notify_all_users</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>auto_close_on_event_defined</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>expiration</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enable_auto_close_on_event_defined</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>eventtype_attention_group</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>source_required_to_restore</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>as_services</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_groups_events</title>
         <programlisting>
SELECT eventtype_groups.idgroup
,
    eventtype_groups.&quot;group&quot;
,
    eventtypes.ideventtype
,
    eventtypes.structure_name
,
    eventtypes.name
,
    eventtypes.priority
,
    eventtypes.treatment
,
    eventtypes.manual
,
    eventtypes.date_editable
,
    eventtypes.notify_timeout
,
    eventtypes.notify_closable
,
    eventtypes.notify_img
,
    eventtypes.notify_snd
,
    eventtypes.label
,
    eventtypes.code
,
    eventtypes.notify_all_users
,
    eventtypes.auto_close_on_event_defined
,
    eventtypes.expiration
,
    eventtypes.enable_auto_close_on_event_defined
,
    eventtypes.enabled
,
    eventtypes.eventtype_attention_group
,
    eventtypes.source_required_to_restore
,
    eventtypes.as_services
,
    eventtypes.note
   
FROM events.eventtype_groups
,
    events.eventtypes
  
WHERE (eventtype_groups.idgroup = eventtypes.idgroup);</programlisting>
        </figure>



      </para>
    </section>



<!-- Function check_before_insert_update() -->
    <section id="events.function.check-before-insert-update"
             xreflabel="eventscheck_before_insert_update()">
      <title id="events.function.check-before-insert-update-title">
       check_before_insert_update()
      </title>
      <titleabbrev id="events.function.check-before-insert-update-titleabbrev">
       check_before_insert_update()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE 
  table_part TEXT DEFAULT &#39;1990&#39;; 
  et events.eventtypes%ROWTYPE; 
  --tbl TEXT DEFAULT &#39;events&#39;; 
  is_valid  BOOLEAN DEFAULT TRUE; 
  iaenabled BOOLEAN DEFAULT TRUE; 
  --constraint_name_table TEXT DEFAULT &#39;_dateevent_check&#39;; 
  --dateevent_year INTEGER DEFAULT 1990; 
  iuuidevent UUID; 
  lastidevent BIGINT;
  iiddivision BIGINT; 
BEGIN 
 
----------------------------------------------------------------------
RAISE notice &#39;4) Vamos a la validacion de ideventtype y relacionados&#39;; 
  IF is_valid THEN -- Obtenemos los datos del tipo de evento 
   
    SELECT * 
    INTO   et 
    FROM   events.eventtypes 
    WHERE  ideventtype = NEW.ideventtype; 
   
   /*
   -- TODO Implementar esta validacion
    -- Obtenemos los datos de la cuenta 
    SELECT enabled 
    INTO   iaenabled 
    FROM   accounts 
    WHERE  idaccount = NEW.idaccount; 
    */
     
    CASE 
    WHEN NOT iaenabled THEN 
      NEW.idstatustype := 9; 
    WHEN et.expiration &lt;= 0 THEN 
      NEW.idstatustype := 2; 
    ELSE 
      RAISE notice &#39;events_before_insert ???? &#39;; 
    END CASE; 

/* -- Por implementar OJO, no deberia poder insertar un evento un idcontac que no existe, o validar contra el idadmin.
    ------------------------------------------------------------------------------------------------------- 
    -- Revisamos si el idcontact que ingresa el evento existe, si es null ponemos a 0 
    IF NOT EXISTS 
      ( 
             SELECT * 
             FROM   contacts 
             WHERE  idcontact = NEW.idcontact) THEN 
      NEW.idcontact := 0; 
    END IF;
    */
     


--SELECT isopen INTO NEW.isopen FROM events.statustypes WHERE idstatustype = NEW.idstatustype;
/*
IF events.fun_idstatustype_is_open(NEW.idstatustype) THEN
	NEW.idadmin_assigned := events.fun_event_auto_assignment_admin(NEW.idaccount, NEW.ideventtype, NEW.idadmin_assigned);
END IF; 
*/

--table_part := events.fun_create_table_partition_datas(NEW.dateevent:: timestamp WITH TIME zone);

NEW.isopen := events.fun_idstatustype_is_open(NEW.idstatustype);

NEW.iddata := md5(NEW.dateevent::TEXT||
                  --NEW.idaccount::TEXT||
                  NEW.iddevice::TEXT||
                  NEW.ideventtype::TEXT||
                  NEW.source::TEXT||
                  NEW.details::TEXT)::UUID;

RAISE notice &#39;10) Empieza la insercion&#39;;

    RETURN NEW; 
    ELSE
    RETURN NULL; 
  END IF; 
  
END;</programlisting>
      </para>
    </section>

<!-- Function comments_after_insert() -->
    <section id="events.function.comments-after-insert"
             xreflabel="eventscomments_after_insert()">
      <title id="events.function.comments-after-insert-title">
       comments_after_insert()
      </title>
      <titleabbrev id="events.function.comments-after-insert-titleabbrev">
       comments_after_insert()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

--iideventstatustype BIGINT;
iisopen BOOLEAN;

BEGIN

--SELECT isopen INTO iisopen  FROM  events.statustypes WHERE idstatustype = NEW.idstatustype;

--UPDATE events.datas SET idstatustype = NEW.idstatustype, isopen = iisopen WHERE idevent = NEW.idevent;




/*
UPDATE sys_table_ts SET ts = now() WHERE table_name = TG_TABLE_NAME;
        IF NOT found THEN
INSERT INTO sys_table_ts (table_name) VALUES (TG_TABLE_NAME);
        END IF;
*/
/*

IF NEW.timeout &lt; 5 THEN
NEW.timeout := 5;
END IF;

IF NEW.img IS NULL OR LENGTH(NEW.img) &lt; 4 THEN
NEW.img := &#39;/notifications_media/img/dialog-error.png&#39;;
END IF;

IF NEW.snd IS NULL OR LENGTH(NEW.snd) &lt; 4 THEN
NEW.snd := &#39;/notifications_media/snd/snd00.mp3&#39;;
END IF;

IF NEW.title IS NULL OR LENGTH(NEW.title) &lt; 3 THEN
NEW.title := &#39;Notification&#39;;
END IF;

IF NEW.body IS NULL OR  LENGTH(NEW.body) &lt; 3 THEN
NEW.body := &#39;Empty notification message&#39;;
END IF;
*/
RETURN NEW;
END;</programlisting>
      </para>
    </section>

<!-- Function comments_before_insert_redirect_partition() -->
    <section id="events.function.comments-before-insert-redirect-partition"
             xreflabel="eventscomments_before_insert_redirect_partition()">
      <title id="events.function.comments-before-insert-redirect-partition-title">
       comments_before_insert_redirect_partition()
      </title>
      <titleabbrev id="events.function.comments-before-insert-redirect-partition-titleabbrev">
       comments_before_insert_redirect_partition()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

table_part TEXT DEFAULT &#39;&#39;;

begin

table_part := events.fun_create_table_partition_comments(NOW():: timestamp without time zone);


IF NOT EXISTS(SELECT trigger_name  FROM information_schema.triggers
                     WHERE event_object_table = table_part
                     AND trigger_name = &#39;on_insert&#39;
                     ) 
                     
                    THEN
                               
EXECUTE &#39;CREATE TRIGGER on_insert
  AFTER INSERT
  ON events.&#39;||table_part||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE events.comments_after_insert();&#39;;                               
                                                          
     END IF ;
     


-- No funcionan llaves foraneas con tablas heredadas
/*
IF NOT EXISTS(SELECT * FROM information_schema.table_constraints WHERE constraint_type = &#39;FOREIGN KEY&#39; AND table_name = table_part AND constraint_name = &#39;fk_&#39;||table_part||&#39;_idadmin&#39;) THEN

EXECUTE &#39;ALTER TABLE &#39;||table_part||&#39;
 ADD CONSTRAINT fk_&#39;||table_part||&#39;_idadmin FOREIGN KEY (idadmin) REFERENCES contacts (idcontact) ON UPDATE CASCADE ON DELETE SET NULL;&#39;;     

END IF;

*/


-- No funcionan llaves foraneas con tablas heredadas
/*
--ALTER TABLE event_comments_201512
--  ADD CONSTRAINT fk_event_comments_idadmin FOREIGN KEY (idadmin) REFERENCES contacts (idcontact) ON UPDATE CASCADE ON DELETE SET NULL;

IF NOT EXISTS(SELECT * FROM information_schema.table_constraints WHERE constraint_type = &#39;FOREIGN KEY&#39; AND table_name = table_part AND constraint_name = &#39;fk_&#39;||table_part||&#39;_idevent&#39;) THEN

EXECUTE &#39;ALTER TABLE &#39;||table_part||&#39;
 ADD CONSTRAINT fk_&#39;||table_part||&#39;_idevent FOREIGN KEY (idevent) REFERENCES events (idevent) ON UPDATE CASCADE ON DELETE CASCADE;&#39;;     

END IF;
*/


--EXECUTE &#39;INSERT INTO &#39; || quote_ident(&#39;events.&#39;||table_part) || &#39; SELECT ($1).*&#39; USING NEW;

    EXECUTE &#39;INSERT INTO events.&#39; 
    || quote_ident(table_part) 
    || &#39; SELECT ($1).*&#39; USING NEW; 

return NULL;
end;</programlisting>
      </para>
    </section>

<!-- Function eventtypes_before_insert_update() -->
    <section id="events.function.eventtypes-before-insert-update"
             xreflabel="eventseventtypes_before_insert_update()">
      <title id="events.function.eventtypes-before-insert-update-title">
       eventtypes_before_insert_update()
      </title>
      <titleabbrev id="events.function.eventtypes-before-insert-update-titleabbrev">
       eventtypes_before_insert_update()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

IF array_length(NEW.auto_close_on_event_defined, 1) &gt; 0 THEN
NEW.auto_close_on_event_defined := ARRAY(SELECT DISTINCT UNNEST(NEW.auto_close_on_event_defined::INTEGER[]) ORDER BY 1);
END IF;


--NEW.groups := ARRAY(SELECT DISTINCT UNNEST(NEW.groups::INTEGER[]) ORDER BY 1);

RETURN NEW;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_create_data_partition(dateevent bigint, ideventtype bigint, iddevice timestamp with time zone) -->
    <section id="events.function.fun-create-data-partition-dateevent-bigint-ideventtype-bigint-iddevice-timestamp-with-time-zone"
             xreflabel="eventsfun_create_data_partition(dateevent bigint, ideventtype bigint, iddevice timestamp with time zone)">
      <title id="events.function.fun-create-data-partition-dateevent-bigint-ideventtype-bigint-iddevice-timestamp-with-time-zone-title">
       fun_create_data_partition(dateevent bigint, ideventtype bigint, iddevice timestamp with time zone)
      </title>
      <titleabbrev id="events.function.fun-create-data-partition-dateevent-bigint-ideventtype-bigint-iddevice-timestamp-with-time-zone-titleabbrev">
       fun_create_data_partition(dateevent bigint, ideventtype bigint, iddevice timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
iiddevice BIGINT DEFAULT 0;
iideventtype BIGINT DEFAULT 0;
BEGIN



/*
 raise exception using
            errcode=&#39;NOBAR&#39;,
            message=&#39;Bar is prohibited&#39;,
            hint=&#39;We do not talk to this guy&#39;;
            */

RETURN events.fun_create_table_partition_datas_iddevice_ideventtype(
	events.fun_create_table_partition_datas_iddevice(
		events.fun_create_table_partition_datas_datetimeevent(
			dateevent
		), 
		iddevice
	), 
	ideventtype
);
END;

</programlisting>
      </para>
    </section>

<!-- Function fun_create_table_partition_comments(idatetimeevent timestamp with time zone) -->
    <section id="events.function.fun-create-table-partition-comments-idatetimeevent-timestamp-with-time-zone"
             xreflabel="eventsfun_create_table_partition_comments(idatetimeevent timestamp with time zone)">
      <title id="events.function.fun-create-table-partition-comments-idatetimeevent-timestamp-with-time-zone-title">
       fun_create_table_partition_comments(idatetimeevent timestamp with time zone)
      </title>
      <titleabbrev id="events.function.fun-create-table-partition-comments-idatetimeevent-timestamp-with-time-zone-titleabbrev">
       fun_create_table_partition_comments(idatetimeevent timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

part TEXT DEFAULT &#39;19000101&#39;;

BEGIN

part := &#39;comments_&#39;||to_char(idatetimeevent, &#39;YYYYMM&#39;)::TEXT;


IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE  table_schema = &#39;events&#39; AND table_name = part LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS events.&#39;||part::TEXT||&#39;(
   LIKE events.comments INCLUDING DEFAULTS INCLUDING CONSTRAINTS INCLUDING INDEXES INCLUDING STORAGE INCLUDING COMMENTS
) 
INHERITS (events.comments)
WITH (
  OIDS = FALSE,
  toast.autovacuum_enabled=true
);&#39;;


-- Trigger: on_changed_table on events

-- DROP TRIGGER on_changed_table ON events;

EXECUTE &#39;CREATE TRIGGER on_changed_table
  AFTER INSERT OR UPDATE OR DELETE
  ON events.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_changed_table();&#39;;

-- Trigger: on_insert_event on events

-- DROP TRIGGER on_insert_event ON events;
/*
EXECUTE &#39;CREATE TRIGGER on_insert_event
  AFTER INSERT
  ON &#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE events_on_insert();&#39;;
  */

-- Trigger: on_update_row on events

-- DROP TRIGGER on_update_row ON events;

EXECUTE &#39;CREATE TRIGGER on_update_row
  BEFORE UPDATE
  ON events.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_update_row_update_ts();&#39;;

END IF;


RETURN part;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_create_table_partition_datas(idatetimeevent timestamp with time zone) -->
    <section id="events.function.fun-create-table-partition-datas-idatetimeevent-timestamp-with-time-zone"
             xreflabel="eventsfun_create_table_partition_datas(idatetimeevent timestamp with time zone)">
      <title id="events.function.fun-create-table-partition-datas-idatetimeevent-timestamp-with-time-zone-title">
       fun_create_table_partition_datas(idatetimeevent timestamp with time zone)
      </title>
      <titleabbrev id="events.function.fun-create-table-partition-datas-idatetimeevent-timestamp-with-time-zone-titleabbrev">
       fun_create_table_partition_datas(idatetimeevent timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

part TEXT DEFAULT &#39;19000101&#39;;
constraint_name_table TEXT DEFAULT &#39;_dt_check&#39;;
inherts_table TEXT DEFAULT &#39;datas&#39;;
datefrom TIMESTAMP WITHOUT TIME ZONE;
dateto TIMESTAMP WITHOUT TIME ZONE;

BEGIN

datefrom := date_trunc(&#39;month&#39;, idatetimeevent);
dateto := date_trunc(&#39;month&#39;, idatetimeevent + &#39;1 month&#39;);

part := inherts_table||&#39;_&#39;||to_char(idatetimeevent, &#39;YYYYMM&#39;)::TEXT;

IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE  table_schema = &#39;events&#39; AND table_name = part LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS events.&#39;||part::TEXT||&#39;
   PARTITION OF events.datas  FOR VALUES FROM (&#39;&#39;&#39;
   ||datefrom::TEXT||&#39;&#39;&#39;) TO (&#39;&#39;&#39;
   ||dateto::TEXT||&#39;&#39;&#39;);
   ALTER TABLE events.&#39;||part::TEXT||&#39;
    ADD CONSTRAINT pk_&#39;||part::TEXT||&#39;_iddata PRIMARY KEY (iddata);
   &#39;;
   
-------------------------
    EXECUTE &#39;CREATE TRIGGER a_check_before_insert 
    AFTER INSERT ON events.&#39; 
    ||part::text 
    ||&#39; FOR EACH ROW EXECUTE PROCEDURE events.on_check_before_insert();&#39;; 
  --END IF ;    

EXECUTE &#39;CREATE TRIGGER a_on_update_row
  BEFORE UPDATE
  ON events.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_update_row();&#39;;
 
 
/* -- VERIFICAR SI ES NECESARIO IMPLEMENTAR --
EXECUTE &#39;CREATE TRIGGER a_get_idstatustype_isopen
  AFTER INSERT OR UPDATE OR DELETE
  ON events.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE events.set_isopen_by_idstatustype();&#39;;
  */

-- Trigger: on_changed_table on events

-- DROP TRIGGER on_changed_table ON events;

/* -- Esto implementar --
EXECUTE &#39;CREATE TRIGGER on_changed_table
  AFTER INSERT OR UPDATE OR DELETE
  ON events.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_changed_table();&#39;;
*/
-- Trigger: on_update_row on events

-- DROP TRIGGER on_update_row ON events;



  --constraint_name_table := part ||&#39;_check_dateevent&#39;; 
  --dateevent_year := Extract(year FROM idatetimeevent); 
/*
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;CHECK&#39; 
           AND    table_name = part 
           AND    constraint_schema = &#39;events&#39; 
           AND    constraint_name = constraint_name_table ) THEN 
    EXECUTE &#39;ALTER TABLE events.&#39; 
    ||part::text 
    ||&#39;   ADD CONSTRAINT &#39; 
    ||constraint_name_table::text 
    ||&#39; CHECK (dateevent &gt;= &#39;&#39;&#39; 
    ||EXTRACT(YEAR FROM idatetimeevent)::text||&#39;/&#39;|| EXTRACT(MONTH FROM idatetimeevent)::text ||&#39;/01 00:00:00&#39;&#39;&#39;
    ||&#39; AND dateevent &lt; &#39;&#39;&#39;
    ||EXTRACT(YEAR FROM idatetimeevent)::text||&#39;/&#39;|| (EXTRACT(MONTH FROM idatetimeevent)+1)::text ||&#39;/01 00:00:00&#39;&#39;&#39;
    ||&#39;);&#39;; 
  END IF ; 
*/
-----------------------------------------------
/*
constraint_name_table := part||&#39;_check_idaccount&#39;;

IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;CHECK&#39; 
           AND    table_name = part 
           AND    constraint_schema = &#39;events&#39; 
           AND    constraint_name =  constraint_name_table) THEN 
    EXECUTE &#39;ALTER TABLE events.&#39; 
    ||part::text 
    ||&#39;   ADD CONSTRAINT &#39; 
    ||constraint_name_table
    ||&#39; CHECK (idaccount = &#39; 
    ||iidaccount::text 
    ||&#39;);&#39;; 
  END IF ; 
*/



  
  /* -- VERIFICAR SI ES NECESARIO IMPLEMENTAR --
  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;FOREIGN KEY&#39; 
           AND    constraint_schema = &#39;events&#39;            
           AND    table_name = part 
           AND    constraint_name = &#39;fk_&#39; 
                         ||part 
                         ||&#39;_idadmin&#39;) THEN 
    EXECUTE &#39;ALTER TABLE events.&#39; 
    ||part 
    ||&#39;  ADD CONSTRAINT fk_&#39; 
    ||part 
    ||&#39;_idadmin FOREIGN KEY (idadmin) REFERENCES admins (idadmin)  ON UPDATE CASCADE ON DELETE CASCADE;&#39;;
  END IF; 
  */
  
  /*
  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;FOREIGN KEY&#39; 
           AND    constraint_schema = &#39;events&#39;                       
           AND    table_name = part 
           AND    constraint_name = &#39;fk_&#39; 
                         ||part 
                         ||&#39;_idreceptionmode&#39;) THEN 
                         */
    EXECUTE &#39;ALTER TABLE events.&#39; 
    ||part 
    ||&#39;  ADD CONSTRAINT fk_&#39; 
    ||part 
    ||&#39;_receptionmode FOREIGN KEY (idreceptionmode) REFERENCES events.reception_modes (idreceptionmode)  ON UPDATE CASCADE ON DELETE SET NULL;&#39;;
 -- END IF; 



  /*
  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;FOREIGN KEY&#39;
	   AND    constraint_schema = &#39;events&#39;                       
           AND    table_name = part 
           AND    constraint_name = &#39;fk_&#39; 
                         ||part 
                         ||&#39;_ideventtype&#39;) THEN 
                         */
    EXECUTE &#39;ALTER TABLE events.&#39; 
    ||part 
    ||&#39;  ADD CONSTRAINT fk_&#39; 
    ||part 
    ||&#39;_ideventtype FOREIGN KEY (ideventtype) REFERENCES events.eventtypes (ideventtype)  ON UPDATE CASCADE ON DELETE SET NULL;&#39;;
  --END IF; 


/*
  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   pg_indexes 
           WHERE  tablename = part 
           AND schemaname = &#39;events&#39;
           AND    indexname = &#39;index_&#39; 
                         ||part 
                         ||&#39;_isopen&#39;) THEN 
    EXECUTE &#39; CREATE INDEX index_&#39; 
    ||part 
    ||&#39;_isopen ON events.&#39; 
    ||part 
    ||&#39; USING btree (idaccount, idequipment, source, ideventtype, idstatustype)
WHERE events.fun_idstatustype_is_open(idstatustype);
  &#39;; 
  END IF; 
*/

/*
------------------------------------
---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   pg_indexes 
           WHERE  tablename = part 
           AND schemaname = &#39;events&#39;
           AND    indexname = &#39;index_&#39; 
                         ||part 
                         ||&#39;_idaccount_idstatustype&#39;) THEN 
    EXECUTE &#39; CREATE INDEX index_&#39; 
    ||part 
    ||&#39;_idaccount_idstatustype ON events.&#39; 
    ||part 
    ||&#39; USING btree (idaccount, idstatustype);&#39;; 
  END IF; 
*/

/*
  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   pg_indexes 
           WHERE  tablename = part 
           AND schemaname = &#39;events&#39;
           AND    indexname = &#39;index_&#39; 
                         ||part 
                         ||&#39;_idaccount_ideventtype&#39;) THEN 
    EXECUTE &#39; CREATE INDEX index_&#39; 
    ||part 
    ||&#39;_idaccount_ideventtype ON events.&#39; 
    ||part 
    ||&#39; USING btree (idaccount, ideventtype);&#39;; 
  END IF; 
*/


/*
  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   pg_indexes 
           WHERE  tablename = part 
           AND schemaname = &#39;events&#39;
           AND    indexname = &#39;index_&#39; 
                         ||part 
                         ||&#39;_uni&#39;) THEN 
    EXECUTE &#39; CREATE UNIQUE INDEX index_&#39; 
    ||part 
    ||&#39;_uni ON events.&#39; 
    ||part 
    ||&#39; USING btree (idaccount, idequipment, ideventtype, source, dateevent, details)&#39;; 
  END IF; 
*/




END IF;


RETURN part;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_create_table_partition_datas_datetimeevent(idatetimeevent timestamp with time zone) -->
    <section id="events.function.fun-create-table-partition-datas-datetimeevent-idatetimeevent-timestamp-with-time-zone"
             xreflabel="eventsfun_create_table_partition_datas_datetimeevent(idatetimeevent timestamp with time zone)">
      <title id="events.function.fun-create-table-partition-datas-datetimeevent-idatetimeevent-timestamp-with-time-zone-title">
       fun_create_table_partition_datas_datetimeevent(idatetimeevent timestamp with time zone)
      </title>
      <titleabbrev id="events.function.fun-create-table-partition-datas-datetimeevent-idatetimeevent-timestamp-with-time-zone-titleabbrev">
       fun_create_table_partition_datas_datetimeevent(idatetimeevent timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

part TEXT DEFAULT &#39;19000101&#39;;
constraint_name_table TEXT DEFAULT &#39;_dt_check&#39;;
inherts_table TEXT DEFAULT &#39;datas&#39;;
datefrom TIMESTAMP WITHOUT TIME ZONE;
dateto TIMESTAMP WITHOUT TIME ZONE;

BEGIN

datefrom := date_trunc(&#39;month&#39;, idatetimeevent);
dateto := date_trunc(&#39;month&#39;, idatetimeevent + &#39;1 month&#39;);

part := inherts_table||&#39;_&#39;||to_char(idatetimeevent, &#39;YYYYMM&#39;)::TEXT;

IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE  table_schema = &#39;events&#39; AND table_name = part LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS events.&#39;||part::TEXT||&#39;
   PARTITION OF events.datas  FOR VALUES FROM (&#39;&#39;&#39;
   ||datefrom::TEXT||&#39;&#39;&#39;) TO (&#39;&#39;&#39;
   ||dateto::TEXT||&#39;&#39;&#39;) PARTITION BY LIST (iddevice);
   &#39;;
   
   

END IF;

RETURN part;
END;
</programlisting>
      </para>
    </section>

<!-- Function fun_create_table_partition_datas_iddevice(iiddevice text, parent_table bigint) -->
    <section id="events.function.fun-create-table-partition-datas-iddevice-iiddevice-text-parent-table-bigint"
             xreflabel="eventsfun_create_table_partition_datas_iddevice(iiddevice text, parent_table bigint)">
      <title id="events.function.fun-create-table-partition-datas-iddevice-iiddevice-text-parent-table-bigint-title">
       fun_create_table_partition_datas_iddevice(iiddevice text, parent_table bigint)
      </title>
      <titleabbrev id="events.function.fun-create-table-partition-datas-iddevice-iiddevice-text-parent-table-bigint-titleabbrev">
       fun_create_table_partition_datas_iddevice(iiddevice text, parent_table bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
DECLARE

part TEXT DEFAULT &#39;19000101&#39;;
--constraint_name_table TEXT DEFAULT &#39;_dt_check&#39;;
--inherts_table TEXT DEFAULT &#39;datas&#39;;
--datefrom TIMESTAMP WITHOUT TIME ZONE;
--dateto TIMESTAMP WITHOUT TIME ZONE;

BEGIN

part := parent_table||&#39;_&#39;||iiddevice::TEXT;

--IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE  table_schema = &#39;events&#39; AND table_name = part LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS events.&#39;||part::TEXT||&#39;
   PARTITION OF events.&#39;|| parent_table ||&#39;  FOR VALUES IN (&#39;||iiddevice::TEXT||&#39;)
    PARTITION BY LIST (ideventtype);
   &#39;;
   
   

--END IF;

RETURN part;
END;
</programlisting>
      </para>
    </section>

<!-- Function fun_create_table_partition_datas_iddevice_ideventtype(ideventtype text, parent_table bigint) -->
    <section id="events.function.fun-create-table-partition-datas-iddevice-ideventtype-ideventtype-text-parent-table-bigint"
             xreflabel="eventsfun_create_table_partition_datas_iddevice_ideventtype(ideventtype text, parent_table bigint)">
      <title id="events.function.fun-create-table-partition-datas-iddevice-ideventtype-ideventtype-text-parent-table-bigint-title">
       fun_create_table_partition_datas_iddevice_ideventtype(ideventtype text, parent_table bigint)
      </title>
      <titleabbrev id="events.function.fun-create-table-partition-datas-iddevice-ideventtype-ideventtype-text-parent-table-bigint-titleabbrev">
       fun_create_table_partition_datas_iddevice_ideventtype(ideventtype text, parent_table bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

part TEXT DEFAULT &#39;19000101&#39;;
--constraint_name_table TEXT DEFAULT &#39;_dt_check&#39;;
--inherts_table TEXT DEFAULT &#39;datas&#39;;
--datefrom TIMESTAMP WITHOUT TIME ZONE;
--dateto TIMESTAMP WITHOUT TIME ZONE;

BEGIN

part := parent_table||&#39;_&#39;||ideventtype::TEXT;

IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE  table_schema = &#39;events&#39; AND table_name = part LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS events.&#39;||part::TEXT||&#39;
   PARTITION OF events.&#39;|| parent_table ||&#39;  FOR VALUES IN (&#39;||ideventtype::TEXT||&#39;);
   
   ALTER TABLE events.&#39;||part::TEXT||&#39;
    ADD CONSTRAINT pk_iddata_&#39;||part::TEXT||&#39; PRIMARY KEY (iddata);
   
   CREATE TRIGGER a_before_insert
    BEFORE INSERT 
    ON events.&#39;||part::TEXT||&#39;
    FOR EACH ROW
    EXECUTE PROCEDURE events.check_before_insert_update(); 
    
        CREATE TRIGGER b_after_dml
    AFTER INSERT OR DELETE OR UPDATE 
    ON events.&#39;||part::TEXT||&#39;
    FOR EACH ROW
    EXECUTE PROCEDURE public.on_cell_change();
    
    CREATE INDEX index_&#39;||part::TEXT||&#39;_isopen
    ON events.&#39;||part::TEXT||&#39; USING btree
    (isopen)
    TABLESPACE pg_default WHERE isopen = true;  
   &#39;;
   
END IF;

RETURN part;
END;
</programlisting>
      </para>
    </section>

<!-- Function fun_event_auto_assignment_admin(admin_assigned bigint, iideventtype bigint, iidaccount bigint) -->
    <section id="events.function.fun-event-auto-assignment-admin-admin-assigned-bigint-iideventtype-bigint-iidaccount-bigint"
             xreflabel="eventsfun_event_auto_assignment_admin(admin_assigned bigint, iideventtype bigint, iidaccount bigint)">
      <title id="events.function.fun-event-auto-assignment-admin-admin-assigned-bigint-iideventtype-bigint-iidaccount-bigint-title">
       fun_event_auto_assignment_admin(admin_assigned bigint, iideventtype bigint, iidaccount bigint)
      </title>
      <titleabbrev id="events.function.fun-event-auto-assignment-admin-admin-assigned-bigint-iideventtype-bigint-iidaccount-bigint-titleabbrev">
       fun_event_auto_assignment_admin(admin_assigned bigint, iideventtype bigint, iidaccount bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>bigint</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

R BIGINT;
iiddivision BIGINT;
iisopen boolean DEFAULT FALSE;

BEGIN

IF EXISTS(SELECT * FROM admins WHERE idadmin = admin_assigned) THEN
R := admin_assigned;
ELSE   

-------------------- 
-- TODO - Debe haber un bloque que auto asigne el evento al administrador que sea conveniente si el status esta en 0
-- Buscamos que administradores tienen acceso a la division y al idaccount de la cuenta de este evento
SELECT iddivision INTO iiddivision FROM accounts WHERE idaccount = iidaccount;

SELECT idadmin 
INTO   R 
FROM   admins 
WHERE -- COALESCE(iiddivision, 0) = ANY(divisions) 
--AND  
iidaccount = ANY (idaccounts) limit 1; 

/*
-- Si no se encuentra ningun administrador se asigna al ultimo administrador que se haya conectado al sistema
IF R IS NULL OR R = 0 THEN
SELECT idadmin INTO R FROM admins WHERE idadmin in (SELECT idadmin FROM events.datas WHERE ideventtype = 1000 ORDER BY idevent LIMIT 1) limit 1;
END IF;
*/

END IF;


RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_idstatustype_is_open(id bigint) -->
    <section id="events.function.fun-idstatustype-is-open-id-bigint"
             xreflabel="eventsfun_idstatustype_is_open(id bigint)">
      <title id="events.function.fun-idstatustype-is-open-id-bigint-title">
       fun_idstatustype_is_open(id bigint)
      </title>
      <titleabbrev id="events.function.fun-idstatustype-is-open-id-bigint-titleabbrev">
       fun_idstatustype_is_open(id bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       Devuelve si el idstatustype es open
        <programlisting>DECLARE 
R BOOLEAN DEFAULT FALSE;

BEGIN

SELECT isopen INTO R FROM events.statustypes WHERE idstatustype = id;
RAISE NOTICE &#39;idstatustype %  =&gt; %&#39;, id::TEXT,  R::TEXT;
RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_receiver_json(list_events bigint, validator text, idequipment json) -->
    <section id="events.function.fun-receiver-json-list-events-bigint-validator-text-idequipment-json"
             xreflabel="eventsfun_receiver_json(list_events bigint, validator text, idequipment json)">
      <title id="events.function.fun-receiver-json-list-events-bigint-validator-text-idequipment-json-title">
       fun_receiver_json(list_events bigint, validator text, idequipment json)
      </title>
      <titleabbrev id="events.function.fun-receiver-json-list-events-bigint-validator-text-idequipment-json-titleabbrev">
       fun_receiver_json(list_events bigint, validator text, idequipment json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text[]</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R TEXT[];
e JSON;

BEGIN

FOR e IN SELECT * FROM json_array_elements(list_events) LOOP 


        BEGIN

INSERT INTO events.datas(
            dateevent, ideventtype, description, idequipment, source, details)
VALUES ((e-&gt;&gt;&#39;dateevent&#39;)::timestamptz, (e-&gt;&gt;&#39;ideventtype&#39;)::BIGINT, e-&gt;&gt;&#39;description&#39;::TEXT, idequipment, (e-&gt;&gt;&#39;source&#39;)::UUID, (e-&gt;&gt;&#39;details_json&#39;)::JSONB);

R := array_append(R, (e-&gt;&gt;&#39;idQueue&#39;)::TEXT);

        EXCEPTION WHEN unique_violation THEN
            -- Do nothing, and loop to try the UPDATE again.
            R := array_append(R, (e-&gt;&gt;&#39;idQueue&#39;)::TEXT);
        END;



END LOOP;

RETURN R;
END
</programlisting>
      </para>
    </section>

<!-- Function fun_set_expired_events() -->
    <section id="events.function.fun-set-expired-events"
             xreflabel="eventsfun_set_expired_events()">
      <title id="events.function.fun-set-expired-events-title">
       fun_set_expired_events()
      </title>
      <titleabbrev id="events.function.fun-set-expired-events-titleabbrev">
       fun_set_expired_events()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

events_array BIGINT[];

fun_return INTEGER DEFAULT 0;

--cursor1 CURSOR FOR
--SELECT idevent FROM events.datas ev WHERE events.fun_idstatustype_is_open(ev.idstatustype) AND dateevent &lt; now() - ((SELECT expiration FROM events.eventtypes WHERE ideventtype = ev.ideventtype) * INTERVAL &#39;1 minutes&#39;);
cursor1_row RECORD;
/*
cursor1 CURSOR FOR SELECT * FROM (SELECT idevent, dateevent, ideventtype, (extract(epoch FROM age(now(), dateevent))/60) AS minutes_event,
(SELECT expiration FROM events.eventtypes WHERE ideventtype = ev.ideventtype) as limit_expiration
 FROM events.datas ev WHERE events.fun_idstatustype_is_open(idstatustype)) as v WHERE minutes_event &gt;=  limit_expiration;
    cursor1_row RECORD;
    */

BEGIN

/*
-- Esto previene que se vuelva a ejecutar esta tarea si ya se esta ejecutando.
IF (SELECT count(*) FROM pg_stat_activity where query = &#39;SELECT * FROM events.fun_set_expired_events();&#39;) = 1 THEN

    FOR cursor1_row IN cursor1 LOOP
            -- if cursor1_row.minutes_event &gt;=  cursor1_row.limit_expiration then
        --  PERFORM fun_edit_event_comments(0, 0, now()::timestamp without time zone, 1, &#39;Event expired. Automatically closed by the system.&#39;::text, 5, cursor1_row.idevent::bigint);   

--UPDATE events.datas SET idstatustype = 5 WHERE idevent IN(events_array);
events_array := array_append(events_array, cursor1_row.idevent);
        
INSERT INTO events.comments(
            idadmin, start, seconds, comment_event, idevent)
    VALUES (0, now(), 1, &#39;Event expired. Automatically closed by the system.&#39;, cursor1_row.idevent::bigint);
fun_return := fun_return+1;
  --     end if;  
    END LOOP;

    UPDATE events.datas SET idstatustype = 5 WHERE idevent IN(SELECT unnest(events_array));

ELSE
fun_return := -1;
END IF;
*/


RETURN fun_return;
END;</programlisting>
      </para>
    </section>

<!-- Function funjs_insert_data(event_data json) -->
    <section id="events.function.funjs-insert-data-event-data-json"
             xreflabel="eventsfunjs_insert_data(event_data json)">
      <title id="events.function.funjs-insert-data-event-data-json-title">
       funjs_insert_data(event_data json)
      </title>
      <titleabbrev id="events.function.funjs-insert-data-event-data-json-titleabbrev">
       funjs_insert_data(event_data json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var R = {iddata: &#39;&#39;};

if(event_data.iddevice &amp;&amp; event_data.ideventtype){

try{

var create_partition;

if(event_data.dateevent){
create_partition = plv8.execute(&#39;SELECT events.fun_create_data_partition($1, $2, $3);&#39;, [event_data.iddevice, event_data.ideventtype, event_data.dateevent]);
}else{
create_partition = plv8.execute(&#39;SELECT events.fun_create_data_partition($1, $2);&#39;, [event_data.iddevice, event_data.ideventtype]);
}

var k = Object.keys(event_data);
var v = [];
var vq = [];

k.forEach(function(element, index) {
    v.push(event_data[element]);
    vq.push(&#39;$&#39;+(index+1));
});

var query = &#39;INSERT INTO events.datas (&#39;+k.join(&#39;, &#39;)+&#39;) VALUES (&#39;+vq.join(&#39;, &#39;)+&#39;) RETURNING iddata;&#39;;

plv8.elog(NOTICE, &quot;query = &quot;, query);
 plv8.elog(NOTICE, &quot;values = &quot;, v.toString());
 
var r = plv8.execute(query, v); 

if(r.length &gt; 0){
R.iddata = r[0].iddata;
}

plv8.elog(NOTICE, &quot;r = &quot;, JSON.stringify(R));

}catch(Error){
R.error = {code: 1, error: Error.message};
}

}else{
R.error = {code: 2, error: &#39;No ha definido iddevice o ideventtype&#39;};
}

var r = plv8.execute(&quot;SELECT pg_notify(&#39;event_datas_i&#39;, $1)&quot;, JSON.stringify(R)); 

return R;

</programlisting>
      </para>
    </section>

<!-- Function on_insert() -->
    <section id="events.function.on-insert"
             xreflabel="eventson_insert()">
      <title id="events.function.on-insert-title">
       on_insert()
      </title>
      <titleabbrev id="events.function.on-insert-titleabbrev">
       on_insert()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE 
  ilabel TEXT DEFAULT &#39;&#39;; 
  ibody TEXT DEFAULT &#39;&#39;; 
  ian TEXT DEFAULT &#39;&#39;; 
  iaccount TEXT DEFAULT &#39;&#39;; 
  iaenabled BOOLEAN DEFAULT TRUE; 
  isessionid TEXT DEFAULT &#39;&#39;; 
  iiddivision     BIGINT; 
  idadminassigned BIGINT; 
  iuuidevent UUID; 
  et events.eventtypes%ROWTYPE; 
  array_ideventtypes_closed_for_this_ideventtype BIGINT[]; 
  idevent_for_close_on_restore                   BIGINT DEFAULT 0; 
BEGIN 
  RAISE notice &#39;&gt;&gt;&gt; 1) Inicia Trigger events_on_insert&#39;; 
  RAISE notice &#39;&gt;&gt;&gt; 2)&#39;; 
  -- Obtenemos los datos del tipo de evento 
  SELECT * 
  INTO   et 
  FROM   events.eventtypes 
  WHERE  ideventtype = NEW.ideventtype; 
   
  RAISE notice &#39;&gt;&gt;&gt;&gt; 3)&#39;; 
  -- Obtenemos los datos de la cuenta 
  SELECT account, 
         account_name, 
         enabled, 
         iddivision 
  INTO   iaccount, 
         ian, 
         iaenabled, 
         iiddivision 
  FROM   accounts 
  WHERE  idaccount = NEW.idaccount; 
   
  RAISE notice &#39;&gt;&gt;&gt; 4)&#39;; 
  IF et.notify_all_users THEN 
    isessionid := &#39;all&#39;; 
 -- ELSE 
    -- Obtenemos el sessionid segun el idadmin 
-- TODO porque ya no se debe manejar asi
/*
    SELECT admin_sessionid 
    INTO   isessionid 
    FROM   contacts 
    WHERE  idcontact = NEW.idadmin; 
    */
   
  END IF; 
  RAISE notice &#39;&gt;&gt;&gt;&gt; 5)&#39;; 
  IF iaenabled 
    AND 
    NEW.priority &lt; 21 AND et.notify = TRUE THEN 
    RAISE notice &#39;&gt;&gt;&gt; 6)&#39;; 
    -- Mostramos la notificacion solo si la prioridad es menor o = que 20 
    ilabel := ian 
    ||&#39; [&#39; 
    ||iaccount 
    ||&#39;]&lt;/br&gt;&#39; 
    ||et.label 
    ||&#39;&lt;/br&gt;&#39;; 
    INSERT INTO gui.notification_area 
                ( 
                            urgency, 
                            timeout, 
                            closable, 
                            img, 
                            snd, 
                            title, 
                            BODY, 
                            sessionid 
                ) 
                VALUES 
                ( 
                            NEW.priority, 
                            et.notify_timeout, 
                            et.notify_closable, 
                            et.notify_img, 
                            et.notify_snd, 
                            ilabel, 
                            &#39;&lt;b&gt;&#39; 
                                        ||NEW.dateevent 
                                        ||&#39;&lt;/b&gt;&lt;/br&gt;&#39; 
                                        ||NEW.description, 
                            isessionid 
                ); 
   
  END IF; 


-- Auto cerramos los eventos se se haya programado para ser cerrados por la llegada de este evento
-- 1. Obtenemos la lista de los ideventtypes que sern cerrados por el ideventtype de este evento
IF et.enable_auto_close_on_event_defined THEN 

RAISE notice &#39;&gt;&gt;&gt; 7) enable_auto_close_on_event_defined = TRUE&#39;; 

BEGIN
/*
CREATE TEMP TABLE IF NOT EXISTS  table_events_to_close AS SELECT idevent 
  FROM   events.datas 
  WHERE idaccount = NEW.idaccount 
  AND idequipment = NEW.idequipment 
  AND    (et.source_required_to_restore = false OR source = NEW.source)
  AND ideventtype IN(SELECT (unnest(et.auto_close_on_event_defined)))
  AND events.fun_idstatustype_is_open(idstatustype)
  AND    idevent != NEW.idevent;
  */

SELECT ARRAY(SELECT idevent 
  FROM   events.datas 
  WHERE idaccount = NEW.idaccount 
  AND idequipment = NEW.idequipment 
  AND    (et.source_required_to_restore = false OR source = NEW.source)
  AND ideventtype IN(SELECT (unnest(et.auto_close_on_event_defined)))
  AND events.fun_idstatustype_is_open(idstatustype)
  AND    idevent != NEW.idevent) INTO array_ideventtypes_closed_for_this_ideventtype;


  --RAISE notice &#39;&gt;&gt;&gt; 7) SELECT idevent FROM events.datas WHERE ideventtype = ANY(%) AND idstatustype = 0 AND idaccount = % AND source = % AND idevent != %&#39;, et.auto_close_on_event_defined, NEW.idaccount, NEW.source, NEW.idevent;
  --FOR idevent_for_close_on_restore IN 
  --SELECT idevent FROM table_events_to_close LOOP 


  
  FOREACH idevent_for_close_on_restore IN ARRAY array_ideventtypes_closed_for_this_ideventtype
  LOOP
--idaccount, idequipment, source, ideventtype, idstatustype
   
UPDATE events.datas SET idstatustype = 7 WHERE idevent = idevent_for_close_on_restore;

RAISE notice &#39;&gt;&gt;&gt; 8) Se cierra automaticamente el evento % por restauracion&#39;, idevent_for_close_on_restore; 

  INSERT INTO events.comments 
              ( 
                          comment_event, 
                          idevent, 
                          originator_idevent
              ) 
              VALUES 
              ( 
                          &#39;Event closed for restoring or status changed event&#39;, 
                          idevent_for_close_on_restore, 
                          NEW.idevent
              ); 
              
RAISE notice &#39;&gt;&gt;&gt; 9) Insertado comentario por restauracion&#39;; 




END LOOP; 

END;
END IF; 

RETURN NULL; 
END;</programlisting>
      </para>
    </section>

  </chapter>

  <chapter id="gui.schema"
           xreflabel="gui">
    <title>Schema gui</title>
    <para></para>


      <section id="gui.table.column-interface-properties"
               xreflabel="gui.column_interface_properties">
        <title id="gui.table.column-interface-properties-title">
         Table:
         
         <structname>column_interface_properties</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>column_interface_properties</structname>
            </title>


            <varlistentry>
              <term><structfield>idfield</structfield></term>
              <listitem><para>
                <type>uuid</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>label</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>public</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_visible</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>onform_visible</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_position</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT 999</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_editable</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>onform_editable</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_resizable</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_formatter</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_sortable</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_editor</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>onform_editor</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_editon</structfield></term>
              <listitem><para>
                <type>text</type>





                <literal>DEFAULT &apos;&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_editor_args</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>onform_editor_args</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_render_cell</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="gui.table.column-properties"
               xreflabel="gui.column_properties">
        <title id="gui.table.column-properties-title">
         Table:
         
         <structname>column_properties</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>column_properties</structname>
            </title>


            <varlistentry>
              <term><structfield>hash_num</structfield></term>
              <listitem><para>
                <type>text</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_label</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_width</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_decorator</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_class</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_rendercell</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_formatter</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_classname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>show</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_position</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT 999</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_editable</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_sortable</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_editon</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_resizable</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>field_iconclass</structfield></term>
              <listitem><para>
                <type>text</type>





                <literal>DEFAULT &apos;glyphicon-pencil&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>field_placeholder</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_editor</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_autosave</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_autoselect</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_dismissonenter</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_editor_args</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="gui.table.menus"
               xreflabel="gui.menus">
        <title id="gui.table.menus-title">
         Table:
         
         <structname>menus</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>menus</structname>
            </title>


            <varlistentry>
              <term><structfield>idmenu</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>structure</structfield></term>
              <listitem><para>
                <type>jsonb</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>show</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;label&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>url</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parent</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>type</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>groups</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admins</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameeventonclick</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>appname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="gui.table.notification-area"
               xreflabel="gui.notification_area">
        <title id="gui.table.notification-area-title">
         Table:
         
         <structname>notification_area</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>notification_area</structname>
            </title>


            <varlistentry>
              <term><structfield>idnotify</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>urgency</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT 10</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>timeout</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT 15</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>closable</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>img</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>snd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>title</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>body</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sessionid</structfield></term>
              <listitem><para>
                <type>text</type>





                <literal>DEFAULT &apos;all&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idadmins</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

              <para>
                si esta vacio muestra las notificaciones a todos los usuarios, si contiene datos muestra unicamente a los administradores indicados.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>detail_json</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

              <para>
                Detalle de la notificacion en formato jSON
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="gui.table.tables-view-properties"
               xreflabel="gui.tables_view_properties">
        <title id="gui.table.tables-view-properties-title">
         Table:
         
         <structname>tables_view_properties</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>tables_view_properties</structname>
            </title>


            <varlistentry>
              <term><structfield>title_grid</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>row_selector_dgrid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>add_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>delete_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>export_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_selectionmode</structfield></term>
              <listitem><para>
                <type>text</type>





                <literal>DEFAULT &apos;none&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_allowtextselection</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_deselectonrefresh</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_allowselectall</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname</structfield></term>
              <listitem><para>
                <type>text</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="gui.view.view-columns-properties"
               xreflabel="gui.view_columns_properties">
        <title id="gui.view.view-columns-properties-title">
         View:
         
         <structname>view_columns_properties</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_columns_properties</structname>
            </title>


            <varlistentry>
              <term><structfield>hash_num</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_schema</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>data_type</structfield></term>
              <listitem><para>
                <type>information_schema.character_data</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_label</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_width</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_decorator</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_class</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_rendercell</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_formatter</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_classname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>show</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_position</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_editable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_sortable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_editon</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_resizable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>field_iconclass</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>field_placeholder</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_editor</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_autosave</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_autoselect</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_dismissonenter</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_editor_args</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_columns_properties</title>
         <programlisting>
SELECT view_table_schema.hash_num
,
    view_table_schema.tschema_tname
,
    view_table_schema.table_schema
,
    view_table_schema.table_name
,
    view_table_schema.column_name
,
    view_table_schema.data_type
,
    column_properties.column_label
,
    column_properties.column_width
,
    column_properties.column_decorator
,
    column_properties.column_class
,
    column_properties.dgrid_rendercell
,
    column_properties.dgrid_formatter
,
    column_properties.dgrid_classname
,
    column_properties.show
,
    column_properties.column_position
,
    column_properties.dgrid_editable
,
    column_properties.dgrid_sortable
,
    column_properties.dgrid_editon
,
    column_properties.dgrid_resizable
,
    column_properties.field_iconclass
,
    column_properties.field_placeholder
,
    column_properties.dgrid_editor
,
    column_properties.dgrid_autosave
,
    column_properties.dgrid_autoselect
,
    column_properties.dgrid_dismissonenter
,
    column_properties.dgrid_editor_args
,
    column_properties.footprint_row
   
FROM view_table_schema
,
    gui.column_properties
  
WHERE (view_table_schema.hash_num = column_properties.hash_num);</programlisting>
        </figure>



      </para>
    </section>

      <section id="gui.view.view-structure"
               xreflabel="gui.view_structure">
        <title id="gui.view.view-structure-title">
         View:
         
         <structname>view_structure</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_structure</structname>
            </title>


            <varlistentry>
              <term><structfield>idfield</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname_tcol</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_schema</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>domain_schema</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>domain_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>data_type</structfield></term>
              <listitem><para>
                <type>information_schema.character_data</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>udt_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_default</structfield></term>
              <listitem><para>
                <type>information_schema.character_data</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pk</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_parent</structfield></term>
              <listitem><para>
                <type>name</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>title_grid</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>row_selector_dgrid</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>add_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>delete_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>export_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_selectionmode</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_allowtextselection</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_deselectonrefresh</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_allowselectall</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>label</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>public</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_visible</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>onform_visible</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_position</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_editable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>onform_editable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_resizable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_formatter</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_sortable</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_editor</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>onform_editor_args</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_editor_args</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_editon</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>onform_editor</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ongrid_render_cell</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_structure</title>
         <programlisting>
SELECT view_schema_table_column.idfield
,
    view_schema_table_column.tschema_tname
,
    view_schema_table_column.tschema_tname_tcol
,
    view_schema_table_column.table_schema
,
    view_schema_table_column.table_name
,
    view_schema_table_column.domain_schema
,
    view_schema_table_column.domain_name
,
    view_schema_table_column.column_name
,
    view_schema_table_column.data_type
,
    view_schema_table_column.udt_name
,
    view_schema_table_column.column_default
,
    view_schema_table_column.pk
,
    view_schema_table_column.table_parent
,
    tables_view_properties.title_grid
,
    tables_view_properties.row_selector_dgrid
,
    tables_view_properties.add_button_enabled
,
    tables_view_properties.delete_button_enabled
,
    tables_view_properties.export_button_enabled
,
    tables_view_properties.dgrid_selectionmode
,
    tables_view_properties.dgrid_allowtextselection
,
    tables_view_properties.dgrid_deselectonrefresh
,
    tables_view_properties.dgrid_allowselectall
,
    column_interface_properties.label
,
    column_interface_properties.public
,
    column_interface_properties.ongrid_visible
,
    column_interface_properties.onform_visible
,
    column_interface_properties.ongrid_position
,
    column_interface_properties.ongrid_editable
,
    column_interface_properties.onform_editable
,
    column_interface_properties.ongrid_resizable
,
    column_interface_properties.ongrid_formatter
,
    column_interface_properties.ongrid_sortable
,
    column_interface_properties.ongrid_editor
,
    column_interface_properties.onform_editor_args
,
    column_interface_properties.ongrid_editor_args
,
    column_interface_properties.ongrid_editon
,
    column_interface_properties.onform_editor
,
    column_interface_properties.ongrid_render_cell
   
FROM view_schema_table_column
,
    gui.column_interface_properties
,
    gui.tables_view_properties
  
WHERE (
     (column_interface_properties.idfield = view_schema_table_column.idfield)
   AND (tables_view_properties.tschema_tname = view_schema_table_column.tschema_tname)
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="gui.view.view-table-view-columns-properties"
               xreflabel="gui.view_table_view_columns_properties">
        <title id="gui.view.view-table-view-columns-properties-title">
         View:
         
         <structname>view_table_view_columns_properties</structname>
        </title>
 

        <para>
          Permite ver las propiedades por columnas
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_table_view_columns_properties</structname>
            </title>


            <varlistentry>
              <term><structfield>title_dgrid</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>row_selector_dgrid</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>add_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>delete_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>export_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_selectionmode</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_allowtextselection</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_deselectonrefresh</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_allowselectall</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>columns_properties</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_table_view_columns_properties</title>
         <programlisting>
SELECT vtvp.title_grid AS title_dgrid
,
    vtvp.row_selector_dgrid
,
    vtvp.add_button_enabled
,
    vtvp.delete_button_enabled
,
    vtvp.export_button_enabled
,
    vtvp.dgrid_selectionmode
,
    vtvp.dgrid_allowtextselection
,
    vtvp.dgrid_deselectonrefresh
,
    vtvp.dgrid_allowselectall
,
    vtvp.ts
,
    vtvp.footprint_row
,
    vtvp.tschema_tname
,
    
(
SELECT to_json
     (array_agg
           (vcp.*)
     ) AS to_json
           
  FROM (
      SELECT view_columns_properties.column_name AS field
           ,
                    view_columns_properties.data_type
           ,
                    view_columns_properties.column_label AS label
           ,
                    view_columns_properties.column_width AS width
           ,
                    view_columns_properties.column_decorator AS decorator
           ,
                    view_columns_properties.column_class
           ,
                    view_columns_properties.dgrid_rendercell AS &quot;renderCell&quot;
           ,
                    view_columns_properties.dgrid_formatter AS formatter
           ,
                    view_columns_properties.dgrid_classname AS &quot;className&quot;
           ,
                    view_columns_properties.show
           ,
                    view_columns_properties.column_position
           ,
                    view_columns_properties.dgrid_editable
           ,
                    view_columns_properties.dgrid_sortable AS sortable
           ,
                    view_columns_properties.dgrid_editon AS &quot;editOn&quot;
           ,
                    view_columns_properties.dgrid_resizable
           ,
                    view_columns_properties.field_iconclass
           ,
                    view_columns_properties.field_placeholder
           ,
                    view_columns_properties.dgrid_editor AS editor
           ,
                    view_columns_properties.dgrid_autosave AS &quot;autoSave&quot;
           ,
                    view_columns_properties.dgrid_autoselect AS &quot;autoSelect&quot;
           ,
                    view_columns_properties.dgrid_dismissonenter AS &quot;dismissOnEnter&quot;
           ,
                    view_columns_properties.dgrid_editor_args AS &quot;editorArgs&quot;
                   
        FROM gui.view_columns_properties
                  
       WHERE (view_columns_properties.tschema_tname = vtvp.tschema_tname)
                  
    ORDER BY view_columns_properties.column_position
     ) vcp
) AS columns_properties
   
FROM gui.tables_view_properties vtvp;</programlisting>
        </figure>



      </para>
    </section>

      <section id="gui.view.view-table-view-properties"
               xreflabel="gui.view_table_view_properties">
        <title id="gui.view.view-table-view-properties-title">
         View:
         
         <structname>view_table_view_properties</structname>
        </title>
 

        <para>
          Permite ver las propiedades por tabla
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_table_view_properties</structname>
            </title>


            <varlistentry>
              <term><structfield>tschema_tname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_schema</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>title_dgrid</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>row_selector_dgrid</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>add_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>delete_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>export_button_enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_selectionmode</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_allowtextselection</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_deselectonrefresh</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dgrid_allowselectall</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_table_view_properties</title>
         <programlisting>
SELECT view_table_schema.tschema_tname
,
    view_table_schema.table_schema
,
    view_table_schema.table_name
,
    tables_view_properties.title_grid AS title_dgrid
,
    tables_view_properties.row_selector_dgrid
,
    tables_view_properties.add_button_enabled
,
    tables_view_properties.delete_button_enabled
,
    tables_view_properties.export_button_enabled
,
    tables_view_properties.dgrid_selectionmode
,
    tables_view_properties.dgrid_allowtextselection
,
    tables_view_properties.dgrid_deselectonrefresh
,
    tables_view_properties.dgrid_allowselectall
   
FROM view_table_schema
,
    gui.tables_view_properties
  
WHERE (tables_view_properties.tschema_tname = view_table_schema.tschema_tname);</programlisting>
        </figure>



      </para>
    </section>



<!-- Function _funjs_db_model(schema_table text) -->
    <section id="gui.function.-funjs-db-model-schema-table-text"
             xreflabel="gui_funjs_db_model(schema_table text)">
      <title id="gui.function.-funjs-db-model-schema-table-text-title">
       _funjs_db_model(schema_table text)
      </title>
      <titleabbrev id="gui.function.-funjs-db-model-schema-table-text-titleabbrev">
       _funjs_db_model(schema_table text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>res = [];

var view_structure = &quot; WITH schema_table_column_properties as (SELECT * FROM view_schema_table_column, gui.column_interface_properties, gui.tables_view_properties WHERE column_interface_properties.idfield = view_schema_table_column.idfield AND tables_view_properties.tschema_tname = view_schema_table_column.tschema_tname) &quot;;

if(schema_table &amp;&amp; schema_table.length &gt; 0){
	var plan1 = plv8.prepare(view_structure+&quot; SELECT * FROM schema_table_column_properties WHERE table_parent isnull AND tschema_tname = $1 ORDER BY tschema_tname_tcol, ongrid_position;&quot;);
	res = plan1.execute([schema_table]);
}else{
	var plan2 = plv8.prepare(view_structure+&quot; SELECT * FROM schema_table_column_properties WHERE table_parent isnull ORDER BY tschema_tname_tcol, ongrid_position;&quot;);
	res = plan2.execute([]);
}

var sorted = {};

res.forEach(function(row){

	if(!sorted[row.table_schema]){
		sorted[row.table_schema] = {};
	}

	if(!sorted[row.table_schema][row.table_name]){
		sorted[row.table_schema][row.table_name] = {_Properties_: {title: row.title_grid, row_selector: row.row_selector_dgrid}};
	}

	if(!sorted[row.table_schema][row.table_name][row.column_name]){
		sorted[row.table_schema][row.table_name][row.column_name] = {uuid: row.idfield, udt_name: row.udt_name, column_default: row.column_default, pk: row.pk, label: row.label, public: row.public, ongrid_visible: row.ongrid_visible, ongrid_position: row.ongrid_position, ongrid_editable: row.ongrid_editable, ongrid_formatter: row.ongrid_formatter, ongrid_sortable: row.ongrid_sortable, ongrid_editor: row.ongrid_editor, ongrid_editor: row.ongrid_editor, onform_editor: row.onform_editor, onform_editor_args: row.onform_editor_args, ongrid_editor_args: row.ongrid_editor_args, ongrid_editon: row.ongrid_editon, onform_editor: row.onform_editor, ongrid_sortable: row.ongrid_sortable, ongrid_render_cell: row.ongrid_render_cell};
	}

//if(!sorted[row.table_schema][row.table_name].columns.some(function(col){col.column_name !== row.column_name})){
    //var c = {};
    //c[row.column_name] = {uuid: row.idfield, udt_name: row.udt_name, column_default: row.column_default, pk: row.pk, label: row.label, public: row.public, ongrid_visible: row.ongrid_visible, ongrid_position: row.ongrid_position, ongrid_editable: row.ongrid_editable, ongrid_formatter: row.ongrid_formatter, ongrid_sortable: row.ongrid_sortable, ongrid_editor: row.ongrid_editor, ongrid_editor: row.ongrid_editor, onform_editor: row.onform_editor, onform_editor_args: row.onform_editor_args, ongrid_editor_args: row.ongrid_editor_args, ongrid_editon: row.ongrid_editon, onform_editor: row.onform_editor, ongrid_sortable: row.ongrid_sortable, ongrid_render_cell: row.ongrid_render_cell};
    //sorted[row.table_schema][row.table_name].columns.push(c);            

            /*
            sorted[row.table_schema][row.table_name].columns.push(
              {field_name: row.column_name, uuid: row.idfield, udt_name: row.udt_name, column_default: row.column_default, pk: row.pk, label: row.label, public: row.public, ongrid_visible: row.ongrid_visible, ongrid_position: row.ongrid_position, ongrid_editable: row.ongrid_editable, ongrid_formatter: row.ongrid_formatter, ongrid_sortable: row.ongrid_sortable, ongrid_editor: row.ongrid_editor, ongrid_editor: row.ongrid_editor, onform_editor: row.onform_editor, onform_editor_args: row.onform_editor_args, ongrid_editor_args: row.ongrid_editor_args, ongrid_editon: row.ongrid_editon, onform_editor: row.onform_editor, ongrid_sortable: row.ongrid_sortable, ongrid_render_cell: row.ongrid_render_cell}
            ); 
            */
            
//}

});

/*
[2, 5, 8, 1, 4].some(isBiggerThan10);  // false
*/

/*
res.forEach(function(row){
	sorted[row.table_schema] = [];
});

Object.keys(sorted).forEach(function(id) {
	sorted[id] = res.filter(function(row) {
		return row.table_schema === id;
	})
	.map(function(row) {
		var table = {};
table[row.table_name] = {};
		return table;
	});
});
*/

if(res.length &gt; 0){

	return JSON.stringify([sorted], function(key, value){

		if(typeof value === &quot;string&quot;){
			return value.split(&quot;\n&quot;).join(&#39; &#39;);
		}else if(value === null) {
			return undefined;
		}
		return value;
	})//.replace(/(\&quot;&lt;jsfunction&gt;|&lt;\/jsfunction&gt;\&quot;)/ig,&#39;&#39;);

} else {
	return {};
}

</programlisting>
      </para>
    </section>

<!-- Function _funjs_db_structure(schema_table text) -->
    <section id="gui.function.-funjs-db-structure-schema-table-text"
             xreflabel="gui_funjs_db_structure(schema_table text)">
      <title id="gui.function.-funjs-db-structure-schema-table-text-title">
       _funjs_db_structure(schema_table text)
      </title>
      <titleabbrev id="gui.function.-funjs-db-structure-schema-table-text-titleabbrev">
       _funjs_db_structure(schema_table text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>jsonb</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
res = [];

if(schema_table &amp;&amp; schema_table.length &gt; 0){
var plan1 = plv8.prepare(&quot;SELECT * FROM gui.view_structure WHERE table_parent isnull AND tschema_tname = $1;&quot;);
 res = plan1.execute([schema_table]);
}else{
var plan2 = plv8.prepare(&quot;SELECT * FROM gui.view_structure WHERE table_parent isnull;&quot;);
 res = plan2.execute([]);
}


var sorted = {};

res.forEach(function(row){


if(!sorted[row.table_schema]){
sorted[row.table_schema] = {};
}

if(!sorted[row.table_schema][row.table_name]){
sorted[row.table_schema][row.table_name] = {columns: [], properties: {title: row.title_grid, row_selector: row.row_selector_dgrid}};
}

if(!sorted[row.table_schema][row.table_name].columns.some(function(col){col.column_name !== row.column_name})){
sorted[row.table_schema][row.table_name].columns.push(
{field: row.column_name, uuid: row.idfield, udt_name: row.udt_name, column_default: row.column_default, pk: row.pk, label: row.label, public: row.public, ongrid_visible: row.ongrid_visible, ongrid_position: row.ongrid_position, ongrid_editable: row.ongrid_editable, ongrid_formatter: row.ongrid_formatter, ongrid_sortable: row.ongrid_sortable, ongrid_editor: row.ongrid_editor, ongrid_editor: row.ongrid_editor, onform_editor: row.onform_editor, onform_editor_args: row.onform_editor_args, ongrid_editor_args: row.ongrid_editor_args, ongrid_editon: row.ongrid_editon, onform_editor: row.onform_editor}
);
}



});




/*
[2, 5, 8, 1, 4].some(isBiggerThan10);  // false
*/



/*
res.forEach(function(row){
	sorted[row.table_schema] = [];
});

Object.keys(sorted).forEach(function(id) {
	sorted[id] = res.filter(function(row) {
		return row.table_schema === id;
	})
	.map(function(row) {
		var table = {};
table[row.table_name] = {};
		return table;
	});
});
*/

plv8.elog(INFO, JSON.stringify(sorted));

if(res.length &gt; 0){
return sorted;
}  else{
return {};
}


</programlisting>
      </para>
    </section>

<!-- Function fun_map_tables_columns() -->
    <section id="gui.function.fun-map-tables-columns"
             xreflabel="guifun_map_tables_columns()">
      <title id="gui.function.fun-map-tables-columns-title">
       fun_map_tables_columns()
      </title>
      <titleabbrev id="gui.function.fun-map-tables-columns-titleabbrev">
       fun_map_tables_columns()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

fun_return INTEGER DEFAULT 0;
cursor1 CURSOR FOR SELECT * FROM public.view_schema_table_column where table_name NOT LIKE &#39;%_20%&#39; AND table_name NOT LIKE &#39;%_19%&#39;;
    cursor1_row RECORD;

BEGIN


    FOR cursor1_row IN cursor1 LOOP
  
INSERT INTO gui.column_interface_properties(
            idfield, label)
    VALUES (cursor1_row.idfield, cursor1_row.column_name) ON CONFLICT(idfield) DO NOTHING;-- UPDATE SET data_type = EXCLUDED.data_type, udt_name = EXCLUDED.udt_name;

INSERT INTO gui.tables_view_properties(
            tschema_tname)
    VALUES (cursor1_row.tschema_tname)  ON CONFLICT(tschema_tname) DO NOTHING; 

fun_return := fun_return+1;

    END LOOP;

-- Hacemos algunas actualizacion con valores de fabrica
   UPDATE gui.column_interface_properties SET ongrid_formatter = &#39;&lt;jsfunction&gt;function (data) { return new Date(data).toLocaleString(); }&lt;/jsfunction&gt;&#39; WHERE (ongrid_formatter IS NULL OR ongrid_formatter = &#39;&#39;) AND idfield in (SELECT idfield FROM gui.view_structure WHERE udt_name = &#39;timestamptz&#39;);
   UPDATE gui.column_interface_properties SET ongrid_editor = &#39;json_treeview&#39; WHERE (ongrid_editor IS NULL OR ongrid_editor = &#39;&#39;) AND idfield in (SELECT idfield FROM gui.view_structure WHERE udt_name = &#39;jsonb&#39; OR udt_name = &#39;json&#39;);
   --UPDATE gui.column_interface_properties SET ongrid_editor = &#39;checkbox&#39; WHERE (ongrid_editor IS NULL OR ongrid_editor = &#39;&#39;) AND idfield in (SELECT idfield FROM gui.view_structure WHERE udt_name = &#39;bool&#39;);
   UPDATE gui.column_interface_properties SET ongrid_editor = &#39;checkbox&#39;, ongrid_editable = true, ongrid_editon = &#39;&#39;, ongrid_editor_args = &#39;&lt;jsfunction&gt;function(){return {disabled:true}}&lt;/jsfunction&gt;&#39; WHERE (ongrid_editor IS NULL OR ongrid_editor = &#39;&#39;) AND idfield in (SELECT idfield FROM gui.view_structure WHERE udt_name = &#39;bool&#39;);
UPDATE gui.column_interface_properties SET ongrid_formatter = &#39;&lt;jsfunction&gt;function (item) {return item;}&lt;/jsfunction&gt;&#39;  WHERE (ongrid_formatter IS NULL OR ongrid_formatter = &#39;&#39;) AND idfield in (SELECT idfield FROM gui.view_structure WHERE domain_name = &#39;html_text&#39;);

DELETE FROM gui.column_interface_properties WHERE idfield NOT IN(SELECT idfield FROM view_schema_table_column);

RETURN fun_return;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_mapper() -->
    <section id="gui.function.fun-mapper"
             xreflabel="guifun_mapper()">
      <title id="gui.function.fun-mapper-title">
       fun_mapper()
      </title>
      <titleabbrev id="gui.function.fun-mapper-titleabbrev">
       fun_mapper()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

fun_return INTEGER DEFAULT 0;
cursor1 CURSOR FOR SELECT * FROM public.view_table_schema where table_name NOT LIKE &#39;%_20%&#39; AND table_name NOT LIKE &#39;%_19%&#39;;
    cursor1_row RECORD;

BEGIN


    FOR cursor1_row IN cursor1 LOOP
  IF NOT EXISTS(SELECT * FROM gui.column_properties WHERE hash_num = cursor1_row.hash_num) THEN  
--IF NOT EXISTS(SELECT * FROM gui.column_properties WHERE hash_num = cursor1_row.hash_num AND column_label = cursor1_row.column_name) THEN
INSERT INTO gui.column_properties(
            hash_num, column_label)
    VALUES (cursor1_row.hash_num, cursor1_row.column_name);
    
END IF;


IF NOT EXISTS(SELECT * FROM gui.tables_view_properties WHERE tschema_tname = cursor1_row.tschema_tname) THEN
INSERT INTO gui.tables_view_properties(
            tschema_tname)
    VALUES (cursor1_row.tschema_tname);    
END IF;

    END LOOP;

-- Hacemos algunas actualizacion con valores de fabrica
    UPDATE gui.column_properties SET dgrid_formatter = &#39;&lt;jsfunction&gt;function (data) { return new Date(data).toLocaleString(); }&lt;/jsfunction&gt;&#39; WHERE (dgrid_formatter IS NULL OR dgrid_formatter = &#39;&#39;) AND hash_num in (SELECT hash_num FROM gui.view_columns_properties WHERE data_type = &#39;timestamp with time zone&#39;);
UPDATE gui.column_properties SET dgrid_editor = &#39;json_treeview&#39; WHERE (dgrid_editor IS NULL OR dgrid_editor = &#39;&#39;) AND hash_num in (SELECT hash_num FROM gui.view_columns_properties WHERE data_type = &#39;jsonb&#39; OR data_type = &#39;json&#39;);
--UPDATE gui.column_properties SET dgrid_editor = &#39;checkbox&#39; WHERE (dgrid_editor IS NULL OR dgrid_editor = &#39;&#39;) AND hash_num in (SELECT hash_num FROM gui.view_columns_properties WHERE data_type = &#39;boolean&#39;);
UPDATE gui.column_properties SET dgrid_editor = &#39;checkbox&#39;, dgrid_editable = true, dgrid_editon = &#39;&#39;, dgrid_editor_args = &#39;&lt;jsfunction&gt;function(){return {disabled:true}}&lt;/jsfunction&gt;&#39; WHERE (dgrid_editor IS NULL OR dgrid_editor = &#39;&#39;) AND hash_num in (SELECT hash_num FROM gui.view_columns_properties WHERE data_type = &#39;boolean&#39;);

RETURN fun_return;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_notification_app_send(iidadmin integer, inbody integer, intitle boolean, insnd text, inimg text, incloseable text, intimeout text, ipriority bigint) -->
    <section id="gui.function.fun-notification-app-send-iidadmin-integer-inbody-integer-intitle-boolean-insnd-text-inimg-text-incloseable-text-intimeout-text-ipriority-bigint"
             xreflabel="guifun_notification_app_send(iidadmin integer, inbody integer, intitle boolean, insnd text, inimg text, incloseable text, intimeout text, ipriority bigint)">
      <title id="gui.function.fun-notification-app-send-iidadmin-integer-inbody-integer-intitle-boolean-insnd-text-inimg-text-incloseable-text-intimeout-text-ipriority-bigint-title">
       fun_notification_app_send(iidadmin integer, inbody integer, intitle boolean, insnd text, inimg text, incloseable text, intimeout text, ipriority bigint)
      </title>
      <titleabbrev id="gui.function.fun-notification-app-send-iidadmin-integer-inbody-integer-intitle-boolean-insnd-text-inimg-text-incloseable-text-intimeout-text-ipriority-bigint-titleabbrev">
       fun_notification_app_send(iidadmin integer, inbody integer, intitle boolean, insnd text, inimg text, incloseable text, intimeout text, ipriority bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

isessionid text default &#39;all&#39;;

BEGIN

isessionid := COALESCE((SELECT admin_sessionid FROM admins WHERE idadmin = iidadmin limit 1), &#39;all&#39;);

INSERT INTO gui.notification_area(
            urgency, timeout, closable, img, snd, title, body, 
            sessionid)
    VALUES (ipriority, intimeout, incloseable, inimg, insnd, intitle, inbody, 
            isessionid);


RETURN 0;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_remove_notifications_old() -->
    <section id="gui.function.fun-remove-notifications-old"
             xreflabel="guifun_remove_notifications_old()">
      <title id="gui.function.fun-remove-notifications-old-title">
       fun_remove_notifications_old()
      </title>
      <titleabbrev id="gui.function.fun-remove-notifications-old-titleabbrev">
       fun_remove_notifications_old()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN
DELETE FROM gui.notification_area 
WHERE  ts &gt; (now() - INTERVAL &#39;1 minutes&#39; ); -- EXTRACT(EPOCH FROM (now() - ts) / 60) &gt; 2;
RETURN TRUE;
END;
</programlisting>
      </para>
    </section>

<!-- Function funjs_db_structure(schema_table text) -->
    <section id="gui.function.funjs-db-structure-schema-table-text"
             xreflabel="guifunjs_db_structure(schema_table text)">
      <title id="gui.function.funjs-db-structure-schema-table-text-title">
       funjs_db_structure(schema_table text)
      </title>
      <titleabbrev id="gui.function.funjs-db-structure-schema-table-text-titleabbrev">
       funjs_db_structure(schema_table text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>jsonb</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>res = [];

var view_structure = &quot; WITH schema_table_column_properties as (SELECT view_schema_table_column.tschema_tname as tsn, * FROM view_schema_table_column, gui.column_interface_properties, gui.tables_view_properties WHERE column_interface_properties.idfield = view_schema_table_column.idfield AND tables_view_properties.tschema_tname = view_schema_table_column.tschema_tname) &quot;;

if(schema_table &amp;&amp; schema_table.length &gt; 0){
	var plan1 = plv8.prepare(view_structure+&quot; SELECT * FROM schema_table_column_properties WHERE table_parent isnull AND tsn = $1 ORDER BY tschema_tname_tcol, ongrid_position;&quot;);
	res = plan1.execute([schema_table]);
}else{
	var plan2 = plv8.prepare(view_structure+&quot; SELECT * FROM schema_table_column_properties WHERE table_parent isnull ORDER BY tschema_tname_tcol, ongrid_position;&quot;);
	res = plan2.execute([]);
}

var sorted = {};

res.forEach(function(row){

	if(!sorted[row.table_schema]){
		sorted[row.table_schema] = {};
	}

	if(!sorted[row.table_schema][row.table_name]){
		sorted[row.table_schema][row.table_name] = {_Properties_: {title: row.title_grid, row_selector: row.row_selector_dgrid}};
	}

	if(!sorted[row.table_schema][row.table_name][row.column_name]){
		sorted[row.table_schema][row.table_name][row.column_name] = {uuid: row.idfield, udt_name: row.udt_name, column_default: row.column_default, pk: row.pk, label: row.label, public: row.public, ongrid_visible: row.ongrid_visible, ongrid_position: row.ongrid_position, ongrid_editable: row.ongrid_editable, ongrid_formatter: row.ongrid_formatter, ongrid_sortable: row.ongrid_sortable, ongrid_editor: row.ongrid_editor, ongrid_editor: row.ongrid_editor, onform_editor: row.onform_editor, onform_editor_args: row.onform_editor_args, ongrid_editor_args: row.ongrid_editor_args, ongrid_editon: row.ongrid_editon, onform_editor: row.onform_editor, ongrid_sortable: row.ongrid_sortable, ongrid_render_cell: row.ongrid_render_cell};
	}

//if(!sorted[row.table_schema][row.table_name].columns.some(function(col){col.column_name !== row.column_name})){
    //var c = {};
    //c[row.column_name] = {uuid: row.idfield, udt_name: row.udt_name, column_default: row.column_default, pk: row.pk, label: row.label, public: row.public, ongrid_visible: row.ongrid_visible, ongrid_position: row.ongrid_position, ongrid_editable: row.ongrid_editable, ongrid_formatter: row.ongrid_formatter, ongrid_sortable: row.ongrid_sortable, ongrid_editor: row.ongrid_editor, ongrid_editor: row.ongrid_editor, onform_editor: row.onform_editor, onform_editor_args: row.onform_editor_args, ongrid_editor_args: row.ongrid_editor_args, ongrid_editon: row.ongrid_editon, onform_editor: row.onform_editor, ongrid_sortable: row.ongrid_sortable, ongrid_render_cell: row.ongrid_render_cell};
    //sorted[row.table_schema][row.table_name].columns.push(c);            

            /*
            sorted[row.table_schema][row.table_name].columns.push(
              {field_name: row.column_name, uuid: row.idfield, udt_name: row.udt_name, column_default: row.column_default, pk: row.pk, label: row.label, public: row.public, ongrid_visible: row.ongrid_visible, ongrid_position: row.ongrid_position, ongrid_editable: row.ongrid_editable, ongrid_formatter: row.ongrid_formatter, ongrid_sortable: row.ongrid_sortable, ongrid_editor: row.ongrid_editor, ongrid_editor: row.ongrid_editor, onform_editor: row.onform_editor, onform_editor_args: row.onform_editor_args, ongrid_editor_args: row.ongrid_editor_args, ongrid_editon: row.ongrid_editon, onform_editor: row.onform_editor, ongrid_sortable: row.ongrid_sortable, ongrid_render_cell: row.ongrid_render_cell}
            ); 
            */
            
//}

});

/*
[2, 5, 8, 1, 4].some(isBiggerThan10);  // false
*/

/*
res.forEach(function(row){
	sorted[row.table_schema] = [];
});

Object.keys(sorted).forEach(function(id) {
	sorted[id] = res.filter(function(row) {
		return row.table_schema === id;
	})
	.map(function(row) {
		var table = {};
table[row.table_name] = {};
		return table;
	});
});
*/

if(res.length &gt; 0){

	return JSON.stringify([sorted], function(key, value){

		if(typeof value === &quot;string&quot;){
			return value.split(&quot;\n&quot;).join(&#39; &#39;);
		}else if(value === null) {
			return undefined;
		}
		return value;
	})//.replace(/(\&quot;&lt;jsfunction&gt;|&lt;\/jsfunction&gt;\&quot;)/ig,&#39;&#39;);

} else {
	return {};
}

</programlisting>
      </para>
    </section>

<!-- Function menu_auto_gen_nameevent() -->
    <section id="gui.function.menu-auto-gen-nameevent"
             xreflabel="guimenu_auto_gen_nameevent()">
      <title id="gui.function.menu-auto-gen-nameevent-title">
       menu_auto_gen_nameevent()
      </title>
      <titleabbrev id="gui.function.menu-auto-gen-nameevent-titleabbrev">
       menu_auto_gen_nameevent()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
BEGIN

RAISE NOTICE &#39;1) on_update_row_update_ts&#39;;

IF NEW.nameeventonclick IS NULL OR LENGTH(NEW.nameeventonclick) &lt; 1 AND NEW.type = &#39;item&#39; THEN
UPDATE gui.menus SET nameeventonclick = &#39;menuitem_&#39;||NEW.idmenu::TEXT WHERE idmenu = NEW.idmenu;
END IF;

   RETURN NEW;
END;
</programlisting>
      </para>
    </section>

<!-- Function notifications_before_insert() -->
    <section id="gui.function.notifications-before-insert"
             xreflabel="guinotifications_before_insert()">
      <title id="gui.function.notifications-before-insert-title">
       notifications_before_insert()
      </title>
      <titleabbrev id="gui.function.notifications-before-insert-titleabbrev">
       notifications_before_insert()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

/*
UPDATE sys_table_ts SET ts = now() WHERE table_name = TG_TABLE_NAME;
        IF NOT found THEN
INSERT INTO sys_table_ts (table_name) VALUES (TG_TABLE_NAME);
        END IF;
*/


IF NEW.timeout &lt; 5 THEN
NEW.timeout := 5;
END IF;

IF NEW.img IS NULL OR LENGTH(NEW.img) &lt; 4 THEN
NEW.img := &#39;/notifications_media/img/dialog-error.png&#39;;
END IF;

IF NEW.snd IS NULL OR LENGTH(NEW.snd) &lt; 4 THEN
--NEW.snd := &#39;/notifications_media/snd/snd00.mp3&#39;;
END IF;

IF NEW.title IS NULL OR LENGTH(NEW.title) &lt; 3 THEN
NEW.title := &#39;Notification&#39;;
END IF;

IF NEW.body IS NULL OR  LENGTH(NEW.body) &lt; 3 THEN
NEW.body := &#39;Empty notification message&#39;;
END IF;

RETURN NEW;
END;</programlisting>
      </para>
    </section>

<!-- Function on_edit_column_interface() -->
    <section id="gui.function.on-edit-column-interface"
             xreflabel="guion_edit_column_interface()">
      <title id="gui.function.on-edit-column-interface-title">
       on_edit_column_interface()
      </title>
      <titleabbrev id="gui.function.on-edit-column-interface-titleabbrev">
       on_edit_column_interface()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

IF NEW.ongrid_editor = &#39;checkbox&#39; THEN
NEW.ongrid_editor_args := &#39;&lt;jsfunction&gt;function(){return {disabled:&#39;||(NOT NEW.ongrid_editable)::TEXT||&#39;}}&lt;/jsfunction&gt;&#39;;
END IF;


RETURN NEW;
END;


</programlisting>
      </para>
    </section>

  </chapter>

  <chapter id="octopus.schema"
           xreflabel="octopus">
    <title>Schema octopus</title>
    <para></para>


      <section id="octopus.table.octopus-by-account"
               xreflabel="octopus.octopus_by_account">
        <title id="octopus.table.octopus-by-account-title">
         Table:
         
         <structname>octopus_by_account</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>octopus_by_account</structname>
            </title>


            <varlistentry>
              <term><structfield>idoctopus_byaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;octopus_by_account_idoctopus_byaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idoctopusfunction</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_run</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>next_run</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parameters</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>trigger_time</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>status</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on octopus_by_account</title>

          <varlistentry>
            <term>ck_octopus_dtstart_dtend</term>
            <listitem><para>CHECK ((datetime_start &lt; datetime_end))</para></listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="octopus.table.octopus-by-equipment"
               xreflabel="octopus.octopus_by_equipment">
        <title id="octopus.table.octopus-by-equipment-title">
         Table:
         
         <structname>octopus_by_equipment</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>octopus_by_equipment</structname>
            </title>


            <varlistentry>
              <term><structfield>idoctopus_byaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;octopus_by_account_idoctopus_byaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idoctopusfunction</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_run</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>next_run</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parameters</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>trigger_time</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>status</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idequipment</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="public.table.-devices"/>


              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on octopus_by_equipment</title>

          <varlistentry>
            <term>ck_octopus_dtstart_dtend</term>
            <listitem><para>CHECK ((datetime_start &lt; datetime_end))</para></listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="octopus.table.octopus-function"
               xreflabel="octopus.octopus_function">
        <title id="octopus.table.octopus-function-title">
         Table:
         
         <structname>octopus_function</structname>
        </title>
 

        <para>
          Lista de funciones implementadas en octopus (En el servidor) y sus parametros predeterminados
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>octopus_function</structname>
            </title>


            <varlistentry>
              <term><structfield>idoctopusfunction</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>function_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>default_parameters</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>label_function</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>










              </para>

              <para>
                Nombre de la funcion en el servidor octopus (Funcion JS)
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>trigger_time</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing octopus.octopus_functions_base via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="octopus.table.octopus-functions-base"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="octopus.table.octopus-functions-base"
               xreflabel="octopus.octopus_functions_base">
        <title id="octopus.table.octopus-functions-base-title">
         Table:
         
         <structname>octopus_functions_base</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>octopus_functions_base</structname>
            </title>


            <varlistentry>
              <term><structfield>idoctopus_byaccount</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idoctopusfunction</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="octopus.table.octopus-function"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_run</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>next_run</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>parameters</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>trigger_time</structfield></term>
              <listitem><para>
                <type>json</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>status</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on octopus_functions_base</title>

          <varlistentry>
            <term>ck_octopus_dtstart_dtend</term>
            <listitem><para>CHECK ((datetime_start &lt; datetime_end))</para></listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="octopus.table.octopus-task-queue"
               xreflabel="octopus.octopus_task_queue">
        <title id="octopus.table.octopus-task-queue-title">
         Table:
         
         <structname>octopus_task_queue</structname>
        </title>
 

        <para>
          Lista de tareas pendientes para ser procesadas por octopus.

        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>octopus_task_queue</structname>
            </title>


            <varlistentry>
              <term><structfield>idoctopus_taskqueue</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idoctopustask</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_task</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>task_parameters</structfield></term>
              <listitem><para>
                <type>json</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>task_status</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>



  </chapter>

  <chapter id="pgagent.schema"
           xreflabel="pgagent">
    <title>Schema pgagent</title>
    <para>pgAgent system tables</para>


      <section id="pgagent.table.pga-exception"
               xreflabel="pgagent.pga_exception">
        <title id="pgagent.table.pga-exception-title">
         Table:
         
         <structname>pga_exception</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>pga_exception</structname>
            </title>


            <varlistentry>
              <term><structfield>jexid</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jexscid</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="pgagent.table.pga-schedule"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jexdate</structfield></term>
              <listitem><para>
                <type>date</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jextime</structfield></term>
              <listitem><para>
                <type>time without time zone</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on pga_exception</title>

          <varlistentry>
            <term>pga_exception_jexscid</term>
            <listitem><para>jexscid</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="pgagent.table.pga-job"
               xreflabel="pgagent.pga_job">
        <title id="pgagent.table.pga-job-title">
         Table:
         
         <structname>pga_job</structname>
        </title>
 

        <para>
          Job main entry
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pga_job</structname>
            </title>


            <varlistentry>
              <term><structfield>jobid</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobjclid</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="pgagent.table.pga-jobclass"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobname</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobdesc</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobhostagent</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobenabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobcreated</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobchanged</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobagentid</structfield></term>
              <listitem><para>
                <type>integer</type>












                <literal>REFERENCES</literal> <xref linkend="pgagent.table.pga-jobagent"/>


              </para>

              <para>
                Agent that currently executes this job.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jobnextrun</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>joblastrun</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing pgagent.pga_joblog via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="pgagent.table.pga-joblog"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="pgagent.table.pga-jobstep"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="pgagent.table.pga-schedule"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="pgagent.table.pga-jobagent"
               xreflabel="pgagent.pga_jobagent">
        <title id="pgagent.table.pga-jobagent-title">
         Table:
         
         <structname>pga_jobagent</structname>
        </title>
 

        <para>
          Active job agents
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pga_jobagent</structname>
            </title>


            <varlistentry>
              <term><structfield>jagpid</structfield></term>
              <listitem><para>
                <type>integer</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jaglogintime</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jagstation</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing pgagent.pga_job via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="pgagent.table.pga-job"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="pgagent.table.pga-jobclass"
               xreflabel="pgagent.pga_jobclass">
        <title id="pgagent.table.pga-jobclass-title">
         Table:
         
         <structname>pga_jobclass</structname>
        </title>
 

        <para>
          Job classification
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pga_jobclass</structname>
            </title>


            <varlistentry>
              <term><structfield>jclid</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jclname</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing pgagent.pga_job via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="pgagent.table.pga-job"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="pgagent.table.pga-joblog"
               xreflabel="pgagent.pga_joblog">
        <title id="pgagent.table.pga-joblog-title">
         Table:
         
         <structname>pga_joblog</structname>
        </title>
 

        <para>
          Job run logs.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pga_joblog</structname>
            </title>


            <varlistentry>
              <term><structfield>jlgid</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jlgjobid</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="pgagent.table.pga-job"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jlgstatus</structfield></term>
              <listitem><para>
                <type>character(1)</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;r&apos;::bpchar</literal>



              </para>

              <para>
                Status of job: r=running, s=successfully finished, f=failed, i=no steps to execute, d=aborted
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jlgstart</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jlgduration</structfield></term>
              <listitem><para>
                <type>interval</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on pga_joblog</title>

          <varlistentry>
            <term>pga_joblog_jlgstatus_check</term>
            <listitem><para>CHECK ((jlgstatus = ANY (ARRAY[&apos;r&apos;::bpchar, &apos;s&apos;::bpchar, &apos;f&apos;::bpchar, &apos;i&apos;::bpchar, &apos;d&apos;::bpchar])))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on pga_joblog</title>

          <varlistentry>
            <term>pga_joblog_jobid</term>
            <listitem><para>jlgjobid</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing pgagent.pga_jobsteplog via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="pgagent.table.pga-jobsteplog"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="pgagent.table.pga-jobstep"
               xreflabel="pgagent.pga_jobstep">
        <title id="pgagent.table.pga-jobstep-title">
         Table:
         
         <structname>pga_jobstep</structname>
        </title>
 

        <para>
          Job step to be executed
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pga_jobstep</structname>
            </title>


            <varlistentry>
              <term><structfield>jstid</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstjobid</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="pgagent.table.pga-job"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstname</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstdesc</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstenabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstkind</structfield></term>
              <listitem><para>
                <type>character(1)</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                Kind of jobstep: s=sql, b=batch
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstcode</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstconnstr</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstdbname</structfield></term>
              <listitem><para>
                <type>name</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;&apos;::name</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jstonerror</structfield></term>
              <listitem><para>
                <type>character(1)</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;f&apos;::bpchar</literal>



              </para>

              <para>
                What to do if step returns an error: f=fail the job, s=mark step as succeeded and continue, i=mark as fail but ignore it and proceed
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscnextrun</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on pga_jobstep</title>

          <varlistentry>
            <term>pga_jobstep_check</term>
            <listitem><para>CHECK ((((jstconnstr &lt;&gt; &apos;&apos;::text) AND (jstkind = &apos;s&apos;::bpchar)) OR ((jstconnstr = &apos;&apos;::text) AND ((jstkind = &apos;b&apos;::bpchar) OR (jstdbname &lt;&gt; &apos;&apos;::name)))))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pga_jobstep_check1</term>
            <listitem><para>CHECK ((((jstdbname &lt;&gt; &apos;&apos;::name) AND (jstkind = &apos;s&apos;::bpchar)) OR ((jstdbname = &apos;&apos;::name) AND ((jstkind = &apos;b&apos;::bpchar) OR (jstconnstr &lt;&gt; &apos;&apos;::text)))))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pga_jobstep_jstkind_check</term>
            <listitem><para>CHECK ((jstkind = ANY (ARRAY[&apos;b&apos;::bpchar, &apos;s&apos;::bpchar])))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pga_jobstep_jstonerror_check</term>
            <listitem><para>CHECK ((jstonerror = ANY (ARRAY[&apos;f&apos;::bpchar, &apos;s&apos;::bpchar, &apos;i&apos;::bpchar])))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on pga_jobstep</title>

          <varlistentry>
            <term>pga_jobstep_jobid</term>
            <listitem><para>jstjobid</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing pgagent.pga_jobsteplog via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="pgagent.table.pga-jobsteplog"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="pgagent.table.pga-jobsteplog"
               xreflabel="pgagent.pga_jobsteplog">
        <title id="pgagent.table.pga-jobsteplog-title">
         Table:
         
         <structname>pga_jobsteplog</structname>
        </title>
 

        <para>
          Job step run logs.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pga_jobsteplog</structname>
            </title>


            <varlistentry>
              <term><structfield>jslid</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jsljlgid</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="pgagent.table.pga-joblog"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jsljstid</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="pgagent.table.pga-jobstep"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jslstatus</structfield></term>
              <listitem><para>
                <type>character(1)</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;r&apos;::bpchar</literal>



              </para>

              <para>
                Status of job step: r=running, s=successfully finished,  f=failed stopping job, i=ignored failure, d=aborted
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jslresult</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

              <para>
                Return code of job step
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jslstart</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jslduration</structfield></term>
              <listitem><para>
                <type>interval</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jsloutput</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on pga_jobsteplog</title>

          <varlistentry>
            <term>pga_jobsteplog_jslstatus_check</term>
            <listitem><para>CHECK ((jslstatus = ANY (ARRAY[&apos;r&apos;::bpchar, &apos;s&apos;::bpchar, &apos;i&apos;::bpchar, &apos;f&apos;::bpchar, &apos;d&apos;::bpchar])))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on pga_jobsteplog</title>

          <varlistentry>
            <term>pga_jobsteplog_jslid</term>
            <listitem><para>jsljlgid</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="pgagent.table.pga-schedule"
               xreflabel="pgagent.pga_schedule">
        <title id="pgagent.table.pga-schedule-title">
         Table:
         
         <structname>pga_schedule</structname>
        </title>
 

        <para>
          Job schedule exceptions
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>pga_schedule</structname>
            </title>


            <varlistentry>
              <term><structfield>jscid</structfield></term>
              <listitem><para>
                <type>serial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscjobid</structfield></term>
              <listitem><para>
                <type>integer</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="pgagent.table.pga-job"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscname</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscdesc</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscenabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscstart</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscend</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscminutes</structfield></term>
              <listitem><para>
                <type>boolean[]</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f}&apos;::boolean[]</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jschours</structfield></term>
              <listitem><para>
                <type>boolean[]</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f}&apos;::boolean[]</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscweekdays</structfield></term>
              <listitem><para>
                <type>boolean[]</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{f,f,f,f,f,f,f}&apos;::boolean[]</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscmonthdays</structfield></term>
              <listitem><para>
                <type>boolean[]</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f}&apos;::boolean[]</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>jscmonths</structfield></term>
              <listitem><para>
                <type>boolean[]</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{f,f,f,f,f,f,f,f,f,f,f,f}&apos;::boolean[]</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on pga_schedule</title>

          <varlistentry>
            <term>pga_schedule_jschours_size</term>
            <listitem><para>CHECK ((array_upper(jschours, 1) = 24))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pga_schedule_jscminutes_size</term>
            <listitem><para>CHECK ((array_upper(jscminutes, 1) = 60))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pga_schedule_jscmonthdays_size</term>
            <listitem><para>CHECK ((array_upper(jscmonthdays, 1) = 32))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pga_schedule_jscmonths_size</term>
            <listitem><para>CHECK ((array_upper(jscmonths, 1) = 12))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>pga_schedule_jscweekdays_size</term>
            <listitem><para>CHECK ((array_upper(jscweekdays, 1) = 7))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on pga_schedule</title>

          <varlistentry>
            <term>pga_jobschedule_jobid</term>
            <listitem><para>jscjobid</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing pgagent.pga_exception via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="pgagent.table.pga-exception"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>



<!-- Function pga_exception_trigger() -->
    <section id="pgagent.function.pga-exception-trigger"
             xreflabel="pgagentpga_exception_trigger()">
      <title id="pgagent.function.pga-exception-trigger-title">
       pga_exception_trigger()
      </title>
      <titleabbrev id="pgagent.function.pga-exception-trigger-titleabbrev">
       pga_exception_trigger()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Update the job&apos;s next run time whenever an exception changes
        <programlisting>
DECLARE

    v_jobid int4 := 0;

BEGIN

     IF TG_OP = &#39;DELETE&#39; THEN

        SELECT INTO v_jobid jscjobid FROM pgagent.pga_schedule WHERE jscid = OLD.jexscid;

        -- update pga_job from remaining schedules
        -- the actual calculation of jobnextrun will be performed in the trigger
        UPDATE pgagent.pga_job
           SET jobnextrun = NULL
         WHERE jobenabled AND jobid = v_jobid;
        RETURN OLD;
    ELSE

        SELECT INTO v_jobid jscjobid FROM pgagent.pga_schedule WHERE jscid = NEW.jexscid;

        UPDATE pgagent.pga_job
           SET jobnextrun = NULL
         WHERE jobenabled AND jobid = v_jobid;
        RETURN NEW;
    END IF;
END;
</programlisting>
      </para>
    </section>

<!-- Function pga_is_leap_year(smallint) -->
    <section id="pgagent.function.pga-is-leap-year-smallint"
             xreflabel="pgagentpga_is_leap_year(smallint)">
      <title id="pgagent.function.pga-is-leap-year-smallint-title">
       pga_is_leap_year(smallint)
      </title>
      <titleabbrev id="pgagent.function.pga-is-leap-year-smallint-titleabbrev">
       pga_is_leap_year(smallint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       Returns TRUE if $1 is a leap year
        <programlisting>
BEGIN
    IF $1 % 4 != 0 THEN
        RETURN FALSE;
    END IF;

    IF $1 % 100 != 0 THEN
        RETURN TRUE;
    END IF;

    RETURN $1 % 400 = 0;
END;
</programlisting>
      </para>
    </section>

<!-- Function pga_job_trigger() -->
    <section id="pgagent.function.pga-job-trigger"
             xreflabel="pgagentpga_job_trigger()">
      <title id="pgagent.function.pga-job-trigger-title">
       pga_job_trigger()
      </title>
      <titleabbrev id="pgagent.function.pga-job-trigger-titleabbrev">
       pga_job_trigger()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Update the job&apos;s next run time.
        <programlisting>
BEGIN
    IF NEW.jobenabled THEN
        IF NEW.jobnextrun IS NULL THEN
             SELECT INTO NEW.jobnextrun
                    MIN(pgagent.pga_next_schedule(jscid, jscstart, jscend, jscminutes, jschours, jscweekdays, jscmonthdays, jscmonths))
               FROM pgagent.pga_schedule
              WHERE jscenabled AND jscjobid=OLD.jobid;
        END IF;
    ELSE
        NEW.jobnextrun := NULL;
    END IF;
    RETURN NEW;
END;
</programlisting>
      </para>
    </section>

<!-- Function pga_next_schedule(integer, timestamp with time zone, timestamp with time zone, boolean[], boolean[], boolean[], boolean[], boolean[]) -->
    <section id="pgagent.function.pga-next-schedule-integer-timestamp-with-time-zone-timestamp-with-time-zone-booleanARRAY-booleanARRAY-booleanARRAY-booleanARRAY-booleanARRAY"
             xreflabel="pgagentpga_next_schedule(integer, timestamp with time zone, timestamp with time zone, boolean[], boolean[], boolean[], boolean[], boolean[])">
      <title id="pgagent.function.pga-next-schedule-integer-timestamp-with-time-zone-timestamp-with-time-zone-booleanARRAY-booleanARRAY-booleanARRAY-booleanARRAY-booleanARRAY-title">
       pga_next_schedule(integer, timestamp with time zone, timestamp with time zone, boolean[], boolean[], boolean[], boolean[], boolean[])
      </title>
      <titleabbrev id="pgagent.function.pga-next-schedule-integer-timestamp-with-time-zone-timestamp-with-time-zone-booleanARRAY-booleanARRAY-booleanARRAY-booleanARRAY-booleanARRAY-titleabbrev">
       pga_next_schedule(integer, timestamp with time zone, timestamp with time zone, boolean[], boolean[], boolean[], boolean[], boolean[])
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>timestamp with time zone</seg>
        </seglistitem>
       </segmentedlist>
 
       Calculates the next runtime for a given schedule
        <programlisting>
DECLARE
    jscid           ALIAS FOR $1;
    jscstart        ALIAS FOR $2;
    jscend          ALIAS FOR $3;
    jscminutes      ALIAS FOR $4;
    jschours        ALIAS FOR $5;
    jscweekdays     ALIAS FOR $6;
    jscmonthdays    ALIAS FOR $7;
    jscmonths       ALIAS FOR $8;

    nextrun         timestamp := &#39;1970-01-01 00:00:00-00&#39;;
    runafter        timestamp := &#39;1970-01-01 00:00:00-00&#39;;

    bingo            bool := FALSE;
    gotit            bool := FALSE;
    foundval        bool := FALSE;
    daytweak        bool := FALSE;
    minutetweak        bool := FALSE;

    i                int2 := 0;
    d                int2 := 0;

    nextminute        int2 := 0;
    nexthour        int2 := 0;
    nextday            int2 := 0;
    nextmonth       int2 := 0;
    nextyear        int2 := 0;


BEGIN
    -- No valid start date has been specified
    IF jscstart IS NULL THEN RETURN NULL; END IF;

    -- The schedule is past its end date
    IF jscend IS NOT NULL AND jscend &lt; now() THEN RETURN NULL; END IF;

    -- Get the time to find the next run after. It will just be the later of
    -- now() + 1m and the start date for the time being, however, we might want to
    -- do more complex things using this value in the future.
    IF date_trunc(&#39;MINUTE&#39;, jscstart) &gt; date_trunc(&#39;MINUTE&#39;, (now() + &#39;1 Minute&#39;::interval)) THEN
        runafter := date_trunc(&#39;MINUTE&#39;, jscstart);
    ELSE
        runafter := date_trunc(&#39;MINUTE&#39;, (now() + &#39;1 Minute&#39;::interval));
    END IF;

    --
    -- Enter a loop, generating next run timestamps until we find one
    -- that falls on the required weekday, and is not matched by an exception
    --

    WHILE bingo = FALSE LOOP

        --
        -- Get the next run year
        --
        nextyear := date_part(&#39;YEAR&#39;, runafter);

        --
        -- Get the next run month
        --
        nextmonth := date_part(&#39;MONTH&#39;, runafter);
        gotit := FALSE;
        FOR i IN (nextmonth) .. 12 LOOP
            IF jscmonths[i] = TRUE THEN
                nextmonth := i;
                gotit := TRUE;
                foundval := TRUE;
                EXIT;
            END IF;
        END LOOP;
        IF gotit = FALSE THEN
            FOR i IN 1 .. (nextmonth - 1) LOOP
                IF jscmonths[i] = TRUE THEN
                    nextmonth := i;

                    -- Wrap into next year
                    nextyear := nextyear + 1;
                    gotit := TRUE;
                    foundval := TRUE;
                    EXIT;
                END IF;
           END LOOP;
        END IF;

        --
        -- Get the next run day
        --
        -- If the year, or month have incremented, get the lowest day,
        -- otherwise look for the next day matching or after today.
        IF (nextyear &gt; date_part(&#39;YEAR&#39;, runafter) OR nextmonth &gt; date_part(&#39;MONTH&#39;, runafter)) THEN
            nextday := 1;
            FOR i IN 1 .. 32 LOOP
                IF jscmonthdays[i] = TRUE THEN
                    nextday := i;
                    foundval := TRUE;
                    EXIT;
                END IF;
            END LOOP;
        ELSE
            nextday := date_part(&#39;DAY&#39;, runafter);
            gotit := FALSE;
            FOR i IN nextday .. 32 LOOP
                IF jscmonthdays[i] = TRUE THEN
                    nextday := i;
                    gotit := TRUE;
                    foundval := TRUE;
                    EXIT;
                END IF;
            END LOOP;
            IF gotit = FALSE THEN
                FOR i IN 1 .. (nextday - 1) LOOP
                    IF jscmonthdays[i] = TRUE THEN
                        nextday := i;

                        -- Wrap into next month
                        IF nextmonth = 12 THEN
                            nextyear := nextyear + 1;
                            nextmonth := 1;
                        ELSE
                            nextmonth := nextmonth + 1;
                        END IF;
                        gotit := TRUE;
                        foundval := TRUE;
                        EXIT;
                    END IF;
                END LOOP;
            END IF;
        END IF;

        -- Was the last day flag selected?
        IF nextday = 32 THEN
            IF nextmonth = 1 THEN
                nextday := 31;
            ELSIF nextmonth = 2 THEN
                IF pgagent.pga_is_leap_year(nextyear) = TRUE THEN
                    nextday := 29;
                ELSE
                    nextday := 28;
                END IF;
            ELSIF nextmonth = 3 THEN
                nextday := 31;
            ELSIF nextmonth = 4 THEN
                nextday := 30;
            ELSIF nextmonth = 5 THEN
                nextday := 31;
            ELSIF nextmonth = 6 THEN
                nextday := 30;
            ELSIF nextmonth = 7 THEN
                nextday := 31;
            ELSIF nextmonth = 8 THEN
                nextday := 31;
            ELSIF nextmonth = 9 THEN
                nextday := 30;
            ELSIF nextmonth = 10 THEN
                nextday := 31;
            ELSIF nextmonth = 11 THEN
                nextday := 30;
            ELSIF nextmonth = 12 THEN
                nextday := 31;
            END IF;
        END IF;

        --
        -- Get the next run hour
        --
        -- If the year, month or day have incremented, get the lowest hour,
        -- otherwise look for the next hour matching or after the current one.
        IF (nextyear &gt; date_part(&#39;YEAR&#39;, runafter) OR nextmonth &gt; date_part(&#39;MONTH&#39;, runafter) OR nextday &gt; date_part(&#39;DAY&#39;, runafter) OR daytweak = TRUE) THEN
            nexthour := 0;
            FOR i IN 1 .. 24 LOOP
                IF jschours[i] = TRUE THEN
                    nexthour := i - 1;
                    foundval := TRUE;
                    EXIT;
                END IF;
            END LOOP;
        ELSE
            nexthour := date_part(&#39;HOUR&#39;, runafter);
            gotit := FALSE;
            FOR i IN (nexthour + 1) .. 24 LOOP
                IF jschours[i] = TRUE THEN
                    nexthour := i - 1;
                    gotit := TRUE;
                    foundval := TRUE;
                    EXIT;
                END IF;
            END LOOP;
            IF gotit = FALSE THEN
                FOR i IN 1 .. nexthour LOOP
                    IF jschours[i] = TRUE THEN
                        nexthour := i - 1;

                        -- Wrap into next month
                        IF (nextmonth = 1 OR nextmonth = 3 OR nextmonth = 5 OR nextmonth = 7 OR nextmonth = 8 OR nextmonth = 10 OR nextmonth = 12) THEN
                            d = 31;
                        ELSIF (nextmonth = 4 OR nextmonth = 6 OR nextmonth = 9 OR nextmonth = 11) THEN
                            d = 30;
                        ELSE
                            IF pgagent.pga_is_leap_year(nextyear) = TRUE THEN
                                d := 29;
                            ELSE
                                d := 28;
                            END IF;
                        END IF;

                        IF nextday = d THEN
                            nextday := 1;
                            IF nextmonth = 12 THEN
                                nextyear := nextyear + 1;
                                nextmonth := 1;
                            ELSE
                                nextmonth := nextmonth + 1;
                            END IF;
                        ELSE
                            nextday := nextday + 1;
                        END IF;

                        gotit := TRUE;
                        foundval := TRUE;
                        EXIT;
                    END IF;
                END LOOP;
            END IF;
        END IF;

        --
        -- Get the next run minute
        --
        -- If the year, month day or hour have incremented, get the lowest minute,
        -- otherwise look for the next minute matching or after the current one.
        IF (nextyear &gt; date_part(&#39;YEAR&#39;, runafter) OR nextmonth &gt; date_part(&#39;MONTH&#39;, runafter) OR nextday &gt; date_part(&#39;DAY&#39;, runafter) OR nexthour &gt; date_part(&#39;HOUR&#39;, runafter) OR daytweak = TRUE) THEN
            nextminute := 0;
            IF minutetweak = TRUE THEN
        d := 1;
            ELSE
        d := date_part(&#39;YEAR&#39;, runafter)::int2;
            END IF;
            FOR i IN d .. 60 LOOP
                IF jscminutes[i] = TRUE THEN
                    nextminute := i - 1;
                    foundval := TRUE;
                    EXIT;
                END IF;
            END LOOP;
        ELSE
            nextminute := date_part(&#39;MINUTE&#39;, runafter);
            gotit := FALSE;
            FOR i IN (nextminute + 1) .. 60 LOOP
                IF jscminutes[i] = TRUE THEN
                    nextminute := i - 1;
                    gotit := TRUE;
                    foundval := TRUE;
                    EXIT;
                END IF;
            END LOOP;
            IF gotit = FALSE THEN
                FOR i IN 1 .. nextminute LOOP
                    IF jscminutes[i] = TRUE THEN
                        nextminute := i - 1;

                        -- Wrap into next hour
                        IF (nextmonth = 1 OR nextmonth = 3 OR nextmonth = 5 OR nextmonth = 7 OR nextmonth = 8 OR nextmonth = 10 OR nextmonth = 12) THEN
                            d = 31;
                        ELSIF (nextmonth = 4 OR nextmonth = 6 OR nextmonth = 9 OR nextmonth = 11) THEN
                            d = 30;
                        ELSE
                            IF pgagent.pga_is_leap_year(nextyear) = TRUE THEN
                                d := 29;
                            ELSE
                                d := 28;
                            END IF;
                        END IF;

                        IF nexthour = 23 THEN
                            nexthour = 0;
                            IF nextday = d THEN
                                nextday := 1;
                                IF nextmonth = 12 THEN
                                    nextyear := nextyear + 1;
                                    nextmonth := 1;
                                ELSE
                                    nextmonth := nextmonth + 1;
                                END IF;
                            ELSE
                                nextday := nextday + 1;
                            END IF;
                        ELSE
                            nexthour := nexthour + 1;
                        END IF;

                        gotit := TRUE;
                        foundval := TRUE;
                        EXIT;
                    END IF;
                END LOOP;
            END IF;
        END IF;

        -- Build the result, and check it is not the same as runafter - this may
        -- happen if all array entries are set to false. In this case, add a minute.

        nextrun := (nextyear::varchar || &#39;-&#39;::varchar || nextmonth::varchar || &#39;-&#39; || nextday::varchar || &#39; &#39; || nexthour::varchar || &#39;:&#39; || nextminute::varchar)::timestamptz;

        IF nextrun = runafter AND foundval = FALSE THEN
                nextrun := nextrun + INTERVAL &#39;1 Minute&#39;;
        END IF;

        -- If the result is past the end date, exit.
        IF nextrun &gt; jscend THEN
            RETURN NULL;
        END IF;

        -- Check to ensure that the nextrun time is actually still valid. Its
        -- possible that wrapped values may have carried the nextrun onto an
        -- invalid time or date.
        IF ((jscminutes = &#39;{f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f}&#39; OR jscminutes[date_part(&#39;MINUTE&#39;, nextrun) + 1] = TRUE) AND
            (jschours = &#39;{f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f}&#39; OR jschours[date_part(&#39;HOUR&#39;, nextrun) + 1] = TRUE) AND
            (jscmonthdays = &#39;{f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f}&#39; OR jscmonthdays[date_part(&#39;DAY&#39;, nextrun)] = TRUE OR
            (jscmonthdays = &#39;{f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,f,t}&#39; AND
             ((date_part(&#39;MONTH&#39;, nextrun) IN (1,3,5,7,8,10,12) AND date_part(&#39;DAY&#39;, nextrun) = 31) OR
              (date_part(&#39;MONTH&#39;, nextrun) IN (4,6,9,11) AND date_part(&#39;DAY&#39;, nextrun) = 30) OR
              (date_part(&#39;MONTH&#39;, nextrun) = 2 AND ((pgagent.pga_is_leap_year(date_part(&#39;DAY&#39;, nextrun)::int2) AND date_part(&#39;DAY&#39;, nextrun) = 29) OR date_part(&#39;DAY&#39;, nextrun) = 28))))) AND
            (jscmonths = &#39;{f,f,f,f,f,f,f,f,f,f,f,f}&#39; OR jscmonths[date_part(&#39;MONTH&#39;, nextrun)] = TRUE)) THEN


            -- Now, check to see if the nextrun time found is a) on an acceptable
            -- weekday, and b) not matched by an exception. If not, set
            -- runafter = nextrun and try again.

            -- Check for a wildcard weekday
            gotit := FALSE;
            FOR i IN 1 .. 7 LOOP
                IF jscweekdays[i] = TRUE THEN
                    gotit := TRUE;
                    EXIT;
                END IF;
            END LOOP;

            -- OK, is the correct weekday selected, or a wildcard?
            IF (jscweekdays[date_part(&#39;DOW&#39;, nextrun) + 1] = TRUE OR gotit = FALSE) THEN

                -- Check for exceptions
                SELECT INTO d jexid FROM pgagent.pga_exception WHERE jexscid = jscid AND ((jexdate = nextrun::date AND jextime = nextrun::time) OR (jexdate = nextrun::date AND jextime IS NULL) OR (jexdate IS NULL AND jextime = nextrun::time));
                IF FOUND THEN
                    -- Nuts - found an exception. Increment the time and try again
                    runafter := nextrun + INTERVAL &#39;1 Minute&#39;;
                    bingo := FALSE;
                    minutetweak := TRUE;
            daytweak := FALSE;
                ELSE
                    bingo := TRUE;
                END IF;
            ELSE
                -- We&#39;re on the wrong week day - increment a day and try again.
                runafter := nextrun + INTERVAL &#39;1 Day&#39;;
                bingo := FALSE;
                minutetweak := FALSE;
                daytweak := TRUE;
            END IF;

        ELSE
            runafter := nextrun + INTERVAL &#39;1 Minute&#39;;
            bingo := FALSE;
            minutetweak := TRUE;
        daytweak := FALSE;
        END IF;

    END LOOP;

    RETURN nextrun;
END;
</programlisting>
      </para>
    </section>

<!-- Function pga_schedule_trigger() -->
    <section id="pgagent.function.pga-schedule-trigger"
             xreflabel="pgagentpga_schedule_trigger()">
      <title id="pgagent.function.pga-schedule-trigger-title">
       pga_schedule_trigger()
      </title>
      <titleabbrev id="pgagent.function.pga-schedule-trigger-titleabbrev">
       pga_schedule_trigger()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Update the job&apos;s next run time whenever a schedule changes
        <programlisting>
BEGIN
    IF TG_OP = &#39;DELETE&#39; THEN
        -- update pga_job from remaining schedules
        -- the actual calculation of jobnextrun will be performed in the trigger
        UPDATE pgagent.pga_job
           SET jobnextrun = NULL
         WHERE jobenabled AND jobid=OLD.jscjobid;
        RETURN OLD;
    ELSE
        UPDATE pgagent.pga_job
           SET jobnextrun = NULL
         WHERE jobenabled AND jobid=NEW.jscjobid;
        RETURN NEW;
    END IF;
END;
</programlisting>
      </para>
    </section>

<!-- Function pgagent_schema_version() -->
    <section id="pgagent.function.pgagent-schema-version"
             xreflabel="pgagentpgagent_schema_version()">
      <title id="pgagent.function.pgagent-schema-version-title">
       pgagent_schema_version()
      </title>
      <titleabbrev id="pgagent.function.pgagent-schema-version-titleabbrev">
       pgagent_schema_version()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>smallint</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
BEGIN
    -- RETURNS PGAGENT MAJOR VERSION
    -- WE WILL CHANGE THE MAJOR VERSION, ONLY IF THERE IS A SCHEMA CHANGE
    RETURN 3;
END;
</programlisting>
      </para>
    </section>

  </chapter>

  <chapter id="public.schema"
           xreflabel="public">
    <title>Schema public</title>
    <para>standard public schema</para>


      <section id="public.table.-devices"
               xreflabel="public._devices">
        <title id="public.table.-devices-title">
         Table:
         
         <structname>_devices</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>_devices</structname>
            </title>


            <varlistentry>
              <term><structfield>idequipment</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>equipment</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>mark</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>model</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>serial_number</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

              <para>
                Numero de serie que viene en el producto
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>installation_date</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>uninstall_date</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>code_ref</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>










              </para>

              <para>
                Codigo para uso interno
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>operability</structfield></term>
              <listitem><para>
                <type>smallint</type>





                <literal>DEFAULT 100</literal>



              </para>

              <para>
                Porcentage de operatividad del equipo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idprovider</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>agreement_code_provider</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

              <para>
                Numero de contrato, numero o codigo con que el proveedor nos conoce.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>report_validator</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>










              </para>

              <para>
                Numero de validacion junto con el idequipment para aceptar eventos via http.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>eventtypes</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

              <para>
                Tipos de eventos que se van a monitorear de este equipo.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcustodian</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

              <para>
                corresponde al Idcontact de quien esta a cargo de ese equipo.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>additional_properties</structfield></term>
              <listitem><para>
                <type>jsonb</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>key</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on _devices</title>

          <varlistentry>
            <term>index_equipment_eq</term>
            <listitem><para>equipment</para></listitem>
          </varlistentry>

        </variablelist>





        <itemizedlist>
          <title>
            Tables referencing octopus.octopus_by_equipment via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="octopus.table.octopus-by-equipment"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="public.table.equipments-config-services"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="services.table.datas"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.address"
               xreflabel="public.address">
        <title id="public.table.address-title">
         Table:
         
         <structname>address</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>address</structname>
            </title>


            <varlistentry>
              <term><structfield>idaddress</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idtypeaddress</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>postal_code</structfield></term>
              <listitem><para>
                <type>character varying(10)</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geox</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geoy</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>high_street</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>side_street</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>reference</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing accounts.datas via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="accounts.table.datas"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.admins"
               xreflabel="public.admins">
        <title id="public.table.admins-title">
         Table:
         
         <structname>admins</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>admins</structname>
            </title>


            <varlistentry>
              <term><structfield>idadmin</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigserial</type>




                      <literal>UNIQUE</literal>








                <literal>NOT NULL</literal>








                <literal>REFERENCES</literal> <xref linkend="contacts.table.contacts"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_username</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_pwd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_sessionid</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_ip</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_level</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_role</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_locked_date</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_failed_access_attempts</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>appointment</structfield></term>
              <listitem><para>
                <type>text</type>





                <literal>DEFAULT &apos;Admin&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_access</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_heartbeat</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

              <para>
                Fecha de ultimo registro cuando el usuario estaba conectado, sirve para determinar que usuarios estan conectados y para cerrar session en X tiempo que no se tiene reporte del usuario.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>divisions</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

              <para>
                Division a la que el administrador tendra acceso.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccounts</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

              <para>
                Matriz de idaccounts asignados a este administrador
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>email_notification</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

              <para>
                Ids del email que se usara para notificaciones o informacion desde el sistema.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>xmpp_notification</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

              <para>
                ids de las cuentas de xmpp que se usaran para notificaciones al administrador.
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_attention_group</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

              <para>
                Grupos de atencion, para poder asignar tareas segun el grupo de atencion que tengan.
Puede pertenecer a diferenctes grupos de atencion.


              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.attachments"
               xreflabel="public.attachments">
        <title id="public.table.attachments-title">
         Table:
         
         <structname>attachments</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>attachments</structname>
            </title>


            <varlistentry>
              <term><structfield>idattachment</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>md5</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing events.comments_attachments via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="events.table.comments-attachments"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="public.table.attention-group"
               xreflabel="public.attention_group">
        <title id="public.table.attention-group-title">
         Table:
         
         <structname>attention_group</structname>
        </title>
 

        <para>
          Define los grupos de atencion
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>attention_group</structname>
            </title>


            <varlistentry>
              <term><structfield>idattention_group</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>group</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.configuration-server"
               xreflabel="public.configuration_server">
        <title id="public.table.configuration-server-title">
         Table:
         
         <structname>configuration_server</structname>
        </title>
 

        <para>
          Tabla de configuracion en JSON para el servidor
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>configuration_server</structname>
            </title>


            <varlistentry>
              <term><structfield>idconfigserver</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>config_name</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>configuration</structfield></term>
              <listitem><para>
                <type>json</type>



                <literal>NOT NULL</literal>





              </para>

              <para>
                Configuracion que sera usada por la aplicacion.
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.equipments-config-services"
               xreflabel="public.equipments_config_services">
        <title id="public.table.equipments-config-services-title">
         Table:
         
         <structname>equipments_config_services</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>equipments_config_services</structname>
            </title>


            <varlistentry>
              <term><structfield>idequipmentconfig</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>services</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>config</structfield></term>
              <listitem><para>
                <type>jsonb</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idequipment</structfield></term>
              <listitem><para>
                <type>bigint</type>








                      <literal>UNIQUE#1</literal>









                <literal>REFERENCES</literal> <xref linkend="public.table.-devices"/>




              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.eventtypes-groups"
               xreflabel="public.eventtypes_groups">
        <title id="public.table.eventtypes-groups-title">
         Table:
         
         <structname>eventtypes_groups</structname>
        </title>
 

        <para>
          No esta siendo usada esta tabla
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>eventtypes_groups</structname>
            </title>


            <varlistentry>
              <term><structfield>ideventtype_group</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>group</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>is_status</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.file-links"
               xreflabel="public.file_links">
        <title id="public.table.file-links-title">
         Table:
         
         <structname>file_links</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>file_links</structname>
            </title>


            <varlistentry>
              <term><structfield>idfilelinks</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dateloadfile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>path_file</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name_file</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>size_file</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.groups"
               xreflabel="public.groups">
        <title id="public.table.groups-title">
         Table:
         
         <structname>groups</structname>
        </title>
 

        <para>
          Grupos
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>groups</structname>
            </title>


            <varlistentry>
              <term><structfield>idgroup</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddivision</structfield></term>
              <listitem><para>
                <type>bigint</type>








                      <literal>UNIQUE#1</literal>









                <literal>REFERENCES</literal> <xref linkend="accounts.table.divisions"/>




              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.last-modified-cells"
               xreflabel="public.last_modified_cells">
        <title id="public.table.last-modified-cells-title">
         Table:
         
         <structname>last_modified_cells</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>last_modified_cells</structname>
            </title>


            <varlistentry>
              <term><structfield>idlastmodcell</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.network-devices"
               xreflabel="public.network_devices">
        <title id="public.table.network-devices-title">
         Table:
         
         <structname>network_devices</structname>
        </title>
 

        <para>
          Equipos que funcionan en red o estan conectados a una red y disponen de direccion IP.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>network_devices</structname>
            </title>


            <varlistentry>
              <term><structfield>idequipment</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;equipments_idequipment_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>equipment</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>





                      <literal>UNIQUE#2</literal>




                <literal>NOT NULL</literal>









              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>mark</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>model</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>serial_number</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>





                      <literal>UNIQUE#2</literal>




                <literal>NOT NULL</literal>









              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>installation_date</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>uninstall_date</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>code_ref</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#2</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>operability</structfield></term>
              <listitem><para>
                <type>smallint</type>





                <literal>DEFAULT 100</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idprovider</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>agreement_code_provider</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>report_validator</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>eventtypes</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcustodian</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>additional_properties</structfield></term>
              <listitem><para>
                <type>jsonb</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>key</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ip</structfield></term>
              <listitem><para>
                <type>inet</type>







              </para>

              <para>
                Direccion IP
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>mac</structfield></term>
              <listitem><para>
                <type>macaddr</type>




                      <literal>UNIQUE</literal>










              </para>

              <para>
                MAC
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>network_access_method</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>connection_speed</structfield></term>
              <listitem><para>
                <type>real</type>





                <literal>DEFAULT &apos;-100&apos;::integer</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>username</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pwd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>port</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>monitored</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on network_devices</title>

          <varlistentry>
            <term>index_network_devices_eq</term>
            <listitem><para>equipment</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="public.table.providers"
               xreflabel="public.providers">
        <title id="public.table.providers-title">
         Table:
         
         <structname>providers</structname>
        </title>
 

        <para>
          Lista de proveedores de productos y servicios
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>providers</structname>
            </title>


            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;contacts.contacts_idcontact_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>first_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>birthday</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>identification</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ididtype</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>postal_code</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>gender</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geox</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geoy</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>address</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>address_ref</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>groups</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>is_admin</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_start</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_end</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_username</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_pwd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_sessionid</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_ip</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_level</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>product_or_service</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="public.table.table-modification-log"
               xreflabel="public.table_modification_log">
        <title id="public.table.table-modification-log-title">
         Table:
         
         <structname>table_modification_log</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>table_modification_log</structname>
            </title>


            <varlistentry>
              <term><structfield>idtablemodif</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_modif</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on table_modification_log</title>

          <varlistentry>
            <term>index_tml_tname_sname</term>
            <listitem><para>table_name, schema_name</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="public.view.view-admins"
               xreflabel="public.view_admins">
        <title id="public.view.view-admins-title">
         View:
         
         <structname>view_admins</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_admins</structname>
            </title>


            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>contact_name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>appointment</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>birthday</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>identification</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ididtype</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>gender</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>address</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>groups</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idadmin</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_username</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_pwd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_sessionid</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_ip</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_level</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_role</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_locked_date</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_failed_access_attempts</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_access</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_heartbeat</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccounts</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>divisions</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_admins</title>
         <programlisting>
SELECT contacts.idcontact
,
    
(
     (contacts.last_name || &apos; &apos;::text) || contacts.first_name
) AS contact_name
,
    admins.appointment
,
    contacts.birthday
,
    contacts.identification
,
    contacts.ididtype
,
    contacts.gender
,
    contacts.address
,
    contacts.groups
,
    admins.idadmin
,
    admins.enabled
,
    admins.admin_start
,
    admins.admin_end
,
    admins.admin_username
,
    admins.admin_pwd
,
    admins.admin_sessionid
,
    admins.admin_ip
,
    admins.admin_level
,
    admins.admin_role
,
    admins.admin_locked_date
,
    admins.admin_failed_access_attempts
,
    admins.last_access
,
    admins.last_heartbeat
,
    admins.idaccounts
,
    admins.divisions
   
FROM admins
,
    contacts.contacts
  
WHERE (contacts.idcontact = admins.idcontact);</programlisting>
        </figure>



      </para>
    </section>

      <section id="public.view.view-contact-groups-they-belong"
               xreflabel="public.view_contact_groups_they_belong">
        <title id="public.view.view-contact-groups-they-belong-title">
         View:
         
         <structname>view_contact_groups_they_belong</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_contact_groups_they_belong</structname>
            </title>


            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idgroup</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp without time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ismember</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_contact_groups_they_belong</title>
         <programlisting>
SELECT fun_view_contact_groups_they_belong.idcontact
,
    fun_view_contact_groups_they_belong.idgroup
,
    fun_view_contact_groups_they_belong.ts
,
    fun_view_contact_groups_they_belong.ismember
,
    fun_view_contact_groups_they_belong.enabled
,
    fun_view_contact_groups_they_belong.name
,
    fun_view_contact_groups_they_belong.description
,
    fun_view_contact_groups_they_belong.note
   
FROM fun_view_contact_groups_they_belong
(
     (0)::bigint
) fun_view_contact_groups_they_belong
(idcontact
     , idgroup
     , ts
     , ismember
     , enabled
     , name
     , description
     , note
);</programlisting>
        </figure>



      </para>
    </section>

      <section id="public.view.view-contacts"
               xreflabel="public.view_contacts">
        <title id="public.view.view-contacts-title">
         View:
         
         <structname>view_contacts</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_contacts</structname>
            </title>


            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>contact_name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>birthday</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>identification</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ididtype</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>postal_code</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>gender</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geox</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>geoy</structfield></term>
              <listitem><para>
                <type>double precision</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>address</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>address_ref</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>groups</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_contacts</title>
         <programlisting>
SELECT contacts.idcontact
,
    contacts.ts
,
    contacts.enabled
,
    
(
     (contacts.last_name || &apos; &apos;::text) || contacts.first_name
) AS contact_name
,
    contacts.birthday
,
    contacts.identification
,
    contacts.ididtype
,
    contacts.postal_code
,
    contacts.gender
,
    contacts.geox
,
    contacts.geoy
,
    contacts.address
,
    contacts.address_ref
,
    contacts.groups
,
    contacts.note
   
FROM contacts.contacts;</programlisting>
        </figure>



      </para>
    </section>

      <section id="public.view.view-equipment-config"
               xreflabel="public.view_equipment_config">
        <title id="public.view.view-equipment-config-title">
         View:
         
         <structname>view_equipment_config</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_equipment_config</structname>
            </title>


            <varlistentry>
              <term><structfield>idequipment</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>report_validator</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>config</structfield></term>
              <listitem><para>
                <type>jsonb</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_equipment_config</title>
         <programlisting>
SELECT _devices.idequipment
,
    _devices.enabled
,
    _devices.report_validator
,
    equipments_config_services.footprint_row
,
    equipments_config_services.services AS file_name
,
    equipments_config_services.config
,
    equipments_config_services.description
   
FROM _devices
,
    equipments_config_services
  
WHERE (_devices.idequipment = equipments_config_services.idequipment);</programlisting>
        </figure>



      </para>
    </section>

      <section id="public.view.view-last-modif-tables"
               xreflabel="public.view_last_modif_tables">
        <title id="public.view.view-last-modif-tables-title">
         View:
         
         <structname>view_last_modif_tables</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_last_modif_tables</structname>
            </title>


            <varlistentry>
              <term><structfield>table_name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>schema_name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idtablemodif</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_modif</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_last_modif_tables</title>
         <programlisting>
SELECT DISTINCT 
ON (table_modification_log.schema_name
     , table_modification_log.table_name
) table_modification_log.table_name
,
    table_modification_log.schema_name
,
    table_modification_log.idtablemodif
,
    table_modification_log.datetime_modif
,
    
(
     (table_modification_log.schema_name || &apos;.&apos;::text) || table_modification_log.table_name
) AS tschema_tname
   
FROM table_modification_log
  
ORDER BY table_modification_log.schema_name
, table_modification_log.table_name
, table_modification_log.idtablemodif DESC;</programlisting>
        </figure>



      </para>
    </section>

      <section id="public.view.view-schema-table-column"
               xreflabel="public.view_schema_table_column">
        <title id="public.view.view-schema-table-column-title">
         View:
         
         <structname>view_schema_table_column</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_schema_table_column</structname>
            </title>


            <varlistentry>
              <term><structfield>idfield</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname_tcol</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_schema</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>domain_schema</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>domain_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>data_type</structfield></term>
              <listitem><para>
                <type>information_schema.character_data</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>udt_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_default</structfield></term>
              <listitem><para>
                <type>information_schema.character_data</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pk</structfield></term>
              <listitem><para>
                <type>boolean</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_parent</structfield></term>
              <listitem><para>
                <type>name</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_schema_table_column</title>
         <programlisting>
SELECT (md5
     (
           (
                 (
                       (
                             (
                                   (c.table_schema)::text || &apos;.&apos;::text
                             ) || 
                             (c.table_name)::text
                       ) || &apos;.&apos;::text
                 ) || 
                 (c.column_name)::text
           )
     )
)::uuid AS idfield
,
    
(
     (
           (c.table_schema)::text || &apos;.&apos;::text
     ) || 
     (c.table_name)::text
) AS tschema_tname
,
    
(
     (
           (
                 (
                       (c.table_schema)::text || &apos;.&apos;::text
                 ) || 
                 (c.table_name)::text
           ) || &apos;.&apos;::text
     ) || 
     (c.column_name)::text
) AS tschema_tname_tcol
,
    c.table_schema
,
    c.table_name
,
    c.domain_schema
,
    c.domain_name
,
    c.column_name
,
    c.data_type
,
    c.udt_name
,
    c.column_default
,
    
(EXISTS 
     (
      SELECT t.table_catalog
           ,
            t.table_schema
           ,
            t.table_name
           ,
            t.table_type
           ,
            t.self_referencing_column_name
           ,
            t.reference_generation
           ,
            t.user_defined_type_catalog
           ,
            t.user_defined_type_schema
           ,
            t.user_defined_type_name
           ,
            t.is_insertable_into
           ,
            t.is_typed
           ,
            t.commit_action
           ,
            tc.constraint_catalog
           ,
            tc.constraint_schema
           ,
            tc.constraint_name
           ,
            tc.table_catalog
           ,
            tc.table_schema
           ,
            tc.table_name
           ,
            tc.constraint_type
           ,
            tc.is_deferrable
           ,
            tc.initially_deferred
           ,
            kcu.constraint_catalog
           ,
            kcu.constraint_schema
           ,
            kcu.constraint_name
           ,
            kcu.table_catalog
           ,
            kcu.table_schema
           ,
            kcu.table_name
           ,
            kcu.column_name
           ,
            kcu.ordinal_position
           ,
            kcu.position_in_unique_constraint
           
        FROM (
                 (information_schema.tables t
             
               LEFT JOIN information_schema.table_constraints tc 
                      ON (
                             (
                                   (
                                         (tc.table_catalog)::text = 
                                         (t.table_catalog)::text
                                   )
                                 AND (
                                         (tc.table_schema)::text = 
                                         (t.table_schema)::text
                                   )
                                 AND (
                                         (tc.table_name)::text = 
                                         (t.table_name)::text
                                   )
                                 AND (
                                         (tc.constraint_type)::text = &apos;PRIMARY KEY&apos;::text
                                   )
                             )
                       )
                 )
             
         LEFT JOIN information_schema.key_column_usage kcu 
                ON (
                       (
                             (
                                   (kcu.table_catalog)::text = 
                                   (tc.table_catalog)::text
                             )
                           AND (
                                   (kcu.table_schema)::text = 
                                   (tc.table_schema)::text
                             )
                           AND (
                                   (kcu.table_name)::text = 
                                   (tc.table_name)::text
                             )
                           AND (
                                   (kcu.constraint_name)::text = 
                                   (tc.constraint_name)::text
                             )
                       )
                 )
           )
          
       WHERE (
                 (
                       (t.table_schema)::text = 
                       (c.table_schema)::text
                 )
               AND (
                       (t.table_name)::text = 
                       (c.table_name)::text
                 )
               AND (
                       (kcu.column_name)::text = 
                       (c.column_name)::text
                 )
               AND (
                       (t.table_schema)::text &lt;&gt; ALL 
                       (ARRAY[
                             (&apos;pg_catalog&apos;::character varying)::text
                             , (&apos;information_schema&apos;::character varying)::text]
                       )
                 )
           )
     )
) AS pk
,
    
(
SELECT pg_class.relname
           
  FROM pg_class
          
 WHERE (pg_class.oid = 
           (
            SELECT pg_inherits.inhparent
                   
              FROM pg_inherits
                  
             WHERE (pg_inherits.inhrelid = 
                       (
                             (
                                   (
                                         (
                                               (c.table_schema)::text || &apos;.&apos;::text
                                         ) || 
                                         (c.table_name)::text
                                   )
                             )::regclass
                       )::oid
                 )
                 LIMIT 1
           )
     )
) AS table_parent
   
FROM information_schema.columns c
  
WHERE (
     (c.table_schema)::text = ANY 
     (ARRAY[
           (&apos;public&apos;::character varying)::text
           , (&apos;events&apos;::character varying)::text
           , (&apos;scheduled_tasks&apos;::character varying)::text
           , (&apos;gui&apos;::character varying)::text
           , (&apos;secondary&apos;::character varying)::text]
     )
)
  
ORDER BY c.table_schema
, c.table_name
, c.column_name;</programlisting>
        </figure>



      </para>
    </section>

      <section id="public.view.view-table-schema"
               xreflabel="public.view_table_schema">
        <title id="public.view.view-table-schema-title">
         View:
         
         <structname>view_table_schema</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_table_schema</structname>
            </title>


            <varlistentry>
              <term><structfield>hash_num</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tschema_tname</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_schema</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>table_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_name</structfield></term>
              <listitem><para>
                <type>information_schema.sql_identifier</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>data_type</structfield></term>
              <listitem><para>
                <type>information_schema.character_data</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>column_default</structfield></term>
              <listitem><para>
                <type>information_schema.character_data</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_table_schema</title>
         <programlisting>
SELECT md5
(
     (
           (
                 (columns.table_schema)::text || 
                 (columns.table_name)::text
           ) || 
           (columns.column_name)::text
     )
) AS hash_num
,
    
(
     (
           (columns.table_schema)::text || &apos;.&apos;::text
     ) || 
     (columns.table_name)::text
) AS tschema_tname
,
    columns.table_schema
,
    columns.table_name
,
    columns.column_name
,
    columns.data_type
,
    columns.column_default
   
FROM information_schema.columns
  
WHERE (
     (columns.table_schema)::text = ANY 
     (ARRAY[
           (&apos;public&apos;::character varying)::text
           , (&apos;events&apos;::character varying)::text
           , (&apos;scheduled_tasks&apos;::character varying)::text
           , (&apos;gui&apos;::character varying)::text
           , (&apos;secondary&apos;::character varying)::text]
     )
);</programlisting>
        </figure>



      </para>
    </section>



<!-- Function _on_changed_table() -->
    <section id="public.function.-on-changed-table"
             xreflabel="public_on_changed_table()">
      <title id="public.function.-on-changed-table-title">
       _on_changed_table()
      </title>
      <titleabbrev id="public.function.-on-changed-table-titleabbrev">
       _on_changed_table()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Debe ser disparado despues de que la tabla ha sufrido cambios.
        <programlisting>DECLARE

parent_table TEXT DEFAULT &#39;&#39;;

BEGIN

CASE
WHEN TG_TABLE_NAME ILIKE &#39;datas_%&#39; AND TG_TABLE_SCHEMA = &#39;events&#39; THEN
parent_table:= &#39;datas&#39;;

WHEN TG_TABLE_NAME ILIKE &#39;comments_%&#39; AND TG_TABLE_SCHEMA = &#39;events&#39;  THEN
parent_table:= &#39;comments&#39;;

ELSE
parent_table:= TG_TABLE_NAME;

END CASE;
    
/*
INSERT INTO table_modification_log(
            table_name, schema_name)
    VALUES (parent_table, TG_TABLE_SCHEMA);
*/


INSERT INTO table_modification_log(
            table_name, schema_name)
    VALUES (parent_table, TG_TABLE_SCHEMA)  ON CONFLICT (table_name, schema_name) DO UPDATE SET datetime_modif = now();

/*

RAISE NOTICE &#39;1) Inicia Trigger on_changed_table&#39;;

UPDATE sys_table_ts SET ts = now() WHERE table_name = TG_TABLE_NAME;
RAISE NOTICE &#39;2) Se ha actualizado&#39;;

        IF NOT found THEN
RAISE NOTICE &#39;3) Registro no encontrado, se crea uno nuevo&#39;;
INSERT INTO sys_table_ts (table_name) VALUES (TG_TABLE_NAME);
        END IF;

RAISE NOTICE &#39;4) Termina on_changed_table&#39;;


BEGIN

CASE
WHEN TG_TABLE_NAME ILIKE &#39;events_%&#39; THEN
parent_table:= &#39;events&#39;;
WHEN TG_TABLE_NAME ILIKE &#39;event_comments_%&#39; THEN
parent_table:= &#39;event_comments&#39;;
ELSE

END CASE;


IF LENGTH(parent_table) &gt; 0 THEN

UPDATE sys_table_ts SET ts = now() WHERE table_name = parent_table;
RAISE NOTICE &#39;A) Se ha actualizado tabla padre %&#39;,parent_table;

        IF NOT found THEN
RAISE NOTICE &#39;B) Registro no encontrado, se crea uno nuevo %&#39;,parent_table;
INSERT INTO sys_table_ts (table_name) VALUES (parent_table);
        END IF;

END IF;



END;
*/

RETURN NULL;
END;</programlisting>
      </para>
    </section>

<!-- Function _on_update_row_update_ts() -->
    <section id="public.function.-on-update-row-update-ts"
             xreflabel="public_on_update_row_update_ts()">
      <title id="public.function.-on-update-row-update-ts-title">
       _on_update_row_update_ts()
      </title>
      <titleabbrev id="public.function.-on-update-row-update-ts-titleabbrev">
       _on_update_row_update_ts()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Debe ser disparado antes de actualizar un registro de una tabla para que el campo ts sea actualizado.
        <programlisting>
BEGIN

RAISE NOTICE &#39;1) on_update_row_update_ts&#39;;


	NEW.footprint_row = (random() * 9999 + 1 )::smallint;
   NEW.ts = now(); 
   RETURN NEW;
END;
</programlisting>
      </para>
    </section>

<!-- Function accounts_insert_update() -->
    <section id="public.function.accounts-insert-update"
             xreflabel="publicaccounts_insert_update()">
      <title id="public.function.accounts-insert-update-title">
       accounts_insert_update()
      </title>
      <titleabbrev id="public.function.accounts-insert-update-titleabbrev">
       accounts_insert_update()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Realiza validacion de datos antes de insertar en la tabla.
        <programlisting>BEGIN

-- Si la fecha de fin es NULL se la setea a la fecha de inicio + 10 aos
IF NEW.end_date &lt; NEW.start_date OR NEW.end_date IS NULL THEN  
NEW.end_date := NEW.start_date+ interval &#39;15 year&#39;;
END IF;  

-- Cuando se inserta o actualiza un registro se verifica que no haya un numero de cuenta igual, caso contrario devuelve uno disponible
CASE 
    WHEN TG_OP = &#39;INSERT&#39; THEN

    IF NEW.iddivision IS NULL AND EXISTS(SELECT iddivision FROM divisions WHERE iddivision = 0) THEN
	NEW.iddivision := 0;
      END IF;
      
        NEW.account := fun_account_auto_account(NEW.account, NEW.iddivision);

    WHEN TG_OP = &#39;UPDATE&#39; AND EXISTS(SELECT idcontact FROM accounts WHERE idcontact != NEW.idcontact AND account = NEW.account AND iddivision = NEW.iddivision) THEN
        NEW.account := fun_account_auto_account(NEW.account, NEW.iddivision);
    ELSE
      --  msg := &#39;other value than one or two&#39;;
END CASE;

--NEW.note := TG_WHEN;

NEW.admins := ARRAY(SELECT DISTINCT UNNEST(NEW.admins::INTEGER[]) ORDER BY 1);
-- TODO Verificar que los grupos ingresados pertenescan a el iddivision registrado, caso contrario eliminarlos
NEW.groups := ARRAY(SELECT DISTINCT UNNEST(NEW.groups::INTEGER[]) ORDER BY 1);

-- setea end_date = a start_date si la fecha end_date es menor que start_date
IF NEW.end_date &lt; NEW.start_date THEN  
NEW.end_date := NEW.start_date;
END IF;    


	
RETURN NEW;
END;</programlisting>
      </para>
    </section>

<!-- Function admins_insert_update() -->
    <section id="public.function.admins-insert-update"
             xreflabel="publicadmins_insert_update()">
      <title id="public.function.admins-insert-update-title">
       admins_insert_update()
      </title>
      <titleabbrev id="public.function.admins-insert-update-titleabbrev">
       admins_insert_update()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN


--  Creamos un username si no es proporcionado
IF NEW.admin_username IS NULL OR LENGTH(NEW.admin_username) &lt; 1 THEN
--NEW.admin_username :=  NEW.identification; 

SELECT identification INTO NEW.admin_username FROM contacts WHERE idcontact = NEW.idcontact;
END IF;

-- creamos una clave igual al md5 del user_name si no es proporcionada.
IF NEW.admin_pwd IS NULL OR LENGTH(NEW.admin_pwd) &lt; 1 THEN
 NEW.admin_pwd := md5(NEW.admin_username::TEXT); 
END IF;

/*
-- Clave como md5
IF TG_OP = &#39;UPDATE&#39; THEN
NEW.admin_pwd := md5(NEW.admin_pwd::TEXT);
END IF;
*/

-- setea end_date = a start_date si la fecha end_date es menor que start_date
IF NEW.admin_end &lt; NEW.admin_start OR NEW.admin_end IS NULL THEN  
NEW.admin_end := NEW.admin_start+ interval &#39;1 year&#39;;
END IF;  

RETURN NEW;
END;
</programlisting>
      </para>
    </section>

<!-- Function admins_update_admin_pwd() -->
    <section id="public.function.admins-update-admin-pwd"
             xreflabel="publicadmins_update_admin_pwd()">
      <title id="public.function.admins-update-admin-pwd-title">
       admins_update_admin_pwd()
      </title>
      <titleabbrev id="public.function.admins-update-admin-pwd-titleabbrev">
       admins_update_admin_pwd()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

-- creamos una clave igual al md5 del numero de identificacion si no es proporcionada.
IF NEW.admin_pwd IS NULL OR LENGTH(NEW.admin_pwd) &lt; 1 THEN
NEW.admin_pwd := md5(NEW.identification::TEXT);
END IF;

-- Clave como md5
IF TG_OP = &#39;UPDATE&#39; THEN
NEW.admin_pwd := md5(NEW.admin_pwd::TEXT);
END IF;


RETURN NEW;
END;</programlisting>
      </para>
    </section>

<!-- Function before_update_row() -->
    <section id="public.function.before-update-row"
             xreflabel="publicbefore_update_row()">
      <title id="public.function.before-update-row-title">
       before_update_row()
      </title>
      <titleabbrev id="public.function.before-update-row-titleabbrev">
       before_update_row()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
BEGIN

NEW._foot_print_ = (random() * 9999 + 1 )::smallint;
NEW._lm_ = now(); 
   RETURN NEW;
END;

</programlisting>
      </para>
    </section>

<!-- Function contacts_insert_update() -->
    <section id="public.function.contacts-insert-update"
             xreflabel="publiccontacts_insert_update()">
      <title id="public.function.contacts-insert-update-title">
       contacts_insert_update()
      </title>
      <titleabbrev id="public.function.contacts-insert-update-titleabbrev">
       contacts_insert_update()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

-- Si no se ha ingresado el campo identification se crea uno automaticamente
IF NEW.identification IS NULL THEN
NEW.identification :=  md5(extract(epoch FROM now())::TEXT);
END IF;
/*
IF NEW.is_admin IS TRUE THEN

--  Creamos un username si no es proporcionado
IF NEW.admin_username IS NULL OR LENGTH(NEW.admin_username) &lt; 1 THEN
NEW.admin_username :=  NEW.identification;
END IF;


-- creamos una clave igual al md5 del numero de identificacion si no es proporcionada.
IF NEW.admin_pwd IS NULL OR LENGTH(NEW.admin_pwd) &lt; 1 THEN
NEW.admin_pwd := md5(NEW.identification::TEXT);
END IF;

-- Clave como md5
IF TG_OP = &#39;UPDATE&#39; THEN
NEW.admin_pwd := md5(NEW.admin_pwd::TEXT);
END IF;


-- setea end_date = a start_date si la fecha end_date es menor que start_date
IF NEW.admin_end &lt; NEW.admin_start OR NEW.admin_end IS NULL THEN  
NEW.admin_end := NEW.admin_start+ interval &#39;1 year&#39;;
END IF;  

END IF;
*/

/*
INSERT INTO contacts(
            idcontact, ts, enabled, first_name, last_name, birthday, identification, 
            ididtype, postal_code, gender, geox, geoy, note, address, address_ref, 
            is_admin, admin_start, admin_end, admin_username, admin_pwd, 
            admin_sessionid, admin_ip, admin_level)
    VALUES (?, ?, ?, ?, ?, ?, ?, 
            ?, ?, ?, ?, ?, ?, ?, ?, 
            ?, ?, ?, ?, ?, 
            ?, ?, ?);
            */
--NEW.ts := now();

RETURN NEW;
END;
</programlisting>
      </para>
    </section>

<!-- Function contacts_update_admin_pwd() -->
    <section id="public.function.contacts-update-admin-pwd"
             xreflabel="publiccontacts_update_admin_pwd()">
      <title id="public.function.contacts-update-admin-pwd-title">
       contacts_update_admin_pwd()
      </title>
      <titleabbrev id="public.function.contacts-update-admin-pwd-titleabbrev">
       contacts_update_admin_pwd()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       Devuelve el md5 de la clave ingresada cuando se actualiza.
        <programlisting>BEGIN

-- creamos una clave igual al md5 del numero de identificacion si no es proporcionada.
IF NEW.admin_pwd IS NULL OR LENGTH(NEW.admin_pwd) &lt; 1 THEN
NEW.admin_pwd := md5(NEW.identification::TEXT);
END IF;

-- Clave como md5
IF TG_OP = &#39;UPDATE&#39; THEN
NEW.admin_pwd := md5(NEW.admin_pwd::TEXT);
END IF;


RETURN NEW;
END;</programlisting>
      </para>
    </section>

<!-- Function create_constraint_if_not_exists(constraint_sql text, c_name text, t_name text, t_schema text) -->
    <section id="public.function.create-constraint-if-not-exists-constraint-sql-text-c-name-text-t-name-text-t-schema-text"
             xreflabel="publiccreate_constraint_if_not_exists(constraint_sql text, c_name text, t_name text, t_schema text)">
      <title id="public.function.create-constraint-if-not-exists-constraint-sql-text-c-name-text-t-name-text-t-schema-text-title">
       create_constraint_if_not_exists(constraint_sql text, c_name text, t_name text, t_schema text)
      </title>
      <titleabbrev id="public.function.create-constraint-if-not-exists-constraint-sql-text-c-name-text-t-name-text-t-schema-text-titleabbrev">
       create_constraint_if_not_exists(constraint_sql text, c_name text, t_name text, t_schema text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>void</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
begin

--&#39;ALTER TABLE foo ADD CONSTRAINT bar CHECK (foobies &lt; 100);&#39;) 



    -- Look for our constraint
    if not exists (select constraint_name, * 
                   from information_schema.constraint_column_usage 
                   where table_name = t_name  and constraint_name = c_name AND table_schema = t_schema) then
        execute &#39;ALTER TABLE &#39;||t_schema||&#39;.&#39;||t_name||&#39; ADD CONSTRAINT &#39;|| c_name || &#39; &#39; ||constraint_sql;
    end if;
end;
</programlisting>
      </para>
    </section>

<!-- Function devices_check_fields() -->
    <section id="public.function.devices-check-fields"
             xreflabel="publicdevices_check_fields()">
      <title id="public.function.devices-check-fields-title">
       devices_check_fields()
      </title>
      <titleabbrev id="public.function.devices-check-fields-titleabbrev">
       devices_check_fields()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

IF NEW.serial_number IS NULL OR  LENGTH(NEW.serial_number) &lt; 1 THEN
NEW.serial_number :=  md5(extract(epoch FROM now())::TEXT||random()::TEXT);
END IF;

IF NEW.keydev IS NULL OR  LENGTH(NEW.keydev::TEXT) &lt; 1 THEN
NEW.keydev :=  md5(NEW.iddevice::TEXT||now()::TEXT);
END IF;


/*
IF NOT EXISTS(SELECT idcontact FROM accounts WHERE idcontact = NEW.idaccount LIMIT 1) THEN
NEW.idaccount :=  NULL;
END IF;
*/

--RAISE NOTICE &#39;1) *** idequipment (%) idaccount (%) -&gt; %&#39;, NEW.idequipment, NEW.idaccount, TG_TABLE_NAME;

/*
INSERT INTO equipments(
            idequipment, ts, equipment, mark, model, serial_number, description, 
            installation_date, uninstall_date, working, note, code_ref, idaccount)
    VALUES (?, ?, ?, ?, ?, ?, ?, 
            ?, ?, ?, ?, ?, ?);

            */
--NEW.ts := now();

RETURN NEW;
END;

</programlisting>
      </para>
    </section>

<!-- Function equipment_insert_update() -->
    <section id="public.function.equipment-insert-update"
             xreflabel="publicequipment_insert_update()">
      <title id="public.function.equipment-insert-update-title">
       equipment_insert_update()
      </title>
      <titleabbrev id="public.function.equipment-insert-update-titleabbrev">
       equipment_insert_update()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

IF NEW.serial_number IS NULL OR  LENGTH(NEW.serial_number) &lt; 1 THEN
NEW.serial_number :=  md5(extract(epoch FROM now())::TEXT||random()::TEXT);
END IF;

IF NEW.code_ref IS NULL OR  LENGTH(NEW.code_ref) &lt; 1 THEN
NEW.code_ref :=  NEW.serial_number;
END IF;

IF NEW.report_validator IS NULL OR  LENGTH(NEW.report_validator) &lt; 16 THEN
NEW.report_validator :=  md5(NEW.idequipment::TEXT||NEW.code_ref);
END IF;

/*
IF NOT EXISTS(SELECT idcontact FROM accounts WHERE idcontact = NEW.idaccount LIMIT 1) THEN
NEW.idaccount :=  NULL;
END IF;
*/


RAISE NOTICE &#39;1) *** idequipment (%) idaccount (%) -&gt; %&#39;, NEW.idequipment, NEW.idaccount, TG_TABLE_NAME;


/*
INSERT INTO equipments(
            idequipment, ts, equipment, mark, model, serial_number, description, 
            installation_date, uninstall_date, working, note, code_ref, idaccount)
    VALUES (?, ?, ?, ?, ?, ?, ?, 
            ?, ?, ?, ?, ?, ?);

            */
--NEW.ts := now();

RETURN NEW;
END;
</programlisting>
      </para>
    </section>

<!-- Function fun_account_auto_account(idivision text, iaccount bigint) -->
    <section id="public.function.fun-account-auto-account-idivision-text-iaccount-bigint"
             xreflabel="publicfun_account_auto_account(idivision text, iaccount bigint)">
      <title id="public.function.fun-account-auto-account-idivision-text-iaccount-bigint-title">
       fun_account_auto_account(idivision text, iaccount bigint)
      </title>
      <titleabbrev id="public.function.fun-account-auto-account-idivision-text-iaccount-bigint-titleabbrev">
       fun_account_auto_account(idivision text, iaccount bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

r TEXT DEFAULT &#39;oams&#39;;
i INTEGER DEFAULT 0;

BEGIN

IF iaccount IS NULL OR LENGTH(iaccount) &lt; 1 THEN
iaccount := &#39;oams&#39;;
END IF;

r := iaccount;
RAISE NOTICE &#39;Asignado r(%)&#39;, r;
-- Chequeamo que el numero de la cuenta no se repita, si lo hace buscamos el siguiente numero disponible
WHILE EXISTS(SELECT * FROM accounts WHERE account = r AND iddivision = idivision) AND i &lt; 10 LOOP
    r := iaccount||&#39;(&#39;||i::text||&#39;)&#39;;
RAISE NOTICE &#39;Asignado rx(%)&#39;, r;
i := i+1;
END LOOP;



/*
SELECT idcontact, ts, enabled, first_name, last_name, birthday, identification, 
       ididtype, postal_code, gender, geox, geoy, note, address, address_ref, 
       idaccountstate, idaccounttype, start_date, end_date, account
  FROM accounts;

*/

/*
-- Chequeamo que el numero de la cuenta no se repita, si lo hace buscamos el siguiente numero disponible
WHILE usaga.fun_account_search_number(iaccount) &gt; 0 LOOP
    inaccount := initialaccount||&#39;(&#39;||i::text||&#39;)&#39;;
i := i+1;
END LOOP;
*/
RAISE NOTICE &#39;Asignado rs(%)&#39;, r;

RETURN  r;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_check_sessionid_idadmin(iip text, isessionid text, iusername text) -->
    <section id="public.function.fun-check-sessionid-idadmin-iip-text-isessionid-text-iusername-text"
             xreflabel="publicfun_check_sessionid_idadmin(iip text, isessionid text, iusername text)">
      <title id="public.function.fun-check-sessionid-idadmin-iip-text-isessionid-text-iusername-text-title">
       fun_check_sessionid_idadmin(iip text, isessionid text, iusername text)
      </title>
      <titleabbrev id="public.function.fun-check-sessionid-idadmin-iip-text-isessionid-text-iusername-text-titleabbrev">
       fun_check_sessionid_idadmin(iip text, isessionid text, iusername text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

--Now timestamp without time zone default now();
R INTEGER DEFAULT 1;

BEGIN
/*
R := COALESCE((SELECT idcontact FROM contacts WHERE admin_username = iusername AND admin_sessionid = isessionid AND is_admin = true LIMIT 1), -200);

IF R &lt; 1 THEN
--PERFORM fun_event_insert_by_ideventtype(now()::timestamp without time zone, 0, 0, 0, 1004, &#39;Unauthorized user &#39;||iusername::text, 0);
INSERT INTO events(
            status, idaccount, ideventtype, description)
    VALUES (0, 0, 1004, &#39;Unauthorized user &#39;||iusername::text||&#39; from IP &#39;||iip::text);

END IF;
*/

RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_create_table_partition(idatetimeevent text, inherts_table timestamp with time zone) -->
    <section id="public.function.fun-create-table-partition-idatetimeevent-text-inherts-table-timestamp-with-time-zone"
             xreflabel="publicfun_create_table_partition(idatetimeevent text, inherts_table timestamp with time zone)">
      <title id="public.function.fun-create-table-partition-idatetimeevent-text-inherts-table-timestamp-with-time-zone-title">
       fun_create_table_partition(idatetimeevent text, inherts_table timestamp with time zone)
      </title>
      <titleabbrev id="public.function.fun-create-table-partition-idatetimeevent-text-inherts-table-timestamp-with-time-zone-titleabbrev">
       fun_create_table_partition(idatetimeevent text, inherts_table timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

part TEXT DEFAULT &#39;19000101&#39;;

BEGIN

part := inherts_table||&#39;_&#39;||fun_sufix_name_by_date(idatetimeevent)::TEXT;

IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE  table_schema = &#39;public&#39; AND table_name = part LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS public.&#39;||part::TEXT||&#39;(
   LIKE public.&#39;||inherts_table||&#39; INCLUDING DEFAULTS INCLUDING CONSTRAINTS INCLUDING INDEXES INCLUDING STORAGE INCLUDING COMMENTS
) 
INHERITS (&#39;||inherts_table||&#39;)
WITH (
  OIDS = FALSE,
  toast.autovacuum_enabled=true
);&#39;;


-- Trigger: on_changed_table on events

-- DROP TRIGGER on_changed_table ON events;

EXECUTE &#39;CREATE TRIGGER on_changed_table
  AFTER INSERT OR UPDATE OR DELETE
  ON &#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_changed_table();&#39;;

-- Trigger: on_insert_event on events

-- DROP TRIGGER on_insert_event ON events;
/*
EXECUTE &#39;CREATE TRIGGER on_insert_event
  AFTER INSERT
  ON &#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE events_on_insert();&#39;;
  */

-- Trigger: on_update_row on events

-- DROP TRIGGER on_update_row ON events;

EXECUTE &#39;CREATE TRIGGER on_update_row
  BEFORE UPDATE
  ON &#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_update_row_update_ts();&#39;;

END IF;


RETURN part;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_create_table_partition_events_data(idatetimeevent text, inherts_table timestamp with time zone) -->
    <section id="public.function.fun-create-table-partition-events-data-idatetimeevent-text-inherts-table-timestamp-with-time-zone"
             xreflabel="publicfun_create_table_partition_events_data(idatetimeevent text, inherts_table timestamp with time zone)">
      <title id="public.function.fun-create-table-partition-events-data-idatetimeevent-text-inherts-table-timestamp-with-time-zone-title">
       fun_create_table_partition_events_data(idatetimeevent text, inherts_table timestamp with time zone)
      </title>
      <titleabbrev id="public.function.fun-create-table-partition-events-data-idatetimeevent-text-inherts-table-timestamp-with-time-zone-titleabbrev">
       fun_create_table_partition_events_data(idatetimeevent text, inherts_table timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

part TEXT DEFAULT &#39;19000101&#39;;
constraint_name_table TEXT DEFAULT &#39;_dateevent_check&#39;;
dateevent_year INTEGER DEFAULT 1990; 

BEGIN

part := inherts_table||&#39;_&#39;||fun_sufix_name_by_date(idatetimeevent)::TEXT;

IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE  table_schema = &#39;events_data&#39; AND table_name = part LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS events_data.&#39;||part::TEXT||&#39;(
   LIKE public.&#39;||inherts_table||&#39; INCLUDING DEFAULTS INCLUDING CONSTRAINTS INCLUDING INDEXES INCLUDING STORAGE INCLUDING COMMENTS
) 
INHERITS (&#39;||inherts_table||&#39;)
WITH (
  OIDS = FALSE,
  toast.autovacuum_enabled=true
);&#39;;


-- Trigger: on_changed_table on events

-- DROP TRIGGER on_changed_table ON events;

EXECUTE &#39;CREATE TRIGGER on_changed_table
  AFTER INSERT OR UPDATE OR DELETE
  ON events_data.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_changed_table();&#39;;

-- Trigger: on_update_row on events

-- DROP TRIGGER on_update_row ON events;

EXECUTE &#39;CREATE TRIGGER on_update_row
  BEFORE UPDATE
  ON events_data.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_update_row_update_ts();&#39;;


  constraint_name_table := part ||&#39;_dateevent_check&#39;; 
  dateevent_year := Extract(year FROM idatetimeevent); 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;CHECK&#39; 
           AND    table_name = part 
           AND    constraint_schema = &#39;events_data&#39; 
           AND    constraint_name = constraint_name_table ) THEN 
    EXECUTE &#39;ALTER TABLE events_data.&#39; 
    ||part::text 
    ||&#39;   ADD CONSTRAINT &#39; 
    ||constraint_name_table::text 
    ||&#39; CHECK (EXTRACT(YEAR FROM dateevent) = &#39; 
    ||dateevent_year::text 
    ||&#39;::double precision);&#39;; 
  END IF ; 



-----------------------------------------------

-------------------------
  IF NOT EXISTS 
    ( 
           SELECT trigger_name 
           FROM   information_schema.TRIGGERS 
           WHERE  event_object_table = part 
           AND    event_object_schema = &#39;events_data&#39; 
           AND    trigger_name = &#39;on_insert_event&#39; ) THEN 
    ---------------------- 
    EXECUTE &#39;CREATE TRIGGER on_insert_event   AFTER INSERT   ON events_data.&#39; 
    ||part::text 
    ||&#39;   FOR EACH ROW   EXECUTE PROCEDURE events_on_insert();&#39;; 
  END IF ; 

  
  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;FOREIGN KEY&#39; 
           AND    constraint_schema = &#39;events_data&#39;            
           AND    table_name = part 
           AND    constraint_name = &#39;fk_&#39; 
                         ||part 
                         ||&#39;_idadmin&#39;) THEN 
    EXECUTE &#39;ALTER TABLE events_data.&#39; 
    ||part 
    ||&#39;  ADD CONSTRAINT fk_&#39; 
    ||part 
    ||&#39;_idadmin FOREIGN KEY (idadmin) REFERENCES admins (idadmin)  ON UPDATE CASCADE ON DELETE CASCADE;&#39;;
  END IF; 
  
  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;FOREIGN KEY&#39; 
           AND    constraint_schema = &#39;events_data&#39;                       
           AND    table_name = part 
           AND    constraint_name = &#39;fk_&#39; 
                         ||part 
                         ||&#39;_ideventreceptionmode&#39;) THEN 
    EXECUTE &#39;ALTER TABLE events_data.&#39; 
    ||part 
    ||&#39;  ADD CONSTRAINT fk_&#39; 
    ||part 
    ||&#39;_ideventreceptionmode FOREIGN KEY (ideventreceptionmode) REFERENCES event_reception_modes (ideventreceptionmode)  ON UPDATE CASCADE ON DELETE SET NULL;&#39;;
  END IF; 



  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   information_schema.table_constraints 
           WHERE  constraint_type = &#39;FOREIGN KEY&#39;
	   AND    constraint_schema = &#39;events_data&#39;                       
           AND    table_name = part 
           AND    constraint_name = &#39;fk_&#39; 
                         ||part 
                         ||&#39;_ideventtype&#39;) THEN 
    EXECUTE &#39;ALTER TABLE events_data.&#39; 
    ||part 
    ||&#39;  ADD CONSTRAINT fk_&#39; 
    ||part 
    ||&#39;_ideventtype FOREIGN KEY (ideventtype) REFERENCES eventtypes (ideventtype)  ON UPDATE CASCADE ON DELETE SET NULL;&#39;;
  END IF; 

  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   pg_indexes 
           WHERE  tablename = part 
           AND schemaname = &#39;events_data&#39;
           AND    indexname = &#39;index_&#39; 
                         ||part 
                         ||&#39;_isopen&#39;) THEN 
    EXECUTE &#39; CREATE UNIQUE INDEX index_&#39; 
    ||part 
    ||&#39;_isopen   ON events_data.&#39; 
    ||part 
    ||&#39; USING btree (dateevent, ideventstatustype, idaccount, ideventtype, zu, idequipment)
  WHERE isopen = true;&#39;; 
  END IF; 


  ---------------------- 
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   pg_indexes 
           WHERE  tablename = part 
           AND schemaname = &#39;events_data&#39;           
           AND    indexname = &#39;index_&#39; 
                         ||part 
                         ||&#39;_idaccideventt&#39;) THEN 
    EXECUTE &#39; CREATE INDEX index_&#39; 
    ||part 
    ||&#39;_idaccideventt   ON events_data.&#39; 
    ||part 
    ||&#39; USING btree (idaccount, ideventtype)&#39;; 
  END IF; 




  
  

END IF;


RETURN part;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_edit_event_comments(fun_msg integer, fun_return integer, iidevent timestamp without time zone, istatus integer, icomment_event text, iseconds integer, istart bigint) -->
    <section id="public.function.fun-edit-event-comments-fun-msg-integer-fun-return-integer-iidevent-timestamp-without-time-zone-istatus-integer-icomment-event-text-iseconds-integer-istart-bigint"
             xreflabel="publicfun_edit_event_comments(fun_msg integer, fun_return integer, iidevent timestamp without time zone, istatus integer, icomment_event text, iseconds integer, istart bigint)">
      <title id="public.function.fun-edit-event-comments-fun-msg-integer-fun-return-integer-iidevent-timestamp-without-time-zone-istatus-integer-icomment-event-text-iseconds-integer-istart-bigint-title">
       fun_edit_event_comments(fun_msg integer, fun_return integer, iidevent timestamp without time zone, istatus integer, icomment_event text, iseconds integer, istart bigint)
      </title>
      <titleabbrev id="public.function.fun-edit-event-comments-fun-msg-integer-fun-return-integer-iidevent-timestamp-without-time-zone-istatus-integer-icomment-event-text-iseconds-integer-istart-bigint-titleabbrev">
       fun_edit_event_comments(fun_msg integer, fun_return integer, iidevent timestamp without time zone, istatus integer, icomment_event text, iseconds integer, istart bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;

CASE

	WHEN id = 0  THEN
-- Ingresamos un nuevo registro
INSERT INTO event_comments(
            idadmin, start, seconds, comment_event, status, 
            idevent)
    VALUES (iidadmin, istart, iseconds, icomment_event, istatus, 
            iidevent) RETURNING ideventcomment INTO fun_return;
fun_msg := &#39;Nuevo registro insertado&#39;;

	WHEN id &gt; 0  THEN
-- Actualizamos
UPDATE event_comments
   SET idadmin=iidadmin, start=istart, seconds=iseconds, comment_event=icomment_event, 
       status=istatus, idevent=iidevent
 WHERE  ideventcomment=id;
 fun_return = id;
 fun_msg := &#39;Registro Actualizado&#39;;

	WHEN id &lt; 0  THEN
-- Eliminamos
 DELETE FROM event_comments
 WHERE  ideventcomment=id;
 fun_return := 0;
 fun_msg := &#39;Registro Eliminado&#39;;

 END CASE;


RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_event_assignment(admin_assigned bigint, iideventtype bigint, iidaccount bigint) -->
    <section id="public.function.fun-event-assignment-admin-assigned-bigint-iideventtype-bigint-iidaccount-bigint"
             xreflabel="publicfun_event_assignment(admin_assigned bigint, iideventtype bigint, iidaccount bigint)">
      <title id="public.function.fun-event-assignment-admin-assigned-bigint-iideventtype-bigint-iidaccount-bigint-title">
       fun_event_assignment(admin_assigned bigint, iideventtype bigint, iidaccount bigint)
      </title>
      <titleabbrev id="public.function.fun-event-assignment-admin-assigned-bigint-iideventtype-bigint-iidaccount-bigint-titleabbrev">
       fun_event_assignment(admin_assigned bigint, iideventtype bigint, iidaccount bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>bigint</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

R BIGINT;
iiddivision BIGINT;
iisopen boolean DEFAULT FALSE;

BEGIN

IF EXISTS(SELECT * FROM admins WHERE idadmin = admin_assigned) THEN
R := admin_assigned;
ELSE   

-------------------- 
-- TODO - Debe haber un bloque que auto asigne el evento al administrador que sea conveniente si el status esta en 0
-- Buscamos que administradores tienen acceso a la division y al iaccount de la cuenta de este evento
SELECT iddivision INTO iiddivision FROM accounts WHERE idcontact = iidaccount;

SELECT idadmin 
INTO   R 
FROM   admins 
WHERE  iiddivision = ANY(divisions) 
AND    iidaccount = ANY (idaccounts) limit 1; 

END IF;


RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_event_comment_insert_selected(fun_msg integer[], fun_return integer, iidadmin text, istatus integer, icomment integer) -->
    <section id="public.function.fun-event-comment-insert-selected-fun-msg-integerARRAY-fun-return-integer-iidadmin-text-istatus-integer-icomment-integer"
             xreflabel="publicfun_event_comment_insert_selected(fun_msg integer[], fun_return integer, iidadmin text, istatus integer, icomment integer)">
      <title id="public.function.fun-event-comment-insert-selected-fun-msg-integerARRAY-fun-return-integer-iidadmin-text-istatus-integer-icomment-integer-title">
       fun_event_comment_insert_selected(fun_msg integer[], fun_return integer, iidadmin text, istatus integer, icomment integer)
      </title>
      <titleabbrev id="public.function.fun-event-comment-insert-selected-fun-msg-integerARRAY-fun-return-integer-iidadmin-text-istatus-integer-icomment-integer-titleabbrev">
       fun_event_comment_insert_selected(fun_msg integer[], fun_return integer, iidadmin text, istatus integer, icomment integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

i INTEGER DEFAULT 0;
iidevent INTEGER;

BEGIN

fun_return := -100;
fun_msg := &#39;Comentario agregado a varios eventos&#39;;


   FOREACH iidevent IN ARRAY iidevents
   LOOP
      --RAISE NOTICE &#39;another_func(%,%)&#39;,m[1], m[2];
INSERT INTO event_comments(
            idadmin, seconds, comment_event, status, 
            idevent)
    VALUES (iidadmin, iseconds, icomment, istatus, 
            iidevent);

	i := i+1;
   END LOOP;


fun_return := i;
fun_msg := &#39;Comentario agregado a &#39;||i::TEXT||&#39; eventos&#39;;

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_event_comments_table_create_partition(idatetimeevent timestamp without time zone) -->
    <section id="public.function.fun-event-comments-table-create-partition-idatetimeevent-timestamp-without-time-zone"
             xreflabel="publicfun_event_comments_table_create_partition(idatetimeevent timestamp without time zone)">
      <title id="public.function.fun-event-comments-table-create-partition-idatetimeevent-timestamp-without-time-zone-title">
       fun_event_comments_table_create_partition(idatetimeevent timestamp without time zone)
      </title>
      <titleabbrev id="public.function.fun-event-comments-table-create-partition-idatetimeevent-timestamp-without-time-zone-titleabbrev">
       fun_event_comments_table_create_partition(idatetimeevent timestamp without time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

r BOOLEAN DEFAULT TRUE;
dia TEXT DEFAULT &#39;19000101&#39;;

BEGIN

dia := &#39;event_comments_&#39;||fun_sufix_name_by_date(idatetimeevent);

IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE table_catalog = &#39;open_ams&#39; AND table_schema = &#39;public&#39; AND table_name = dia LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS public.&#39;||dia::TEXT||&#39;(
   LIKE public.event_comments INCLUDING DEFAULTS INCLUDING CONSTRAINTS INCLUDING INDEXES INCLUDING STORAGE
) 
INHERITS (event_comments)
WITH (
  OIDS = FALSE,
  autovacuum_enabled=true,
  toast.autovacuum_enabled=true
);&#39;;

/*

CREATE TABLE public.events_comments_dia
(
   LIKE public.event_comments INCLUDING DEFAULTS INCLUDING CONSTRAINTS INCLUDING INDEXES INCLUDING STORAGE
) 
INHERITS (event_comments)
WITH (
  OIDS = FALSE
)
;

*/

-- Trigger: on_changed_table on event_comments

-- DROP TRIGGER on_changed_table ON event_comments;

EXECUTE  &#39;CREATE TRIGGER on_changed_table
  AFTER INSERT OR UPDATE OR DELETE
  ON &#39;||dia::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_changed_table();&#39;;

-- Trigger: on_insert on event_comments

-- DROP TRIGGER on_insert ON event_comments;

EXECUTE &#39;CREATE TRIGGER on_insert
  BEFORE INSERT
  ON &#39;||dia::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE event_comments_on_insert();&#39;;

-- Trigger: on_update_row on event_comments

-- DROP TRIGGER on_update_row ON event_comments;

EXECUTE &#39;CREATE TRIGGER on_update_row
  BEFORE UPDATE
  ON &#39;||dia::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_update_row_update_ts();&#39;;


END IF;

RETURN r;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_event_get_detail_as_json(iidevent bigint) -->
    <section id="public.function.fun-event-get-detail-as-json-iidevent-bigint"
             xreflabel="publicfun_event_get_detail_as_json(iidevent bigint)">
      <title id="public.function.fun-event-get-detail-as-json-iidevent-bigint-title">
       fun_event_get_detail_as_json(iidevent bigint)
      </title>
      <titleabbrev id="public.function.fun-event-get-detail-as-json-iidevent-bigint-titleabbrev">
       fun_event_get_detail_as_json(iidevent bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

origin_table TEXT;
rjson json;

BEGIN

--regclass

SELECT tableoid::regclass::TEXT INTO origin_table FROM events WHERE idevent = iidevent;

EXECUTE &#39;SELECT row_to_json(&#39;||origin_table||&#39;) FROM &#39;||origin_table||&#39; WHERE idevent = &#39;||iidevent::TEXT INTO rjson;




RETURN rjson;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_event_insert(fun_msg timestamp without time zone, fun_return integer, iidadmin integer, idescription text, iideventtype integer, ipriority integer, izu integer, icode text, iidaccount integer) -->
    <section id="public.function.fun-event-insert-fun-msg-timestamp-without-time-zone-fun-return-integer-iidadmin-integer-idescription-text-iideventtype-integer-ipriority-integer-izu-integer-icode-text-iidaccount-integer"
             xreflabel="publicfun_event_insert(fun_msg timestamp without time zone, fun_return integer, iidadmin integer, idescription text, iideventtype integer, ipriority integer, izu integer, icode text, iidaccount integer)">
      <title id="public.function.fun-event-insert-fun-msg-timestamp-without-time-zone-fun-return-integer-iidadmin-integer-idescription-text-iideventtype-integer-ipriority-integer-izu-integer-icode-text-iidaccount-integer-title">
       fun_event_insert(fun_msg timestamp without time zone, fun_return integer, iidadmin integer, idescription text, iideventtype integer, ipriority integer, izu integer, icode text, iidaccount integer)
      </title>
      <titleabbrev id="public.function.fun-event-insert-fun-msg-timestamp-without-time-zone-fun-return-integer-iidadmin-integer-idescription-text-iideventtype-integer-ipriority-integer-izu-integer-icode-text-iidaccount-integer-titleabbrev">
       fun_event_insert(fun_msg timestamp without time zone, fun_return integer, iidadmin integer, idescription text, iideventtype integer, ipriority integer, izu integer, icode text, iidaccount integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;

IF NOT EXISTS(SELECT idevent FROM eventtypes WHERE ideventtype = iideventtype) THEN
-- Verificamos si existe el ideventtype, caso contrario le asignamos como 0 (desconocido)
iideventtype := 0;
END IF;


SELECT * FROM fun_edit_events(0, idateevent, istatus, iidaccount, icode, izu, ipriority, iideventtype, idescription, iidadmin) INTO fun_return, fun_msg;

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_event_status_get_label(istatus integer) -->
    <section id="public.function.fun-event-status-get-label-istatus-integer"
             xreflabel="publicfun_event_status_get_label(istatus integer)">
      <title id="public.function.fun-event-status-get-label-istatus-integer-title">
       fun_event_status_get_label(istatus integer)
      </title>
      <titleabbrev id="public.function.fun-event-status-get-label-istatus-integer-titleabbrev">
       fun_event_status_get_label(istatus integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
r TEXT DEFAULT &#39;Unknown&#39;;
BEGIN

CASE

	WHEN istatus = 0  THEN
-- Abierto
		r := &#39;Open&#39;;
	WHEN istatus = 1  THEN
-- Cerrado
		r := &#39;Close&#39;;
	WHEN istatus = 2  THEN
-- Cerrado automaticamente por el sistema
		r := &#39;Close (System)&#39;;
	WHEN istatus = 3  THEN
-- Pendiente
		r := &#39;Pending&#39;;
	WHEN istatus = 4  THEN
-- Reabierto		
		r := &#39;Reopen&#39;;
	WHEN istatus = 5  THEN	
		r := &#39;Expired&#39;;
	WHEN istatus = 6  THEN	
		r := &#39;Close (Like other previous event without closing)&#39;;
	WHEN istatus = 7  THEN						
		r := &#39;Close (For Restore)&#39;;
	WHEN istatus = 8  THEN						
		r := &#39;Close (Invalid account)&#39;;	
			WHEN istatus = 9  THEN						
		r := &#39;Close (Unabled account)&#39;;		
	ELSE
		r := &#39;yyy&#39;;
 END CASE;


RETURN r;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_event_time_last_eventtype_account_not_closed(izu integer, iideventtype timestamp without time zone, idateevent integer, iidaccount bigint) -->
    <section id="public.function.fun-event-time-last-eventtype-account-not-closed-izu-integer-iideventtype-timestamp-without-time-zone-idateevent-integer-iidaccount-bigint"
             xreflabel="publicfun_event_time_last_eventtype_account_not_closed(izu integer, iideventtype timestamp without time zone, idateevent integer, iidaccount bigint)">
      <title id="public.function.fun-event-time-last-eventtype-account-not-closed-izu-integer-iideventtype-timestamp-without-time-zone-idateevent-integer-iidaccount-bigint-title">
       fun_event_time_last_eventtype_account_not_closed(izu integer, iideventtype timestamp without time zone, idateevent integer, iidaccount bigint)
      </title>
      <titleabbrev id="public.function.fun-event-time-last-eventtype-account-not-closed-izu-integer-iideventtype-timestamp-without-time-zone-idateevent-integer-iidaccount-bigint-titleabbrev">
       fun_event_time_last_eventtype_account_not_closed(izu integer, iideventtype timestamp without time zone, idateevent integer, iidaccount bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

-- Tiempo en minutos
itime integer default -1; 
ilastdateevent timestamp without time zone DEFAULT now();

BEGIN
RAISE NOTICE &#39;1) Inicia fun_event_time_last_eventtype_account_not_closed&#39;;
RAISE NOTICE &#39;2) Datos iideventtype % / iidaccount % / izu %&#39;, iideventtype::text, iidaccount::text, izu::text;


--dateevent timestamp without time zone DEFAULT now()
ilastdateevent := COALESCE((SELECT dateevent FROM events WHERE ideventtype = iideventtype AND idaccount = iidaccount AND zu = izu AND status IN(0, 4, 5) ORDER BY idevent DESC LIMIT 1), &#39;2099-01-01 00:00&#39;::timestamp without time zone);

RAISE NOTICE &#39;ilastdateevent(%)&#39;, ilastdateevent;
RAISE NOTICE &#39;idateevent(%)&#39;, idateevent;
RAISE NOTICE &#39;seg(%)&#39;, EXTRACT(epoch FROM age(ilastdateevent, idateevent));

itime := (EXTRACT(epoch FROM age(idateevent, ilastdateevent))/60)::INTEGER;


RETURN itime;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_expired_session() -->
    <section id="public.function.fun-expired-session"
             xreflabel="publicfun_expired_session()">
      <title id="public.function.fun-expired-session-title">
       fun_expired_session()
      </title>
      <titleabbrev id="public.function.fun-expired-session-titleabbrev">
       fun_expired_session()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

fun_return INTEGER DEFAULT 0;
cursor1 CURSOR FOR SELECT * FROM (SELECT idadmin, admin_sessionid, (extract(epoch from age(now(), last_heartbeat))/60) AS minutes_event from admins WHERE enabled = true AND admin_sessionid IS NOT NULL) s WHERE minutes_event &gt; 2;
    cursor1_row RECORD;

BEGIN

    FOR cursor1_row IN cursor1 LOOP
	PERFORM fun_logout(cursor1_row.idadmin, cursor1_row.admin_sessionid);
	fun_return := fun_return+1;
    END LOOP;
   

RETURN fun_return;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_event_insert_jobs(ofun_msg bigint, ofun_return timestamp with time zone, ijob_next_run bigint, ijob_run_duration integer, ijob_date_create integer, ijob_description bigint, ijob_enabled text, ijob_name boolean, izu text, job_current_execution_status timestamp with time zone, last_run_outcome integer, iidaccount timestamp with time zone) -->
    <section id="public.function.fun-farma-event-insert-jobs-ofun-msg-bigint-ofun-return-timestamp-with-time-zone-ijob-next-run-bigint-ijob-run-duration-integer-ijob-date-create-integer-ijob-description-bigint-ijob-enabled-text-ijob-name-boolean-izu-text-job-current-execution-status-timestamp-with-time-zone-last-run-outcome-integer-iidaccount-timestamp-with-time-zone"
             xreflabel="publicfun_farma_event_insert_jobs(ofun_msg bigint, ofun_return timestamp with time zone, ijob_next_run bigint, ijob_run_duration integer, ijob_date_create integer, ijob_description bigint, ijob_enabled text, ijob_name boolean, izu text, job_current_execution_status timestamp with time zone, last_run_outcome integer, iidaccount timestamp with time zone)">
      <title id="public.function.fun-farma-event-insert-jobs-ofun-msg-bigint-ofun-return-timestamp-with-time-zone-ijob-next-run-bigint-ijob-run-duration-integer-ijob-date-create-integer-ijob-description-bigint-ijob-enabled-text-ijob-name-boolean-izu-text-job-current-execution-status-timestamp-with-time-zone-last-run-outcome-integer-iidaccount-timestamp-with-time-zone-title">
       fun_farma_event_insert_jobs(ofun_msg bigint, ofun_return timestamp with time zone, ijob_next_run bigint, ijob_run_duration integer, ijob_date_create integer, ijob_description bigint, ijob_enabled text, ijob_name boolean, izu text, job_current_execution_status timestamp with time zone, last_run_outcome integer, iidaccount timestamp with time zone)
      </title>
      <titleabbrev id="public.function.fun-farma-event-insert-jobs-ofun-msg-bigint-ofun-return-timestamp-with-time-zone-ijob-next-run-bigint-ijob-run-duration-integer-ijob-date-create-integer-ijob-description-bigint-ijob-enabled-text-ijob-name-boolean-izu-text-job-current-execution-status-timestamp-with-time-zone-last-run-outcome-integer-iidaccount-timestamp-with-time-zone-titleabbrev">
       fun_farma_event_insert_jobs(ofun_msg bigint, ofun_return timestamp with time zone, ijob_next_run bigint, ijob_run_duration integer, ijob_date_create integer, ijob_description bigint, ijob_enabled text, ijob_name boolean, izu text, job_current_execution_status timestamp with time zone, last_run_outcome integer, iidaccount timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

row_network_device view_account_network_devices%ROWTYPE;
descrip TEXT DEFAULT &#39;&#39;;
descrip_current_status TEXT DEFAULT &#39;&#39;;
iideventtype_current_status BIGINT DEFAULT -1;
iideventtype_last_run_outcome BIGINT DEFAULT -1;

BEGIN

SELECT * INTO row_network_device FROM view_account_network_devices WHERE idequipment = iidequipment;

--descrip := &#39;&lt;b&gt;Equipo:&lt;/b&gt; &#39;||row_network_device.equipment||&#39;&lt;/br&gt; &lt;b&gt;IP:&lt;/b&gt; &#39;||row_network_device.ip::TEXT||&#39;&lt;/br&gt; &#39;|| &#39;&lt;b&gt;JOB: &#39;||ijob_name||&#39;&lt;/b&gt; &lt;/br&gt; &lt;b&gt;Description:&lt;/b&gt; &#39;||ijob_description||&#39;&lt;/br&gt; &lt;b&gt;Next Run:&lt;/b&gt; &#39;||ijob_next_run::TEXT||&#39;&lt;/br&gt;&#39;;
--descrip_current_status := equip;
descrip := &#39;&lt;b&gt;JOB: &#39;||ijob_name||&#39;&lt;/b&gt; &lt;/br&gt; &lt;b&gt;Description:&lt;/b&gt; &#39;||ijob_description;


CASE

WHEN job_current_execution_status = 0 THEN
iideventtype_current_status := 67;
descrip_current_status := descrip||&#39; [Are not idle or suspended]&#39;;

WHEN job_current_execution_status = 1 THEN
iideventtype_current_status := 69;
descrip_current_status := descrip||&#39; [Executing]&#39;;

WHEN job_current_execution_status = 2 THEN
iideventtype_current_status := 70;
descrip_current_status := descrip||&#39; [Waiting for thread]&#39;;

WHEN job_current_execution_status = 3 THEN
iideventtype_current_status := 71;
descrip_current_status := descrip||&#39; [Between retries]&#39;;

WHEN job_current_execution_status = 4 THEN
iideventtype_current_status := 72;
descrip_current_status := descrip||&#39; [Idle]&#39;;

WHEN job_current_execution_status = 5 THEN
iideventtype_current_status := 73;
descrip_current_status := descrip||&#39; [Suspended]&#39;;

WHEN job_current_execution_status = 7 THEN
iideventtype_current_status := 74;
descrip_current_status := descrip||&#39; [Performing completion actions]&#39;;


ELSE
iideventtype_current_status := 75;
descrip_current_status := descrip||&#39; [???]&#39;;
END CASE;

BEGIN
-- Inserta el estado actual del JOB
INSERT INTO events(ideventtype, description, idaccount, zu, idequipment) VALUES (iideventtype_current_status, descrip_current_status, iidaccount, izu, iidequipment);

  EXCEPTION WHEN unique_violation THEN
            -- do nothing, and loop to try the UPDATE again


END;

--descrip := &#39;&lt;b&gt;Equipo:&lt;/b&gt; &#39;||row_network_device.equipment||&#39;&lt;/br&gt; &lt;b&gt;IP:&lt;/b&gt; &#39;||row_network_device.ip::TEXT||&#39;&lt;/br&gt; &#39;|| &#39;&lt;b&gt;JOB: &#39;||ijob_name||&#39;&lt;/b&gt;  &lt;/br&gt; &lt;b&gt;Description:&lt;/b&gt; &#39;||ijob_description||&#39;&lt;/br&gt; &lt;b&gt;Next Run:&lt;/b&gt; &#39;||ijob_next_run::TEXT||&#39;&lt;/br&gt;&#39;;
descrip := &#39;&lt;b&gt;JOB: &#39;||ijob_name||&#39;&lt;/b&gt;  &lt;/br&gt; &lt;b&gt;Description:&lt;/b&gt; &#39;||ijob_description;

CASE

WHEN last_run_outcome = 0 THEN
iideventtype_last_run_outcome := 29;
descrip := descrip||&#39; &lt;b&gt;[Failed]&lt;/b&gt;&#39;;

WHEN last_run_outcome = 1 THEN
iideventtype_last_run_outcome := 30;
descrip := descrip||&#39; &lt;b&gt;[Succeeded]&lt;/b&gt;&#39;;

WHEN last_run_outcome = 3 THEN
iideventtype_last_run_outcome := 31;
descrip := descrip||&#39; &lt;b&gt;[Canceled]&lt;/b&gt;&#39;;

WHEN last_run_outcome = 5 THEN
iideventtype_last_run_outcome := 32;
descrip := descrip||&#39; &lt;b&gt;[Unknown]&lt;/b&gt;&#39;;


ELSE
iideventtype_last_run_outcome := 0;
descrip := descrip||&#39; &lt;b&gt;[???]&lt;/b&gt;&#39;;

END CASE;



/*
switch($row[&quot;last_run_outcome&quot;]){

	case 0:
		$ideventtype = 29;
		$description_event = $description_event.&quot; &lt;b&gt;[Failed]&lt;/b&gt; &quot;;
		$jobs_fail++;
	break;
	case 1:
		$ideventtype = 30;
		$description_event = $description_event.&quot; [Succeeded] &quot;;
	break;
	case 3:
		$ideventtype = 31;
		$description_event = $description_event.&quot; [Canceled] &quot;;
	break;
	case 5:
		$ideventtype = 32;
		$description_event = $description_event.&quot; [Unknown] &quot;;
	break;
	default:
		$ideventtype = 0;
		$description_event = $description_event.&quot; [???] &quot;;
	break;
}
*/

BEGIN

INSERT INTO events_jobs(
            dateevent, ideventtype, description, idaccount, idequipment,
            zu, job_name, job_enabled, job_description, job_date_create, 
            job_run_duration, job_run_status, job_next_run)
    VALUES (idateevent, iideventtype_last_run_outcome, descrip, iidaccount, iidequipment,
            izu, ijob_name, ijob_enabled, ijob_description, ijob_date_create, 
            ijob_run_duration, last_run_outcome, ijob_next_run);


  EXCEPTION WHEN unique_violation THEN
            -- do nothing, and loop to try the UPDATE again
            END;

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_event_insert_lista_precios(icantidad_productos text, ilista_activa text, ilista_principal text, ioficina integer) -->
    <section id="public.function.fun-farma-event-insert-lista-precios-icantidad-productos-text-ilista-activa-text-ilista-principal-text-ioficina-integer"
             xreflabel="publicfun_farma_event_insert_lista_precios(icantidad_productos text, ilista_activa text, ilista_principal text, ioficina integer)">
      <title id="public.function.fun-farma-event-insert-lista-precios-icantidad-productos-text-ilista-activa-text-ilista-principal-text-ioficina-integer-title">
       fun_farma_event_insert_lista_precios(icantidad_productos text, ilista_activa text, ilista_principal text, ioficina integer)
      </title>
      <titleabbrev id="public.function.fun-farma-event-insert-lista-precios-icantidad-productos-text-ilista-activa-text-ilista-principal-text-ioficina-integer-titleabbrev">
       fun_farma_event_insert_lista_precios(icantidad_productos text, ilista_activa text, ilista_principal text, ioficina integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE  

Retorno boolean DEFAULT false;
iideventtype INTEGER DEFAULT 0;
idescription TEXT DEFAULT &#39;----&#39;;
iidaccount INTEGER DEFAULT 0;
temp_descrip TEXT DEFAULT &#39;-----&#39;;

BEGIN

iidaccount := fun_get_idaccount_by_account(ioficina, 1);

-- Revisa si la lista de precios es 0
IF icantidad_productos &lt; 100 THEN
iideventtype := 54;
idescription := &#39;La lista de precios activa: &lt;b&gt;&#39;||ilista_activa||&#39;&lt;/b&gt; tiene  &lt;b&gt;&#39;||icantidad_productos::TEXT||&#39;&lt;/b&gt; productos.&#39;;
PERFORM fun_event_insert_by_ideventtype(now()::timestamp without time zone, iidaccount, 0, 0, iideventtype, idescription, 0);
END IF;

-- Revisa si la lista activa es igual a la lista principal
IF ilista_principal != ilista_activa THEN
iideventtype := 57;
idescription := &#39;La lista principal &lt;b&gt;[&#39;||ilista_principal||&#39;]&lt;/b&gt; no es igual a la lista activa &lt;b&gt;[&#39;||ilista_activa||&#39;]&lt;/b&gt;&#39;;
PERFORM fun_event_insert_by_ideventtype(now()::timestamp without time zone, iidaccount, 0, 0, iideventtype, idescription, 0);
END IF;


-- Revisa si la lista activa de productos ha cambiado
iideventtype := 55;
idescription := &#39;La lista activa de productos a cambiado a &lt;b&gt;&#39;||ilista_activa||&#39;&lt;/b&gt;&#39;;
--SELECT description INTO temp_descrip FROM events WHERE ideventtype = iideventtype AND idaccount = iidaccount ORDER BY idevent DESC LIMIT 1;
temp_descrip:= COALESCE((SELECT description FROM events WHERE ideventtype = iideventtype AND idaccount = iidaccount ORDER BY idevent DESC LIMIT 1), &#39;&#39;);
IF idescription != temp_descrip THEN
PERFORM fun_event_insert_by_ideventtype(now()::timestamp without time zone, iidaccount, 0, 0, iideventtype, idescription, 0);
END IF;

-- Revisa si la lista principal ha cambiado
iideventtype := 56;
idescription := &#39;La lista principal de productos a cambiado a &lt;b&gt;&#39;||ilista_principal||&#39;&lt;/b&gt;&#39;;
temp_descrip:= COALESCE((SELECT description FROM events WHERE ideventtype = iideventtype AND idaccount = iidaccount ORDER BY idevent DESC LIMIT 1), &#39;&#39;);
--SELECT description INTO temp_descrip FROM events WHERE ideventtype = iideventtype AND idaccount = iidaccount ORDER BY idevent DESC LIMIT 1;
IF idescription != temp_descrip THEN
PERFORM fun_event_insert_by_ideventtype(now()::timestamp without time zone, iidaccount, 0, 0, iideventtype, idescription, 0);
END IF;



RETURN Retorno; 
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_event_insert_sqlserver_uptime(iuptime bigint, iidequipment integer) -->
    <section id="public.function.fun-farma-event-insert-sqlserver-uptime-iuptime-bigint-iidequipment-integer"
             xreflabel="publicfun_farma_event_insert_sqlserver_uptime(iuptime bigint, iidequipment integer)">
      <title id="public.function.fun-farma-event-insert-sqlserver-uptime-iuptime-bigint-iidequipment-integer-title">
       fun_farma_event_insert_sqlserver_uptime(iuptime bigint, iidequipment integer)
      </title>
      <titleabbrev id="public.function.fun-farma-event-insert-sqlserver-uptime-iuptime-bigint-iidequipment-integer-titleabbrev">
       fun_farma_event_insert_sqlserver_uptime(iuptime bigint, iidequipment integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>bigint</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

--R INTEGER DEFAULT 0;
--last_uptime REAL DEFAULT -100.1;
limit_uptime REAL DEFAULT 14; 
iideventtype BIGINT DEFAULT 0;
idescrip TEXT DEFAULT &#39;&#39;;
days_uptime REAL DEFAULT -1.1;


BEGIN

--last_uptime := COALESCE((SELECT uptime FROM events_device_uptime WHERE idequipment = iidequipment ORDER BY idevent DESC LIMIT 1), -1);

days_uptime := round((iuptime / 1440.0), 1);

--idescrip :=  &#39;&lt;b&gt;Servidor encendido&lt;/b&gt;  desde hace &lt;b&gt;&#39;||iuptime::text||&#39; minutos. o sea &#39;||days_uptime::text||&#39; dias&lt;/b&gt; &#39;;
idescrip :=  &#39;&lt;b&gt;Servidor encendido&lt;/b&gt;  desde hace &lt;b&gt;&#39;||days_uptime::text||&#39; das&lt;/b&gt; &#39;;

CASE 

WHEN days_uptime &gt;= limit_uptime THEN
iideventtype := 59;

--WHEN days_uptime &lt; 1 THEN
--iideventtype := 87;


WHEN days_uptime &lt; limit_uptime THEN
iideventtype := 58;



ELSE

END CASE;



--IF (last_uptime != days_uptime) AND iideventtype &gt; 0 THEN
IF iideventtype &gt; 0 THEN
INSERT INTO events_device_uptime(
            ideventtype, description, idequipment, uptime)
    VALUES (iideventtype, idescrip, iidequipment, days_uptime);
END IF;

--END IF;

RETURN iidequipment;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_event_insert_statusdb_account(ofun_msg bigint, ofun_return bigint, idblogsize text, idbfilesize bigint, istate_des integer, istatus text, izu real, inamedb real) -->
    <section id="public.function.fun-farma-event-insert-statusdb-account-ofun-msg-bigint-ofun-return-bigint-idblogsize-text-idbfilesize-bigint-istate-des-integer-istatus-text-izu-real-inamedb-real"
             xreflabel="publicfun_farma_event_insert_statusdb_account(ofun_msg bigint, ofun_return bigint, idblogsize text, idbfilesize bigint, istate_des integer, istatus text, izu real, inamedb real)">
      <title id="public.function.fun-farma-event-insert-statusdb-account-ofun-msg-bigint-ofun-return-bigint-idblogsize-text-idbfilesize-bigint-istate-des-integer-istatus-text-izu-real-inamedb-real-title">
       fun_farma_event_insert_statusdb_account(ofun_msg bigint, ofun_return bigint, idblogsize text, idbfilesize bigint, istate_des integer, istatus text, izu real, inamedb real)
      </title>
      <titleabbrev id="public.function.fun-farma-event-insert-statusdb-account-ofun-msg-bigint-ofun-return-bigint-idblogsize-text-idbfilesize-bigint-istate-des-integer-istatus-text-izu-real-inamedb-real-titleabbrev">
       fun_farma_event_insert_statusdb_account(ofun_msg bigint, ofun_return bigint, idblogsize text, idbfilesize bigint, istate_des integer, istatus text, izu real, inamedb real)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

--iidaccount INTEGER DEFAULT 1;
iideventtype INTEGER DEFAULT 0;
--idescrip_logsize TEXT DEFAULT &#39;&#39;;
--idescrip_dbsize TEXT DEFAULT &#39;&#39;;
idescrip TEXT DEFAULT &#39;&#39;;
--duplicado BOOLEAN DEFAULT FALSE;
max_size_log INTEGER DEFAULT 2000;
max_size_db INTEGER DEFAULT 15000;
row_network_device view_account_network_devices%ROWTYPE;
equip TEXT DEFAULT &#39;&#39;;

BEGIN

 SELECT * INTO row_network_device FROM view_account_network_devices WHERE idequipment = iidequipment;

equip := &#39;&#39;;



-- // BLOQUE DE ESTADOS //--
idescrip  := equip||&#39;&lt;b&gt;Data Base:&lt;/b&gt; &#39;||inamedb||&#39;&lt;/br&gt;&lt;b&gt; Status:&lt;/b&gt; &#39;||istate_des;
CASE

WHEN istatus = 0 THEN
-- ONLINE 
iideventtype := 34;

WHEN istatus = 1 THEN
-- RESTORING 
iideventtype := 35;

WHEN istatus = 2 THEN
-- RECOVERING
iideventtype := 36;

WHEN istatus = 3 THEN
-- RECOVERING PENDING
iideventtype := 38;

WHEN istatus = 4 THEN
-- SUSPECT
iideventtype := 33;

WHEN istatus = 5 THEN
-- EMERGENCY
iideventtype := 44;

WHEN istatus = 6 THEN
-- OFFLINE
iideventtype := 45;

WHEN istatus = 7 THEN
-- COPYING
iideventtype := 46;

ELSE

END CASE;



INSERT INTO events(
            ideventtype, description, idaccount, zu)
    VALUES (iideventtype, idescrip, iidaccount, izu);




-- // BLOQUE DE TAMAO LOGS //--
-- limite establecido para los logs
IF idblogsize &gt; max_size_log THEN
iideventtype := 47;
idescrip  := equip||&#39;&lt;b&gt;Data Base:&lt;/b&gt; &#39;||inamedb||&#39;&lt;/br&gt;&lt;b&gt; Log Size:&lt;/b&gt; &#39;||idblogsize::text||&#39; MB &lt;/br&gt;Exceeds the maximum size set to &#39;||max_size_log||&#39; MB&#39;;
ELSE
iideventtype := 61;
idescrip  := equip||&#39;&lt;b&gt;Data Base:&lt;/b&gt; &#39;||inamedb||&#39;&lt;/br&gt;&lt;b&gt; Log Size:&lt;/b&gt; &#39;||idblogsize::text||&#39; MB&#39;;
END IF;


INSERT INTO events_dbsizes(
            ideventtype, description, idaccount, zu,
            db_name, db_size, db_type)
    VALUES (iideventtype, idescrip, iidaccount, izu,
            inamedb, idblogsize, 1);








IF idbfilesize &gt; max_size_db THEN
iideventtype := 48;
idescrip  := equip||&#39;&lt;b&gt;Data Base:&lt;/b&gt; &#39;||inamedb||&#39;&lt;/br&gt;&lt;b&gt; Size:&lt;/b&gt; &#39;||idbfilesize::text||&#39; MB &lt;/br&gt;Exceeds the maximum size set to &#39;||max_size_db||&#39; MB&#39;;
ELSE
iideventtype := 60;
idescrip  := equip||&#39;&lt;b&gt;Data Base:&lt;/b&gt; &#39;||inamedb||&#39;&lt;/br&gt;&lt;b&gt; Size:&lt;/b&gt; &#39;||idbfilesize::text||&#39; MB&#39;;
END IF;


INSERT INTO events_dbsizes(
            ideventtype, description, idaccount, zu,
            db_name, db_size, db_type)
    VALUES (iideventtype, idescrip, iidaccount, izu,
            inamedb, idbfilesize, 0);





RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_import_accounts(fun_msg text, fun_return text, cedula_sup_operativo text, iemail text, telf2 text, telf1 timestamp without time zone, idb_pwd timestamp without time zone, idb_user text, iaccount text, iend_date text, istart_date text, iaddress_ref text, iaddress text, ilast_name text) -->
    <section id="public.function.fun-farma-import-accounts-fun-msg-text-fun-return-text-cedula-sup-operativo-text-iemail-text-telf2-text-telf1-timestamp-without-time-zone-idb-pwd-timestamp-without-time-zone-idb-user-text-iaccount-text-iend-date-text-istart-date-text-iaddress-ref-text-iaddress-text-ilast-name-text"
             xreflabel="publicfun_farma_import_accounts(fun_msg text, fun_return text, cedula_sup_operativo text, iemail text, telf2 text, telf1 timestamp without time zone, idb_pwd timestamp without time zone, idb_user text, iaccount text, iend_date text, istart_date text, iaddress_ref text, iaddress text, ilast_name text)">
      <title id="public.function.fun-farma-import-accounts-fun-msg-text-fun-return-text-cedula-sup-operativo-text-iemail-text-telf2-text-telf1-timestamp-without-time-zone-idb-pwd-timestamp-without-time-zone-idb-user-text-iaccount-text-iend-date-text-istart-date-text-iaddress-ref-text-iaddress-text-ilast-name-text-title">
       fun_farma_import_accounts(fun_msg text, fun_return text, cedula_sup_operativo text, iemail text, telf2 text, telf1 timestamp without time zone, idb_pwd timestamp without time zone, idb_user text, iaccount text, iend_date text, istart_date text, iaddress_ref text, iaddress text, ilast_name text)
      </title>
      <titleabbrev id="public.function.fun-farma-import-accounts-fun-msg-text-fun-return-text-cedula-sup-operativo-text-iemail-text-telf2-text-telf1-timestamp-without-time-zone-idb-pwd-timestamp-without-time-zone-idb-user-text-iaccount-text-iend-date-text-istart-date-text-iaddress-ref-text-iaddress-text-ilast-name-text-titleabbrev">
       fun_farma_import_accounts(fun_msg text, fun_return text, cedula_sup_operativo text, iemail text, telf2 text, telf1 timestamp without time zone, idb_pwd timestamp without time zone, idb_user text, iaccount text, iend_date text, istart_date text, iaddress_ref text, iaddress text, ilast_name text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
id BIGINT DEFAULT 0;
ienabled BOOLEAN DEFAULT TRUE;
idldf INTEGER DEFAULT 0;
ifirst_name text default &#39;&#39;;
iidaccounttype INTEGER DEFAULT 0;

ifname text default &#39;&#39;;
ilname text default &#39;&#39;;

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;
id := fun_get_idaccount_by_account(iaccount, 1);
idldf := COALESCE((SELECT idcontact FROM contacts WHERE identification = cedula_sup_operativo LIMIT 1), 0);

CASE
WHEN position(&#39;MEDI &#39; in ilast_name) = 1 THEN
ifname := substring(ilast_name from 6 for 100);
ilname := &#39;MEDI&#39;;

WHEN position(&#39;ECO &#39; in ilast_name) = 1 THEN
ifname := substring(ilast_name from 5 for 100);
ilname := &#39;ECO&#39;;

WHEN position(&#39;PAF &#39; in ilast_name) = 1 THEN
ifname := substring(ilast_name from 5 for 100);
ilname := &#39;PAF&#39;;

ELSE

ifname := &#39; *&#39;;
ilname := ilast_name;

END CASE;

IF istatus != &#39;A&#39; THEN
ienabled := FALSE;
END IF;

IF franquicia = &#39;N&#39; THEN
iidaccounttype := 3;
ELSE
iidaccounttype := 4;
END IF;

RAISE NOTICE &#39;Account (%) con ID (%)&#39;, iaccount, id;

-- Para este caso ilast_name se lo utiliza como nombre y * como apellido

CASE

	WHEN id &lt;= 1 THEN
	BEGIN

-- Verificamos que no se repita el abonado
	iaccount := fun_account_auto_account(iaccount);

-- Ingresamos un nuevo registro
INSERT INTO accounts(
            enabled, first_name, last_name, birthday, identification, 
            address, address_ref, 
            start_date, end_date, account, idaccounttype, iddivision)
    VALUES (ienabled,  ilname, ifname, istart_date, iaccount, 
            iaddress, iaddress_ref, 
            istart_date, iend_date, iaccount, iidaccounttype, 1)
 RETURNING idcontact INTO fun_return;
fun_msg := &#39;Nuevo registro insertado&#39;;

IF fun_return &gt; 0 THEN

PERFORM fun_farma_import_accounts_insertphone(fun_return, telf1);
PERFORM fun_farma_import_accounts_insertphone(fun_return, telf2);
PERFORM fun_farma_import_accounts_insertemail(fun_return, iemail);

DELETE FROM account_contacts WHERE appointment = &#39;Farma_LDF&#39; AND idaccount = fun_return;
IF idldf &gt; 0 THEN
INSERT INTO account_contacts (idaccount, idcontact, appointment, priority) VALUES (fun_return, idldf, &#39;Farma_LDF&#39;, 2);
END IF;

END IF;

fun_msg := fun_return;

EXCEPTION WHEN unique_violation THEN
 -- do nothing
 fun_return := -2;
 fun_msg := &#39;Registro tiene campos que deben ser unicos&#39;||iaccount||&#39; &#39;||ilast_name||&#39; &#39;||iaccount;
END;


	WHEN id &gt; 1  THEN
BEGIN	
-- Actualizamos
RAISE NOTICE &#39;Account (%) con ID (%) para actualizar cuenta&#39;, iaccount, id;
UPDATE accounts
   SET iddivision = 1, first_name=ifname, last_name=ilname, birthday=istart_date, 
       identification=iaccount, address=iaddress, address_ref=iaddress_ref, start_date=istart_date, end_date=iend_date, account=iaccount, idaccounttype = iidaccounttype
 WHERE idcontact = id;
 fun_return := id;
 fun_msg := &#39;Registro Actualizado&#39;;
RAISE NOTICE &#39;Account (%) con ID (%) para actualizar telefonos&#39;, iaccount, id;

PERFORM fun_farma_import_accounts_insertphone(id, telf1);
PERFORM fun_farma_import_accounts_insertphone(id, telf2);
PERFORM fun_farma_import_accounts_insertemail(id, iemail);

RAISE NOTICE &#39;Account (%) con ID (%) para actualizar - Eliminamos el LDF&#39;, iaccount, id;
DELETE FROM account_contacts WHERE appointment = &#39;Farma_LDF&#39; AND idaccount = id;

RAISE NOTICE &#39;Account (%) con ID (%) para actualizar ldf&#39;, iaccount, id;
IF idldf &gt; 0 THEN
INSERT INTO account_contacts (idaccount, idcontact, appointment, priority) VALUES (id, idldf, &#39;Farma_LDF&#39;, 2);
END IF;

/*
RAISE NOTICE &#39;Account (%) con ID (%) para actualizar datos del servidor (% =&gt; %)&#39;, iaccount, id, idb_user, idb_pwd;
-- Actualizamos los datos del servidor
UPDATE network_devices
   SET username=idb_user, pwd=idb_pwd WHERE idaccount=id AND equipment=&#39;Server&#39; AND mark=&#39;Farma01&#39;;
        IF NOT found THEN

IF id &gt; 0 THEN
RAISE NOTICE &#39;Account (%) con ID (%) para actualizar / Datos del servidor no encontrados, se inserta.&#39;, iaccount, id;        
INSERT INTO network_devices(
            equipment, mark, description, 
            username, pwd, idaccount)
    VALUES (&#39;Server&#39;, &#39;Farma01&#39;, &#39;Servidor de farmacia Nueva &#39;||id::text, 
            idb_user, idb_pwd, fun_return);
END IF;
        END IF;
*/
 /*
-- Actualizamos los datos del gateway
UPDATE network_devices
   SET note = &#39;No modificar esta nota&#39; WHERE idaccount=fun_return AND equipment=&#39;Gateway&#39;;
        IF NOT found THEN
IF fun_return &gt; 0 THEN
INSERT INTO network_devices(
            equipment, description, idaccount, note)
    VALUES (&#39;Gateway&#39;, &#39;Gateway de farmacia &#39;||fun_return::text, 
            fun_return, &#39;No modificar o borrar esta nota&#39;);
END IF;
        END IF;
*/

fun_msg := id;

 EXCEPTION WHEN unique_violation THEN
 -- do nothing
 fun_return := -3;
 fun_msg := &#39;Registro tiene campos que deben ser unicos id=&#39;||id::TEXT||&#39; &#39;||iaccount||&#39; &#39;||ilast_name||;
 
END;




	WHEN id &lt; 0  THEN
-- Eliminamos
/*DELETE FROM accounts
 WHERE idcontact=id;
 fun_return := 0;
 fun_msg := &#39;Registro Eliminado&#39;;*/

ELSE

 END CASE;


RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_import_accounts_insertemail(iemail bigint, iidcontact text) -->
    <section id="public.function.fun-farma-import-accounts-insertemail-iemail-bigint-iidcontact-text"
             xreflabel="publicfun_farma_import_accounts_insertemail(iemail bigint, iidcontact text)">
      <title id="public.function.fun-farma-import-accounts-insertemail-iemail-bigint-iidcontact-text-title">
       fun_farma_import_accounts_insertemail(iemail bigint, iidcontact text)
      </title>
      <titleabbrev id="public.function.fun-farma-import-accounts-insertemail-iemail-bigint-iidcontact-text-titleabbrev">
       fun_farma_import_accounts_insertemail(iemail bigint, iidcontact text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

INSERT INTO emails (idcontact, email) VALUES (iidcontact, iemail);
RETURN true;
 EXCEPTION WHEN unique_violation THEN
 -- do nothing
 --fun_msg := &#39;El numero &#39;||inumber::TEXT||&#39; ya existe para el contacto &#39;||idcontact::text;

RETURN false;
END;
</programlisting>
      </para>
    </section>

<!-- Function fun_farma_import_accounts_insertphone(inumber bigint, iidcontact text) -->
    <section id="public.function.fun-farma-import-accounts-insertphone-inumber-bigint-iidcontact-text"
             xreflabel="publicfun_farma_import_accounts_insertphone(inumber bigint, iidcontact text)">
      <title id="public.function.fun-farma-import-accounts-insertphone-inumber-bigint-iidcontact-text-title">
       fun_farma_import_accounts_insertphone(inumber bigint, iidcontact text)
      </title>
      <titleabbrev id="public.function.fun-farma-import-accounts-insertphone-inumber-bigint-iidcontact-text-titleabbrev">
       fun_farma_import_accounts_insertphone(inumber bigint, iidcontact text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       Funcion de apoyo para importar datos de telefonos de la cuenta
        <programlisting>BEGIN

INSERT INTO phones (idcontact, number) VALUES (iidcontact, inumber);
return true;
 EXCEPTION WHEN unique_violation THEN
 -- do nothing
 --fun_msg := &#39;El numero &#39;||inumber::TEXT||&#39; ya existe para el contacto &#39;||idcontact::text;

RETURN false;
END;
</programlisting>
      </para>
    </section>

<!-- Function fun_farma_import_asig_personal_farma(fun_msg text, fun_return text, oficina text, estado text, perfil_referencia boolean, pwd text) -->
    <section id="public.function.fun-farma-import-asig-personal-farma-fun-msg-text-fun-return-text-oficina-text-estado-text-perfil-referencia-boolean-pwd-text"
             xreflabel="publicfun_farma_import_asig_personal_farma(fun_msg text, fun_return text, oficina text, estado text, perfil_referencia boolean, pwd text)">
      <title id="public.function.fun-farma-import-asig-personal-farma-fun-msg-text-fun-return-text-oficina-text-estado-text-perfil-referencia-boolean-pwd-text-title">
       fun_farma_import_asig_personal_farma(fun_msg text, fun_return text, oficina text, estado text, perfil_referencia boolean, pwd text)
      </title>
      <titleabbrev id="public.function.fun-farma-import-asig-personal-farma-fun-msg-text-fun-return-text-oficina-text-estado-text-perfil-referencia-boolean-pwd-text-titleabbrev">
       fun_farma_import_asig_personal_farma(fun_msg text, fun_return text, oficina text, estado text, perfil_referencia boolean, pwd text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

iidaccount INTEGER;
iidcontact INTEGER;
ipriority INTEGER DEFAULT 5;


BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;


-- Buscamos el idcontact segun la cedula
SELECT idcontact INTO iidcontact FROM contacts WHERE identification = cedula;

IF perfil_referencia LIKE &#39;PVAdm%&#39; THEN
ipriority := 3;
END IF;


-- Buscamos el idaccount segun la oficina
--iidaccount := fun_get_idaccount_by_account(oficina);
--iidaccount := fun_get_idaccount_by_account(oficina, 1);
iidaccount := fun_get_idaccount_by_account(oficina, 1);

IF iidaccount IS NOT NULL AND iidcontact IS NOT NULL THEN

INSERT INTO account_users(
            idaccount, idcontact, appointment, note, account_user, account_pwd, date_end, enabled, priority)
    VALUES (iidaccount, iidcontact, &#39;farma_&#39;||perfil_referencia::TEXT, &#39;Usuario asignado por Farmaenlace, no modificar el appointment&#39;, nombrecorto, pwd, &#39;2050-01-01 00:00&#39;, estado, ipriority) RETURNING idaccountuser INTO fun_return;

 fun_msg := &#39;Registro insertado&#39;;
ELSE

fun_return := -1;
 fun_msg := &#39;El registro no pudo ser insertado, idaccount e idcontact no pueden ser nulos&#39;;
END IF;


 



RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_import_nomina(fun_msg text, fun_return text, iemail timestamp without time zone, itelf2 text, itelf1 integer, iaddress_ref text, iaddress text, inote text, igender text, iidentification text, ibirthday text) -->
    <section id="public.function.fun-farma-import-nomina-fun-msg-text-fun-return-text-iemail-timestamp-without-time-zone-itelf2-text-itelf1-integer-iaddress-ref-text-iaddress-text-inote-text-igender-text-iidentification-text-ibirthday-text"
             xreflabel="publicfun_farma_import_nomina(fun_msg text, fun_return text, iemail timestamp without time zone, itelf2 text, itelf1 integer, iaddress_ref text, iaddress text, inote text, igender text, iidentification text, ibirthday text)">
      <title id="public.function.fun-farma-import-nomina-fun-msg-text-fun-return-text-iemail-timestamp-without-time-zone-itelf2-text-itelf1-integer-iaddress-ref-text-iaddress-text-inote-text-igender-text-iidentification-text-ibirthday-text-title">
       fun_farma_import_nomina(fun_msg text, fun_return text, iemail timestamp without time zone, itelf2 text, itelf1 integer, iaddress_ref text, iaddress text, inote text, igender text, iidentification text, ibirthday text)
      </title>
      <titleabbrev id="public.function.fun-farma-import-nomina-fun-msg-text-fun-return-text-iemail-timestamp-without-time-zone-itelf2-text-itelf1-integer-iaddress-ref-text-iaddress-text-inote-text-igender-text-iidentification-text-ibirthday-text-titleabbrev">
       fun_farma_import_nomina(fun_msg text, fun_return text, iemail timestamp without time zone, itelf2 text, itelf1 integer, iaddress_ref text, iaddress text, inote text, igender text, iidentification text, ibirthday text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE


BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;

UPDATE contacts
   SET first_name=ifirst_name, last_name=ilast_name, birthday=ibirthday, 
       gender=igender, note=inote, address=iaddress, address_ref=iaddress_ref WHERE identification=iidentification;

fun_return := 999;
fun_msg := &#39;Registro actualizado&#39;;

        IF NOT found THEN
INSERT INTO contacts(
            first_name, last_name, birthday, identification, 
            gender,  note, address, address_ref)
    VALUES (ifirst_name, ilast_name, ibirthday, iidentification, 
            igender,  inote, iaddress, iaddress_ref) RETURNING idcontact INTO fun_return;
--fun_return := -100;
fun_msg := &#39;Nuevo registro insertado&#39;;
ELSE

fun_return := (SELECT idcontact FROM contacts WHERE identification=iidentification AND first_name=ifirst_name AND last_name=ilast_name LIMIT 1);

        END IF;

PERFORM fun_farma_import_nomina_telf(fun_return, itelf1);
PERFORM fun_farma_import_nomina_telf(fun_return, itelf2);
PERFORM fun_farma_import_nomina_email(fun_return, iemail);
 
 EXCEPTION WHEN unique_violation THEN
 -- do nothing
 fun_return := -3;
 fun_msg := &#39;Registro tiene campos que deben ser unicos id=&#39;||iidentification::TEXT;

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_import_nomina_email(fun_msg integer, fun_return text) -->
    <section id="public.function.fun-farma-import-nomina-email-fun-msg-integer-fun-return-text"
             xreflabel="publicfun_farma_import_nomina_email(fun_msg integer, fun_return text)">
      <title id="public.function.fun-farma-import-nomina-email-fun-msg-integer-fun-return-text-title">
       fun_farma_import_nomina_email(fun_msg integer, fun_return text)
      </title>
      <titleabbrev id="public.function.fun-farma-import-nomina-email-fun-msg-integer-fun-return-text-titleabbrev">
       fun_farma_import_nomina_email(fun_msg integer, fun_return text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

iidemail INTEGER DEFAULT 0;

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;

SELECT idemail INTO iidemail FROM emails WHERE email = iemail;

-- 
UPDATE emails
   SET idcontact=iidcontact WHERE idemail = iidemail;

fun_return := 999;
fun_msg := &#39;Registro actualizado&#39;;

        IF NOT found THEN
INSERT INTO emails(
            idcontact, email)
    VALUES (iidcontact, iemail) RETURNING idemail INTO fun_return;
--fun_return := -100;
fun_msg := &#39;Nuevo registro insertado&#39;;
        END IF;
 

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_import_nomina_telf(fun_msg integer, fun_return text) -->
    <section id="public.function.fun-farma-import-nomina-telf-fun-msg-integer-fun-return-text"
             xreflabel="publicfun_farma_import_nomina_telf(fun_msg integer, fun_return text)">
      <title id="public.function.fun-farma-import-nomina-telf-fun-msg-integer-fun-return-text-title">
       fun_farma_import_nomina_telf(fun_msg integer, fun_return text)
      </title>
      <titleabbrev id="public.function.fun-farma-import-nomina-telf-fun-msg-integer-fun-return-text-titleabbrev">
       fun_farma_import_nomina_telf(fun_msg integer, fun_return text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

iidphone INTEGER DEFAULT 0;

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;

SELECT idphone INTO iidphone FROM phones WHERE &quot;number&quot; = itelf;

-- 
UPDATE phones
   SET idcontact=iidcontact WHERE idphone = iidphone;

fun_return := 999;
fun_msg := &#39;Registro actualizado&#39;;

        IF NOT found THEN
INSERT INTO phones(
            idcontact, &quot;number&quot;)
    VALUES (iidcontact, itelf) RETURNING idphone INTO fun_return;
--fun_return := -100;
fun_msg := &#39;Nuevo registro insertado&#39;;
        END IF;
 

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_update_lista_precios_farmacias(fun_msg integer, fun_return text, iprovincia text, i159productos integer, i159activa text, i159principal text, iproductos integer, iactiva text) -->
    <section id="public.function.fun-farma-update-lista-precios-farmacias-fun-msg-integer-fun-return-text-iprovincia-text-i159productos-integer-i159activa-text-i159principal-text-iproductos-integer-iactiva-text"
             xreflabel="publicfun_farma_update_lista_precios_farmacias(fun_msg integer, fun_return text, iprovincia text, i159productos integer, i159activa text, i159principal text, iproductos integer, iactiva text)">
      <title id="public.function.fun-farma-update-lista-precios-farmacias-fun-msg-integer-fun-return-text-iprovincia-text-i159productos-integer-i159activa-text-i159principal-text-iproductos-integer-iactiva-text-title">
       fun_farma_update_lista_precios_farmacias(fun_msg integer, fun_return text, iprovincia text, i159productos integer, i159activa text, i159principal text, iproductos integer, iactiva text)
      </title>
      <titleabbrev id="public.function.fun-farma-update-lista-precios-farmacias-fun-msg-integer-fun-return-text-iprovincia-text-i159productos-integer-i159activa-text-i159principal-text-iproductos-integer-iactiva-text-titleabbrev">
       fun_farma_update_lista_precios_farmacias(fun_msg integer, fun_return text, iprovincia text, i159productos integer, i159activa text, i159principal text, iproductos integer, iactiva text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

istatus TEXT DEFAULT &#39;INDEFINIDO&#39;;
isincro TEXT DEFAULT &#39;INDEFINIDO&#39;;
iip INET;

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;

IF (iprincipal = iactiva)  AND  iproductos &gt; 0 THEN
istatus := &#39;OK&#39;;
ELSE
istatus := &#39;ERROR&#39;;
END IF;

IF iprincipal = i159principal AND iactiva = i159activa  THEN
--IF EXISTS(SELECT * FROM farma_lista_precios_farmacias WHERE idaccount=iidaccount AND srv159_activa = activa AND productos = srv159_productos AND srv159_principal = principal)  THEN
isincro := &#39;OK&#39;;
ELSE
isincro := &#39;ERROR&#39;;
END IF;

select ip INTO iip from view_account_network_devices where idcontact = iidaccount AND  equipment ILIKE &#39;%SQL%&#39; LIMIT 1;

RAISE NOTICE &#39;(%) (%) &#39;, iprincipal, iactiva;
RAISE NOTICE &#39;(%) (%) &#39;, i159principal, i159activa;


--
UPDATE farma_lista_precios_farmacias
SET principal=iprincipal, 
activa=iactiva, 
productos=iproductos,
srv159_principal=i159principal, 
srv159_activa=i159activa, 
srv159_productos=i159productos, 

status = istatus,
sincronizado = isincro, 
ip = iip::text, 
provincia = iprovincia,
ts_lista_farmacia = now(),   
ts_lista_srv159 = now()
 WHERE idaccount=iidaccount;

RAISE NOTICE &#39;(%) (%) &#39;, iprincipal, iactiva;
RAISE NOTICE &#39;(%) (%) &#39;, i159principal, i159activa;

fun_return := 1;
fun_msg := &#39;Registro actualizado&#39;;

        IF NOT found THEN
/*
INSERT INTO farma_lista_precios_farmacias(
            idaccount, principal, activa, productos, status, sincronizado, ts_lista_farmacia, ip)
    VALUES (iidaccount, iprincipal, iactiva, iproductos, istatus, isincro, now(), iip::text) RETURNING idlista_precios INTO fun_return;
*/
INSERT INTO farma_lista_precios_farmacias(
            idaccount, principal, activa, productos, status, 
            ts, ts_lista_farmacia, srv159_activa, srv159_productos, srv159_principal, 
            ts_lista_srv159, sincronizado, provincia, ip)
    VALUES (iidaccount, iprincipal, iactiva, iproductos, istatus, 
           now(), now(), i159activa, i159productos, i159principal, 
            now(), isincro, iprovincia, iip);
fun_msg := &#39;Nuevo registro insertado&#39;;
        END IF;
 

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_farma_update_lista_precios_srv159(fun_msg text, fun_return text, iproductos text, iactiva integer) -->
    <section id="public.function.fun-farma-update-lista-precios-srv159-fun-msg-text-fun-return-text-iproductos-text-iactiva-integer"
             xreflabel="publicfun_farma_update_lista_precios_srv159(fun_msg text, fun_return text, iproductos text, iactiva integer)">
      <title id="public.function.fun-farma-update-lista-precios-srv159-fun-msg-text-fun-return-text-iproductos-text-iactiva-integer-title">
       fun_farma_update_lista_precios_srv159(fun_msg text, fun_return text, iproductos text, iactiva integer)
      </title>
      <titleabbrev id="public.function.fun-farma-update-lista-precios-srv159-fun-msg-text-fun-return-text-iproductos-text-iactiva-integer-titleabbrev">
       fun_farma_update_lista_precios_srv159(fun_msg text, fun_return text, iproductos text, iactiva integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

istatus TEXT DEFAULT &#39;INDEFINIDO&#39;;

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;

IF (iprincipal = iactiva)  AND  iproductos &gt; 0 THEN
istatus := &#39;OK&#39;;
ELSE
istatus := &#39;ERROR&#39;;
END IF;

-- 
UPDATE farma_lista_precios_farmacias
   SET principal=iprincipal, activa=iactiva, productos=iproductos, status = istatus
 WHERE idaccount=iidaccount;

fun_return := 1;
fun_msg := &#39;Registro actualizado&#39;;

        IF NOT found THEN
INSERT INTO farma_lista_precios_farmacias(
            idaccount, principal, activa, productos, status)
    VALUES (iidaccount, iprincipal, iactiva, iproductos, istatus) RETURNING idlista_precios INTO fun_return;
--fun_return := -100;
fun_msg := &#39;Nuevo registro insertado&#39;;
        END IF;
 

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_firts_load() -->
    <section id="public.function.fun-firts-load"
             xreflabel="publicfun_firts_load()">
      <title id="public.function.fun-firts-load-title">
       fun_firts_load()
      </title>
      <titleabbrev id="public.function.fun-firts-load-titleabbrev">
       fun_firts_load()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

BEGIN

fun_return := 0;
fun_msg := &#39;Carga inicial completada&#39;;



/*
-- Insertamos el registro 0 si no existe
IF NOT EXISTS(SELECT * FROM identification_types WHERE ididtype = 0) THEN
INSERT INTO identification_types(
            ididtype, enabled, name, note)
    VALUES (0, true, &#39;Undefined&#39;, &#39;Valor inicial del sistema (No modificar)&#39;);
END IF;

-- Insertamos el registro 0 si no existe
IF NOT EXISTS(SELECT * FROM account_types WHERE idaccounttype = 0) THEN
INSERT INTO account_types(
            idaccounttype, type, note)
    VALUES (0, &#39;Undefined&#39;, &#39;Valor inicial del sistema (No modificar)&#39;);

END IF;

-- Insertamos el registro 0 si no existe
IF NOT EXISTS(SELECT * FROM account_states WHERE idaccountstate = 0) THEN
INSERT INTO account_states(
            idaccountstate, state, note)
    VALUES (0, &#39;Undefined&#39;, &#39;Valor inicial del sistema (No modificar)&#39;);
END IF;


-- Insertamos el registro 0 si no existe
IF NOT EXISTS(SELECT * FROM groups WHERE idgroup = 0) THEN
INSERT INTO groups(
            idgroup, enabled, name, description, note)
    VALUES (0, true, &#39;None&#39;, &#39;Ningun grupo establecido&#39;, &#39;Valor inicial del sistema (No modificar)&#39;);
END IF;


-- Insertamos el registro -1 si no existe
IF NOT EXISTS(SELECT * FROM groups WHERE idgroup = -1) THEN
INSERT INTO groups(
            idgroup, enabled, name, description, note)
    VALUES (-1, true, &#39;oams_admin&#39;, &#39;Admins&#39;, &#39;Grupo de Administradores&#39;);
END IF;


-- Insertamos el registro 0 si no existe
IF NOT EXISTS(SELECT * FROM phone_types WHERE idphonetype = 0) THEN
INSERT INTO phone_types(
            idphonetype, type)
    VALUES (0, &#39;Undefined&#39;);
END IF;

-- Insertamos el registro 0 si no existe
IF NOT EXISTS(SELECT * FROM eventtypes WHERE ideventtype = 0) THEN
INSERT INTO eventtypes(
            ideventtype, name, priority, treatment, manual, date_editable, note, label, code)
    VALUES (0, &#39;unknown&#39;, 50, true, false, false, &#39;Valor inicial del sistema (No modificar)&#39;, &#39;Evento Desconocido&#39;, &#39;oams-0&#39;);
END IF;

----------------------------------------------------------------------
-- Insertamos el registro 1000 si no existe
IF NOT EXISTS(SELECT * FROM eventtypes WHERE ideventtype = 1000) THEN
INSERT INTO eventtypes(
            ideventtype, name, priority, treatment, manual, date_editable, note, label, code)
    VALUES (1000, &#39;login&#39;, 100, false, false, false, &#39;Evento del sistema, no modificar&#39;, &#39;User Login&#39;, &#39;oams-1000&#39;);
END IF;

-- Insertamos el registro 1001 si no existe
IF NOT EXISTS(SELECT * FROM eventtypes WHERE ideventtype = 1001) THEN
INSERT INTO eventtypes(
            ideventtype, name, priority, treatment, manual, date_editable, note, label, code)
    VALUES (1001, &#39;logout&#39;, 100, false, false, false, &#39;Evento del sistema, no modificar&#39;, &#39;User Logout&#39;, &#39;oams-1001&#39;);
END IF;

-- Insertamos el registro 1002 si no existe
IF NOT EXISTS(SELECT * FROM eventtypes WHERE ideventtype = 1002) THEN
INSERT INTO eventtypes(
            ideventtype, name, priority, treatment, manual, date_editable, note, label, code)
    VALUES (1002, &#39;login fail&#39;, 20, false, false, false, &#39;Evento del sistema, no modificar&#39;, &#39;Login fail&#39;, &#39;oams-1002&#39;);
END IF;

-- Insertamos el registro 1003 si no existe
IF NOT EXISTS(SELECT * FROM eventtypes WHERE ideventtype = 1003) THEN
INSERT INTO eventtypes(
            ideventtype, name, priority, treatment, manual, date_editable, note, label, code)
    VALUES (1003, &#39;account_unknown&#39;, 20, false, false, false, &#39;Evento del sistema, no modificar&#39;, &#39;&quot;account_unknown&quot;&#39;, &#39;oams-1003&#39;);
END IF;


-- Insertamos el registro 1003 si no existe
IF NOT EXISTS(SELECT * FROM eventtypes WHERE ideventtype = 1004) THEN
INSERT INTO eventtypes(
            ideventtype, name, priority, treatment, manual, date_editable, note, label, code)
    VALUES (1004, &#39;Unauthorized&#39;, 10, false, false, false, &#39;Evento del sistema, no modificar&#39;, &#39;&quot;System Unauthorized Access&quot;&#39;, &#39;oams-1004&#39;);
END IF;

---------------------------------------------------------------
-- Insertamos el abonado 0 si no existe
IF NOT EXISTS(SELECT * FROM accounts WHERE idcontact = 0) THEN
INSERT INTO accounts(
            idcontact, enabled, first_name, last_name, birthday, identification, 
            ididtype, postal_code, gender, geox, geoy, note, address, address_ref, 
            idaccountstate, idaccounttype, start_date, end_date, account)
    VALUES (0, true, &#39;AMS&#39;, &#39;Open&#39;, now(), md5(&#39;oams&#39;), 
            0, &#39;0000&#39;, 0, 0, 0, &#39;&#39;, &#39;&#39;, &#39;&#39;, 
            0, 0, now(), &#39;2099-01-01 00:00&#39;, &#39;System&#39;);
END IF;

-- Insertamos el abonado 1 si no existe
IF NOT EXISTS(SELECT * FROM accounts WHERE idcontact = 1) THEN
INSERT INTO accounts(
            idcontact, enabled, first_name, last_name, birthday, identification, 
            ididtype, postal_code, gender, geox, geoy, note, address, address_ref, 
            idaccountstate, idaccounttype, start_date, end_date, account)
    VALUES (1, true, &#39;undefined&#39;, &#39;account&#39;, now(), md5(&#39;oams-undefined&#39;), 
            0, &#39;00000&#39;, 0, 0, 0, &#39;&#39;, &#39;&#39;, &#39;&#39;, 
            0, 0, now(), &#39;2099-01-01 00:00&#39;, &#39;undefined&#39;);
END IF;


-----------------------------------------------------------------
-- Insertamos el registro 0 si no existe
IF NOT EXISTS(SELECT * FROM providers WHERE idprovider = 0) THEN
INSERT INTO providers(
            idprovider, provider)
    VALUES (0, &#39;Undefined&#39;);
END IF;

----------------------------------------------------------------
-- Insertamos el registro 0 si no existe (Default) 
IF NOT EXISTS(SELECT * FROM contacts WHERE idcontact = -1) THEN
INSERT INTO contacts(
            idcontact, enabled, first_name, last_name, identification, 
            is_admin, admin_start, admin_end, admin_username, admin_pwd, 
            admin_level)
    VALUES (-1, true, &#39;Alarm Management System&#39;, &#39;Open&#39;, &#39;oams&#39;, 
            true, now(), &#39;2050-01-01 00:00:00&#39;, &#39;admin&#39;, &#39;admin&#39;, 
            0);
END IF;
*/


RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_gen_md5_by_schema_table_obj(obj text, table text, schema text, prefix text) -->
    <section id="public.function.fun-gen-md5-by-schema-table-obj-obj-text-table-text-schema-text-prefix-text"
             xreflabel="publicfun_gen_md5_by_schema_table_obj(obj text, table text, schema text, prefix text)">
      <title id="public.function.fun-gen-md5-by-schema-table-obj-obj-text-table-text-schema-text-prefix-text-title">
       fun_gen_md5_by_schema_table_obj(obj text, table text, schema text, prefix text)
      </title>
      <titleabbrev id="public.function.fun-gen-md5-by-schema-table-obj-obj-text-table-text-schema-text-prefix-text-titleabbrev">
       fun_gen_md5_by_schema_table_obj(obj text, table text, schema text, prefix text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R TEXT DEFAULT &#39;&#39;;

BEGIN

IF LENGTH(prefix) &gt; 0 THEN
R := (prefix||&#39;_&#39;||md5(&quot;schema&quot;||&quot;table&quot;||obj)::TEXT);
ELSE
R := md5(&quot;schema&quot;||&quot;table&quot;||obj);
END IF;



RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_general_login(msg text, idcontact text, fullname text, username inet, login boolean) -->
    <section id="public.function.fun-general-login-msg-text-idcontact-text-fullname-text-username-inet-login-boolean"
             xreflabel="publicfun_general_login(msg text, idcontact text, fullname text, username inet, login boolean)">
      <title id="public.function.fun-general-login-msg-text-idcontact-text-fullname-text-username-inet-login-boolean-title">
       fun_general_login(msg text, idcontact text, fullname text, username inet, login boolean)
      </title>
      <titleabbrev id="public.function.fun-general-login-msg-text-idcontact-text-fullname-text-username-inet-login-boolean-titleabbrev">
       fun_general_login(msg text, idcontact text, fullname text, username inet, login boolean)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

idcontact_admin bigint DEFAULT -100;
iideventtype INTEGER DEFAULT 0;

BEGIN

idcontact_admin := -500;
login := false;
fullname := &#39;anonymous&#39;;
msg := &#39;Error desconocido&#39;;
username := &#39;anonymous&#39;;
--sessionid := &#39;----&#39;;


IF isadmin THEN

CASE

WHEN NOT EXISTS(SELECT * FROM admins WHERE admin_username = iusername) THEN 
msg := &#39;- Intento de acceso con el usuario &#39;||iusername||&#39; no existe o no esta habilitado como administrador.&lt;/br&gt; [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
iideventtype := 1002;

WHEN NOT EXISTS(SELECT * FROM admins WHERE admin_username = iusername AND admin_pwd = md5(ipwd)) THEN
msg := &#39;- Intento de acceso con el usuario &#39;||iusername||&#39; - Usuario o clave incorrecta. [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
iideventtype := 1002;

WHEN NOT EXISTS(SELECT * FROM admins WHERE admin_username = iusername AND admin_pwd = md5(ipwd) AND (now() BETWEEN admin_start AND admin_end)) THEN
msg := &#39;- Intento de acceso del usuario &#39;||iusername||&#39; fuera del rango de fechas autorizadas para l. [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
iideventtype := 1002;

WHEN EXISTS(SELECT * FROM admins WHERE admin_username = iusername AND admin_pwd = md5(ipwd)) THEN
-- Actualizamos el ssessionid en la tabla
--UPDATE admins SET isessionid = md5(iusername||&#39;+&#39;||iip||&#39;+&#39;||iuseragent||&#39;+&#39;||(extract(epoch FROM now())::TEXT)), admin_ip = iip, last_access = now(), last_heartbeat = now() WHERE admin_username = iusername AND admin_pwd = md5(ipwd) RETURNING admins.idadmin, admins.idcontact INTO idadmin, idcontact_admin;
-- Insertamos en el log del sistema el ingreso
msg := &#39;- Acceso al sistema. Usuario: &#39;||iusername||&#39;. [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
iideventtype := 1000;
--sessionid := md5(iusername||&#39;+&#39;||iip||&#39;+&#39;||iuseragent||&#39;+&#39;||(extract(epoch FROM now())::TEXT));

--SELECT admin_username, admin_sessionid INTO username, sessionid FROM admins WHERE idcontact = idcontact_admin;
SELECT contacts.idcontact,   (contacts.last_name ||&#39; &#39;|| contacts.first_name) as full_name INTO idcontact, fullname FROM public.contacts, public.admins WHERE contacts.idcontact = admins.idcontact AND admins.admin_username = iusername AND admins.admin_pwd = md5(ipwd);

login := true;

PERFORM fun_notification_app_send(10, 10, true, &#39;&#39;, &#39;&#39;, &#39;Bienvenid@&#39;, fullname, idcontact);
PERFORM fun_notification_app_send(10, 10, TRUE, &#39;&#39;, &#39;&#39;, &#39;Usuario conectado&#39;, fullname, null);


ELSE

msg := &#39;- Ninguna validacion ha sido realizada para el usuario &#39;||iusername||&#39; no existe o no esta habilitado. [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
iideventtype := 1002;
--INSERT INTO event_login(            idaccount, ideventtype, description, idcontact)    VALUES (0, 1002, msg, idcontact);

END CASE;




ELSE
-------------------------------
-- Intenta como usuario
-------------------------------


END IF;

INSERT INTO events_login(idaccount, ideventtype, description, ip, idcontact) VALUES (0, iideventtype, msg, iip, idcontact);

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_get_idaccount_by_account(iiddivision text, iaccount bigint) -->
    <section id="public.function.fun-get-idaccount-by-account-iiddivision-text-iaccount-bigint"
             xreflabel="publicfun_get_idaccount_by_account(iiddivision text, iaccount bigint)">
      <title id="public.function.fun-get-idaccount-by-account-iiddivision-text-iaccount-bigint-title">
       fun_get_idaccount_by_account(iiddivision text, iaccount bigint)
      </title>
      <titleabbrev id="public.function.fun-get-idaccount-by-account-iiddivision-text-iaccount-bigint-titleabbrev">
       fun_get_idaccount_by_account(iiddivision text, iaccount bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

R INTEGER DEFAULT 1;

BEGIN

R := COALESCE((SELECT idcontact FROM accounts WHERE account = iaccount AND iddivision = iiddivision ORDER BY idcontact  DESC LIMIT 1), 1);

IF R &lt; 2 THEN
-- Verificamos si existe el account, caso contrario le asignamos como 0 (desconocido)
--PERFORM fun_event_insert_by_ideventtype(now()::timestamp without time zone, R, 0, 0, 1003, &#39;Account &#39;||iaccount||&#39; no found&#39;, 0);
INSERT INTO events( ideventtype, description)
    VALUES (1003, &#39;Account &#39;||iaccount||&#39; no found&#39;);

--R := 1;
END IF;

RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_heartbeat(isessionid bigint, iidadmin text) -->
    <section id="public.function.fun-heartbeat-isessionid-bigint-iidadmin-text"
             xreflabel="publicfun_heartbeat(isessionid bigint, iidadmin text)">
      <title id="public.function.fun-heartbeat-isessionid-bigint-iidadmin-text-title">
       fun_heartbeat(isessionid bigint, iidadmin text)
      </title>
      <titleabbrev id="public.function.fun-heartbeat-isessionid-bigint-iidadmin-text-titleabbrev">
       fun_heartbeat(isessionid bigint, iidadmin text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
r boolean DEFAULT false;
idupdated bigint DEFAULT 0;
BEGIN
/*
PERFORM fun_expired_session();

IF EXISTS(SELECT * FROM admins WHERE idadmin = iidadmin AND admin_sessionid = isessionid) THEN
UPDATE admins SET last_heartbeat = now() WHERE idadmin = iidadmin AND admin_sessionid = isessionid;
r := true;
END IF;
*/

RETURN r;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_last_modified_table_remove_olds() -->
    <section id="public.function.fun-last-modified-table-remove-olds"
             xreflabel="publicfun_last_modified_table_remove_olds()">
      <title id="public.function.fun-last-modified-table-remove-olds-title">
       fun_last_modified_table_remove_olds()
      </title>
      <titleabbrev id="public.function.fun-last-modified-table-remove-olds-titleabbrev">
       fun_last_modified_table_remove_olds()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

fun_return INTEGER DEFAULT 0;
--cursor1 CURSOR FOR SELECT * FROM view_last_modif_tables;
    --cursor1_row RECORD;

BEGIN
/*
IF (SELECT COUNT(*) FROM pg_stat_activity where query = &#39;SELECT * FROM fun_last_modified_table_remove_olds();&#39;) = 1  THEN

WITH rows AS (
    DELETE FROM table_modification_log  WHERE idtablemodif NOT IN(SELECT last_value(idtablemodif) OVER (
    PARTITION BY tschema_tname
  ) AS id
FROM view_last_modif_tables)
    RETURNING 1
)
SELECT count(*) INTO fun_return FROM rows;

ELSE
fun_return := -1;
END IF;

*/
/*
    FOR cursor1_row IN cursor1 LOOP

 DELETE FROM table_modification_log WHERE table_name = cursor1_row.table_name AND schema_name = cursor1_row.schema_name AND idtablemodif &lt; cursor1_row.idtablemodif;
fun_return := fun_return+1;
    END LOOP;
*/

    

RETURN fun_return;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_login_system(iuseragent text, iip text, ipwd inet, iuser text) -->
    <section id="public.function.fun-login-system-iuseragent-text-iip-text-ipwd-inet-iuser-text"
             xreflabel="publicfun_login_system(iuseragent text, iip text, ipwd inet, iuser text)">
      <title id="public.function.fun-login-system-iuseragent-text-iip-text-ipwd-inet-iuser-text-title">
       fun_login_system(iuseragent text, iip text, ipwd inet, iuser text)
      </title>
      <titleabbrev id="public.function.fun-login-system-iuseragent-text-iip-text-ipwd-inet-iuser-text-titleabbrev">
       fun_login_system(iuseragent text, iip text, ipwd inet, iuser text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       Retorna los datos del usuario o administrador
        <programlisting>DECLARE

r JSON;
iideventtype BIGINT;
msg TEXT;
islogged BOOLEAN DEFAULT false;

BEGIN

----------- Busca primero los datos como administrador -------------------
CASE

WHEN NOT EXISTS(SELECT * FROM admins WHERE admin_username = iuser) THEN 
--msg := &#39;- Intento de acceso con el usuario &#39;||iuser||&#39; no existe o no esta habilitado como administrador.&lt;/br&gt; [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
msg := &#39;- Intento de acceso con el usuario &#39;||iuser||&#39; no existe o no esta habilitado como administrador.&lt;/br&gt;&#39;;
iideventtype := 1002;

WHEN NOT EXISTS(SELECT * FROM admins WHERE admin_username = iuser AND admin_pwd = md5(ipwd)) THEN
--msg := &#39;- Intento de acceso con el usuario &#39;||iuser||&#39; - Usuario o clave incorrecta. [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
msg := &#39;- Intento de acceso con el usuario &#39;||iuser||&#39; - Usuario o clave incorrecta.&#39;;
iideventtype := 1002;

WHEN NOT EXISTS(SELECT * FROM admins WHERE admin_username = iuser AND admin_pwd = md5(ipwd) AND (now() BETWEEN admin_start AND admin_end)) THEN
--msg := &#39;- Intento de acceso del usuario &#39;||iuser||&#39; fuera del rango de fechas autorizadas para l. [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
msg := &#39;- Intento de acceso del usuario &#39;||iuser||&#39; fuera del rango de fechas autorizadas para l.&#39;;
iideventtype := 1002;

WHEN EXISTS(SELECT * FROM admins WHERE admin_username = iuser AND admin_pwd = md5(ipwd)) THEN
--msg := &#39;- Acceso al sistema. Administrador: &#39;||iuser||&#39;. [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
msg := &#39;- Acceso al sistema. Administrador: &#39;||iuser;

iideventtype := 1000;

SELECT row_to_json(t) INTO r
from (
   SELECT *, &#39;A&#39;||idadmin as idlogin, contact_name as fullname, true as isadmin FROM public.view_admins WHERE admin_username = iuser AND admin_pwd = md5(ipwd)
) t;

islogged := true;

ELSE
------ Buscamos como usuario ------
IF EXISTS(SELECT * FROM view_account_users WHERE account_user = iuser AND account_pwd = decode(ipwd::BYTEA, &#39;base64&#39;)) THEN
SELECT row_to_json(t) INTO r
from (
   SELECT * FROM view_account_users WHERE account_user = iuser AND account_pwd = decode(ipwd::BYTEA, &#39;base64&#39;)
) t;
islogged := true;
--msg := &#39;- Acceso autorizado al sistema. Usuario: &#39;||iuser||&#39;. [IP: &#39;||iip||&#39;] [Navegador: &#39;||iuseragent||&#39;]&#39;;
msg := &#39;- Acceso autorizado al sistema. Usuario: &#39;||iuser;
iideventtype := 1002;

ELSE

msg := &#39;- Intento de acceso al sistema. Usuario: &#39;||iuser;
iideventtype := 1002;
END IF;

END CASE;


RAISE NOTICE &#39;1) Es adsmin %&#39;, r-&gt;&gt;&#39;isadmin&#39;;
RAISE NOTICE &#39;2) Es idadmin %&#39;, r-&gt;&gt;&#39;idadmin&#39;;

IF r-&gt;&gt;&#39;isadmin&#39; = &#39;true&#39; THEN
--INSERT INTO events.datas(
  --          idaccount, ideventtype, description, idadmin, idcontact_user, details)
    --VALUES (0, iideventtype, msg, (r-&gt;&gt;&#39;idadmin&#39;)::BIGINT, (r-&gt;&gt;&#39;idcontact&#39;)::BIGINT, (SELECT row_to_json(t)from (  select iuseragent as useragent, iip as ip ) t)::jsonb);
ELSE

    
END IF;


IF islogged THEN
--PERFORM fun_notification_app_send(10, 10, true, &#39;&#39;, &#39;&#39;, &#39;Bienvenid@&#39;, fullname, idadmin);
PERFORM gui.fun_notification_app_send(10, 10, TRUE, &#39;&#39;, &#39;&#39;, &#39;Usuario conectado&#39;, r-&gt;&gt;&#39;fullname&#39;, null);
END IF;



return r;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_pnatural_import_accounts(fun_msg text, fun_return text, cedula_sup_operativo text, iemail text, telf2 text, telf1 timestamp without time zone, idb_pwd timestamp without time zone, idb_user text, iaccount text, iend_date text, istart_date text, iaddress_ref text, iaddress text, ilast_name text) -->
    <section id="public.function.fun-pnatural-import-accounts-fun-msg-text-fun-return-text-cedula-sup-operativo-text-iemail-text-telf2-text-telf1-timestamp-without-time-zone-idb-pwd-timestamp-without-time-zone-idb-user-text-iaccount-text-iend-date-text-istart-date-text-iaddress-ref-text-iaddress-text-ilast-name-text"
             xreflabel="publicfun_pnatural_import_accounts(fun_msg text, fun_return text, cedula_sup_operativo text, iemail text, telf2 text, telf1 timestamp without time zone, idb_pwd timestamp without time zone, idb_user text, iaccount text, iend_date text, istart_date text, iaddress_ref text, iaddress text, ilast_name text)">
      <title id="public.function.fun-pnatural-import-accounts-fun-msg-text-fun-return-text-cedula-sup-operativo-text-iemail-text-telf2-text-telf1-timestamp-without-time-zone-idb-pwd-timestamp-without-time-zone-idb-user-text-iaccount-text-iend-date-text-istart-date-text-iaddress-ref-text-iaddress-text-ilast-name-text-title">
       fun_pnatural_import_accounts(fun_msg text, fun_return text, cedula_sup_operativo text, iemail text, telf2 text, telf1 timestamp without time zone, idb_pwd timestamp without time zone, idb_user text, iaccount text, iend_date text, istart_date text, iaddress_ref text, iaddress text, ilast_name text)
      </title>
      <titleabbrev id="public.function.fun-pnatural-import-accounts-fun-msg-text-fun-return-text-cedula-sup-operativo-text-iemail-text-telf2-text-telf1-timestamp-without-time-zone-idb-pwd-timestamp-without-time-zone-idb-user-text-iaccount-text-iend-date-text-istart-date-text-iaddress-ref-text-iaddress-text-ilast-name-text-titleabbrev">
       fun_pnatural_import_accounts(fun_msg text, fun_return text, cedula_sup_operativo text, iemail text, telf2 text, telf1 timestamp without time zone, idb_pwd timestamp without time zone, idb_user text, iaccount text, iend_date text, istart_date text, iaddress_ref text, iaddress text, ilast_name text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
id BIGINT DEFAULT 0;
ienabled BOOLEAN DEFAULT TRUE;
idldf INTEGER DEFAULT 0;
ifirst_name text default &#39;&#39;;
iidaccounttype INTEGER DEFAULT 0;

ifname text default &#39;&#39;;
ilname text default &#39;&#39;;

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;
id := fun_get_idaccount_by_account(iaccount, 1);
idldf := COALESCE((SELECT idcontact FROM contacts WHERE identification = cedula_sup_operativo LIMIT 1), 0);

CASE
WHEN position(&#39;PUNTO&#39; in ilast_name) = 1 THEN
ifname := substring(ilast_name from 6 for 100);
ilname := &#39;PUNTO NATURAL&#39;;

WHEN position(&#39;ECO &#39; in ilast_name) = 1 THEN
ifname := substring(ilast_name from 5 for 100);
ilname := &#39;ECO&#39;;

WHEN position(&#39;PAF &#39; in ilast_name) = 1 THEN
ifname := substring(ilast_name from 5 for 100);
ilname := &#39;PAF&#39;;

ELSE

ifname := &#39; *&#39;;
ilname := ilast_name;

END CASE;

IF istatus != &#39;A&#39; THEN
ienabled := FALSE;
END IF;

IF franquicia = &#39;N&#39; THEN
iidaccounttype := 3;
ELSE
iidaccounttype := 4;
END IF;

RAISE NOTICE &#39;Account (%) con ID (%)&#39;, iaccount, id;

-- Para este caso ilast_name se lo utiliza como nombre y * como apellido

CASE

	WHEN id &lt;= 1 THEN
	BEGIN

-- Verificamos que no se repita el abonado
	iaccount := fun_account_auto_account(iaccount);

-- Ingresamos un nuevo registro
INSERT INTO accounts(
            enabled, first_name, last_name, birthday, identification, 
            address, address_ref, 
            start_date, end_date, account, idaccounttype, iddivision)
    VALUES (ienabled,  ilname, ifname, istart_date, iaccount, 
            iaddress, iaddress_ref, 
            istart_date, iend_date, iaccount, iidaccounttype, 2)
 RETURNING idcontact INTO fun_return;
fun_msg := &#39;Nuevo registro insertado&#39;;

IF fun_return &gt; 0 THEN

PERFORM fun_farma_import_accounts_insertphone(fun_return, telf1);
PERFORM fun_farma_import_accounts_insertphone(fun_return, telf2);
PERFORM fun_farma_import_accounts_insertemail(fun_return, iemail);

DELETE FROM account_contacts WHERE appointment = &#39;PNatural_LDF&#39; AND idaccount = fun_return;
IF idldf &gt; 0 THEN
INSERT INTO account_contacts (idaccount, idcontact, appointment, priority) VALUES (fun_return, idldf, &#39;PNatural_LDF&#39;, 2);
END IF;

END IF;

fun_msg := fun_return;

EXCEPTION WHEN unique_violation THEN
 -- do nothing
 fun_return := -2;
 fun_msg := &#39;Registro tiene campos que deben ser unicos&#39;||iaccount||&#39; &#39;||ilast_name||&#39; &#39;||iaccount;
END;


	WHEN id &gt; 1  THEN
BEGIN	
-- Actualizamos
RAISE NOTICE &#39;Account (%) con ID (%) para actualizar cuenta&#39;, iaccount, id;
UPDATE accounts
   SET iddivision = 1, first_name=ifname, last_name=ilname, birthday=istart_date, 
       identification=iaccount, address=iaddress, address_ref=iaddress_ref, start_date=istart_date, end_date=iend_date, account=iaccount, idaccounttype = iidaccounttype
 WHERE idcontact = id;
 fun_return := id;
 fun_msg := &#39;Registro Actualizado&#39;;
RAISE NOTICE &#39;Account (%) con ID (%) para actualizar telefonos&#39;, iaccount, id;

PERFORM fun_farma_import_accounts_insertphone(id, telf1);
PERFORM fun_farma_import_accounts_insertphone(id, telf2);
PERFORM fun_farma_import_accounts_insertemail(id, iemail);

RAISE NOTICE &#39;Account (%) con ID (%) para actualizar - Eliminamos el LDF&#39;, iaccount, id;
DELETE FROM account_contacts WHERE appointment = &#39;PNatural_LDF&#39; AND idaccount = id;

RAISE NOTICE &#39;Account (%) con ID (%) para actualizar ldf&#39;, iaccount, id;
IF idldf &gt; 0 THEN
INSERT INTO account_contacts (idaccount, idcontact, appointment, priority) VALUES (id, idldf, &#39;PNatural_LDF&#39;, 2);
END IF;

/*
RAISE NOTICE &#39;Account (%) con ID (%) para actualizar datos del servidor (% =&gt; %)&#39;, iaccount, id, idb_user, idb_pwd;
-- Actualizamos los datos del servidor
UPDATE network_devices
   SET username=idb_user, pwd=idb_pwd WHERE idaccount=id AND equipment=&#39;Server&#39; AND mark=&#39;Farma01&#39;;
        IF NOT found THEN

IF id &gt; 0 THEN
RAISE NOTICE &#39;Account (%) con ID (%) para actualizar / Datos del servidor no encontrados, se inserta.&#39;, iaccount, id;        
INSERT INTO network_devices(
            equipment, mark, description, 
            username, pwd, idaccount)
    VALUES (&#39;Server&#39;, &#39;Farma01&#39;, &#39;Servidor de farmacia Nueva &#39;||id::text, 
            idb_user, idb_pwd, fun_return);
END IF;
        END IF;
*/
 /*
-- Actualizamos los datos del gateway
UPDATE network_devices
   SET note = &#39;No modificar esta nota&#39; WHERE idaccount=fun_return AND equipment=&#39;Gateway&#39;;
        IF NOT found THEN
IF fun_return &gt; 0 THEN
INSERT INTO network_devices(
            equipment, description, idaccount, note)
    VALUES (&#39;Gateway&#39;, &#39;Gateway de farmacia &#39;||fun_return::text, 
            fun_return, &#39;No modificar o borrar esta nota&#39;);
END IF;
        END IF;
*/

fun_msg := id;

 EXCEPTION WHEN unique_violation THEN
 -- do nothing
 fun_return := -3;
 fun_msg := &#39;Registro tiene campos que deben ser unicos id=&#39;||id::TEXT||&#39; &#39;||iaccount||&#39; &#39;||ilast_name||;
 
END;




	WHEN id &lt; 0  THEN
-- Eliminamos
/*DELETE FROM accounts
 WHERE idcontact=id;
 fun_return := 0;
 fun_msg := &#39;Registro Eliminado&#39;;*/

ELSE

 END CASE;


RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_pnatural_import_asig_personal_pnatural(fun_msg text, fun_return text, oficina text, estado text, perfil_referencia boolean, pwd text) -->
    <section id="public.function.fun-pnatural-import-asig-personal-pnatural-fun-msg-text-fun-return-text-oficina-text-estado-text-perfil-referencia-boolean-pwd-text"
             xreflabel="publicfun_pnatural_import_asig_personal_pnatural(fun_msg text, fun_return text, oficina text, estado text, perfil_referencia boolean, pwd text)">
      <title id="public.function.fun-pnatural-import-asig-personal-pnatural-fun-msg-text-fun-return-text-oficina-text-estado-text-perfil-referencia-boolean-pwd-text-title">
       fun_pnatural_import_asig_personal_pnatural(fun_msg text, fun_return text, oficina text, estado text, perfil_referencia boolean, pwd text)
      </title>
      <titleabbrev id="public.function.fun-pnatural-import-asig-personal-pnatural-fun-msg-text-fun-return-text-oficina-text-estado-text-perfil-referencia-boolean-pwd-text-titleabbrev">
       fun_pnatural_import_asig_personal_pnatural(fun_msg text, fun_return text, oficina text, estado text, perfil_referencia boolean, pwd text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

iidaccount INTEGER;
iidcontact INTEGER;
ipriority INTEGER DEFAULT 5;


BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;


-- Buscamos el idcontact segun la cedula
SELECT idcontact INTO iidcontact FROM contacts WHERE identification = cedula;

IF perfil_referencia LIKE &#39;PVAdm%&#39; THEN
ipriority := 3;
END IF;


-- Buscamos el idaccount segun la oficina
--iidaccount := fun_get_idaccount_by_account(oficina);
--iidaccount := fun_get_idaccount_by_account(oficina, 1);
iidaccount := fun_get_idaccount_by_account(oficina, 2);

IF iidaccount IS NOT NULL AND iidcontact IS NOT NULL THEN

INSERT INTO account_users(
            idaccount, idcontact, appointment, note, account_user, account_pwd, date_end, enabled, priority)
    VALUES (iidaccount, iidcontact, &#39;pnatural_&#39;||perfil_referencia::TEXT, &#39;Usuario asignado por Punto Natural, no modificar el appointment&#39;, nombrecorto, pwd, &#39;2050-01-01 00:00&#39;, estado, ipriority) RETURNING idaccountuser INTO fun_return;

 fun_msg := &#39;Registro insertado&#39;;
ELSE

fun_return := -1;
 fun_msg := &#39;El registro no pudo ser insertado, idaccount e idcontact no pueden ser nulos&#39;;
END IF;


 



RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_quick_create_account(fun_msg integer, fun_return integer, iaddress_ref text, iaddress text, iididtype text, iidentification text, ilast_name integer, ifirst_name text, iaccount text) -->
    <section id="public.function.fun-quick-create-account-fun-msg-integer-fun-return-integer-iaddress-ref-text-iaddress-text-iididtype-text-iidentification-text-ilast-name-integer-ifirst-name-text-iaccount-text"
             xreflabel="publicfun_quick_create_account(fun_msg integer, fun_return integer, iaddress_ref text, iaddress text, iididtype text, iidentification text, ilast_name integer, ifirst_name text, iaccount text)">
      <title id="public.function.fun-quick-create-account-fun-msg-integer-fun-return-integer-iaddress-ref-text-iaddress-text-iididtype-text-iidentification-text-ilast-name-integer-ifirst-name-text-iaccount-text-title">
       fun_quick_create_account(fun_msg integer, fun_return integer, iaddress_ref text, iaddress text, iididtype text, iidentification text, ilast_name integer, ifirst_name text, iaccount text)
      </title>
      <titleabbrev id="public.function.fun-quick-create-account-fun-msg-integer-fun-return-integer-iaddress-ref-text-iaddress-text-iididtype-text-iidentification-text-ilast-name-integer-ifirst-name-text-iaccount-text-titleabbrev">
       fun_quick_create_account(fun_msg integer, fun_return integer, iaddress_ref text, iaddress text, iididtype text, iidentification text, ilast_name integer, ifirst_name text, iaccount text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

--iidcontact INTEGER DEFAULT 0;
--iidaccount INTEGER DEFAULT 0;

BEGIN
fun_msg := &#39;Ninguna accion realizada&#39;;
fun_return := 0;
  CASE

	WHEN EXISTS(SELECT * FROM accounts WHERE identification = iidentification AND ididtype = iididtype) THEN
		fun_msg := &#39;El numero de identificacin ya existe&#39;;
	WHEN EXISTS(SELECT * FROM accounts WHERE first_name = ifirst_name AND last_name = ilast_name) THEN 
		fun_msg := &#39;Un abonado o contacto ya existe con esos nombres&#39;;
  ELSE

INSERT INTO accounts(
            first_name, last_name, identification, 
            ididtype, address, address_ref, 
            idaccountstate, idaccounttype, account)
    VALUES (ifirst_name, ilast_name, iidentification, 
            iididtype, iaddress, iaddress_ref, 
            iidaccountstate, iidaccounttype, iaccount) RETURNING idcontact INTO fun_return;

IF fun_return &gt; 0 THEN
fun_msg := &#39;El abonado ha sido creado&#39;;
END IF;

  END CASE;          

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_remove_last_modified_cells() -->
    <section id="public.function.fun-remove-last-modified-cells"
             xreflabel="publicfun_remove_last_modified_cells()">
      <title id="public.function.fun-remove-last-modified-cells-title">
       fun_remove_last_modified_cells()
      </title>
      <titleabbrev id="public.function.fun-remove-last-modified-cells-titleabbrev">
       fun_remove_last_modified_cells()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN
--DELETE FROM last_modified_cells 
--WHERE  ts &gt; (now() - INTERVAL &#39;1 minutes&#39; ); -- EXTRACT(EPOCH FROM (now() - ts) / 60) &gt; 2;
RETURN TRUE;
END;
</programlisting>
      </para>
    </section>

<!-- Function fun_sufix_name_by_date(idate timestamp with time zone) -->
    <section id="public.function.fun-sufix-name-by-date-idate-timestamp-with-time-zone"
             xreflabel="publicfun_sufix_name_by_date(idate timestamp with time zone)">
      <title id="public.function.fun-sufix-name-by-date-idate-timestamp-with-time-zone-title">
       fun_sufix_name_by_date(idate timestamp with time zone)
      </title>
      <titleabbrev id="public.function.fun-sufix-name-by-date-idate-timestamp-with-time-zone-titleabbrev">
       fun_sufix_name_by_date(idate timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

r TEXT DEFAULT &#39;19900101&#39;;

BEGIN
--r := to_char(idate, &#39;YYYYMMDD&#39;)::TEXT;
--r := to_char(idate, &#39;YYYYMM&#39;)::TEXT;
r := to_char(idate, &#39;YYYY&#39;)::TEXT;

return r;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_view_contact_groups_they_belong(note bigint) -->
    <section id="public.function.fun-view-contact-groups-they-belong-note-bigint"
             xreflabel="publicfun_view_contact_groups_they_belong(note bigint)">
      <title id="public.function.fun-view-contact-groups-they-belong-note-bigint-title">
       fun_view_contact_groups_they_belong(note bigint)
      </title>
      <titleabbrev id="public.function.fun-view-contact-groups-they-belong-note-bigint-titleabbrev">
       fun_view_contact_groups_they_belong(note bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>SET OF record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
DECLARE myrow groups%ROWTYPE;
BEGIN
   FOR myrow IN SELECT * FROM groups where groups.idgroup &gt; 0
   LOOP
idgroup :=  myrow.idgroup;
ts:= myrow.ts;


--IF EXISTS(SELECT * FROM contacts_groups WHERE idcontact = iidcontact AND contacts_groups.idgroup = myrow.idgroup) THEN
--SELECT * FROM contacts WHERE idcontact = 0 AND 0 = ANY (groups)
IF EXISTS(SELECT * FROM contacts WHERE contacts.idcontact = iidcontact AND myrow.idgroup = ANY(groups)) THEN
ismember:=true;
ELSE
ismember:=false;
END IF;
idcontact := iidcontact;
enabled:= myrow.enabled;
name:= myrow.name;
description:=myrow.description;
note:=myrow.note;
   RETURN NEXT;
   END LOOP;
   RETURN;
END;
</programlisting>
      </para>
    </section>

<!-- Function funjs_db_structure() -->
    <section id="public.function.funjs-db-structure"
             xreflabel="publicfunjs_db_structure()">
      <title id="public.function.funjs-db-structure-title">
       funjs_db_structure()
      </title>
      <titleabbrev id="public.function.funjs-db-structure-titleabbrev">
       funjs_db_structure()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
plan = plv8.prepare(&quot;SELECT * FROM gui.view_structure WHERE table_parent isnull;&quot;);
  var res = plan.execute([]);



var sorted = {};

res.forEach(function(row){


if(!sorted[row.table_schema]){
sorted[row.table_schema] = {};
}

if(!sorted[row.table_schema][row.table_name]){
sorted[row.table_schema][row.table_name] = {columns: [], properties: {title: row.title_grid, row_selector: row.row_selector_dgrid}};

}

if(!sorted[row.table_schema][row.table_name].columns.some(function(col){col.column_name !== row.column_name})){
sorted[row.table_schema][row.table_name].columns.push(
{field: row.column_name, uuid: row.idfield, udt_name: row.udt_name, column_default: row.column_default, pk: row.pk, label: row.label, public: row.public, ongrid_visible: row.ongrid_visible, ongrid_position: row.ongrid_position, ongrid_editable: row.ongrid_editable, ongrid_formatter: row.ongridformatter, ongrid_sortable: row.ongrid_sortable, ongrid_editor: row.ongrid_editor, ongrid_editor: row.ongrid_editor, onform_editor: row.onform_editor, onform_editor_args: row.onform_editor_args, ongrid_editor_args: row.ongrid_editor_args, ongrid_editon: row.ongrid_editon, onform_editor: row.onform_editor}
);
}



});




/*
[2, 5, 8, 1, 4].some(isBiggerThan10);  // false
*/



/*
res.forEach(function(row){
	sorted[row.table_schema] = [];
});

Object.keys(sorted).forEach(function(id) {
	sorted[id] = res.filter(function(row) {
		return row.table_schema === id;
	})
	.map(function(row) {
		var table = {};
table[row.table_name] = {};
		return table;
	});
});
*/

plv8.elog(INFO, JSON.stringify(sorted));

if(res.length &gt; 0){
return sorted;
}  else{
return &#39;&#39;;
}


</programlisting>
      </para>
    </section>

<!-- Function funjs_listen(array_channel json) -->
    <section id="public.function.funjs-listen-array-channel-json"
             xreflabel="publicfunjs_listen(array_channel json)">
      <title id="public.function.funjs-listen-array-channel-json-title">
       funjs_listen(array_channel json)
      </title>
      <titleabbrev id="public.function.funjs-listen-array-channel-json-titleabbrev">
       funjs_listen(array_channel json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var r = [];

array_channel.forEach(function(ch){
plv8.elog(INFO, ch);
var rows = plv8.execute(&#39;LISTEN &#39;+ch+&#39;;&#39;);
plv8.elog(INFO, JSON.stringify(rows));
                      r.push(rows);
                      
                      });
return r;
</programlisting>
      </para>
    </section>

<!-- Function funjs_md5(string_text text) -->
    <section id="public.function.funjs-md5-string-text-text"
             xreflabel="publicfunjs_md5(string_text text)">
      <title id="public.function.funjs-md5-string-text-text-title">
       funjs_md5(string_text text)
      </title>
      <titleabbrev id="public.function.funjs-md5-string-text-text-titleabbrev">
       funjs_md5(string_text text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
plan = plv8.prepare(&quot;SELECT md5($1) as result;&quot;);
  var res = plan.execute([string_text]);

  // plv8.elog(INFO, JSON.stringify(res));
//plv8.elog(INFO, JSON.stringify(res.length));

if(res.length &gt; 0){
return res[0].result;
}  else{
return &#39;&#39;;
}


</programlisting>
      </para>
    </section>

<!-- Function on_cell_change() -->
    <section id="public.function.on-cell-change"
             xreflabel="publicon_cell_change()">
      <title id="public.function.on-cell-change-title">
       on_cell_change()
      </title>
      <titleabbrev id="public.function.on-cell-change-titleabbrev">
       on_cell_change()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>/*
SELECT idfield, tschema_tname, tschema_tname_tcol, table_schema, table_name, 
       column_name, data_type, column_default, pk
  FROM public.view_schema_table_column;

  */

  var r = {id: -1, name: &#39;&#39;, operation: 0, idfield: -1, schema: TG_TABLE_SCHEMA, table: TG_TABLE_NAME};

  var Fields = plv8.execute( &quot;SELECT idfield, column_name, pk, tschema_tname_tcol, table_name, table_parent FROM public.view_schema_table_column WHERE table_schema = $1 AND table_name = $2 AND column_name != &#39;_foot_print_&#39; AND column_name != &#39;_lm_&#39;;&quot;, [ TG_TABLE_SCHEMA, TG_TABLE_NAME ] );

  Fields.forEach(function(field, i, arr){

  	if(field.pk){
  		r.name = field.column_name;
  		r.idfield = field.idfield;
		r.table = field.table_parent || field.table_name;
  	}

  	switch(TG_OP){
  		case &#39;UPDATE&#39;:
  		r.operation = 2;
  		r.id = NEW[r.name];
  		if(NEW[field.column_name] != OLD[field.column_name]){
  			r.data = NEW[field.column_name];
  			var u = plv8.execute( &quot;INSERT INTO public.last_modified_cells(datas) VALUES ($1);&quot;, [ r ] );
  		}


  		break;
  		case &#39;INSERT&#39;:
  		changed = true;
  		r.operation = 1;
  		r.id = NEW[r.name];
  		r.data = NEW;
  		break;
  		break;
  		case &#39;DELETE&#39;:
  		changed = true;
  		r.operation = 3;
  		r.id = OLD[r.name];
  		break;
  		break;
  	}


  });

  if(TG_OP != &#39;UPDATE&#39;){
  	plv8.elog(NOTICE, &quot;result = &quot;, JSON.stringify(r));
  	var Fields = plv8.execute( &quot;INSERT INTO public.last_modified_cells(datas) VALUES ($1);&quot;, [ r ] );
  }

  if (TG_OP == &quot;UPDATE&quot;) {
  	return NEW;
  }</programlisting>
      </para>
    </section>

<!-- Function on_update_row() -->
    <section id="public.function.on-update-row"
             xreflabel="publicon_update_row()">
      <title id="public.function.on-update-row-title">
       on_update_row()
      </title>
      <titleabbrev id="public.function.on-update-row-titleabbrev">
       on_update_row()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>

BEGIN

RAISE NOTICE &#39;1) on_update_row_update_ts&#39;;

	NEW._foot_print_ = (random() * 9999 + 1 )::smallint;
   NEW._lm_ = now(); 
   RETURN NEW;
END;

</programlisting>
      </para>
    </section>

  </chapter>

  <chapter id="scheduled-tasks.schema"
           xreflabel="scheduled_tasks">
    <title>Schema scheduled_tasks</title>
    <para></para>


      <section id="scheduled-tasks.table.scheduled-task-agents"
               xreflabel="scheduled_tasks.scheduled_task_agents">
        <title id="scheduled-tasks.table.scheduled-task-agents-title">
         Table:
         
         <structname>scheduled_task_agents</structname>
        </title>
 

        <para>
          Lista de agentes remotos
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>scheduled_task_agents</structname>
            </title>


            <varlistentry>
              <term><structfield>idscheduled_task_agent</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>agent_key</structfield></term>
              <listitem><para>
                <type>text</type>





                <literal>DEFAULT &apos;stapwd&apos;::text</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>agent_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="scheduled-tasks.table.task-list"
               xreflabel="scheduled_tasks.task_list">
        <title id="scheduled-tasks.table.task-list-title">
         Table:
         
         <structname>task_list</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>task_list</structname>
            </title>


            <varlistentry>
              <term><structfield>idtask</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>function_name</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>task_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>task_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>task_trigger</structfield></term>
              <listitem><para>
                <type>jsonb</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{&quot;interval&quot;: {&quot;minutes&quot;: 30}}&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_run</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>next_run</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>status</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>task_parameters</structfield></term>
              <listitem><para>
                <type>jsonb</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;{}&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>duration</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT &apos;-1&apos;::integer</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>scheduled_task_agent</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>



  </chapter>

  <chapter id="secondary.schema"
           xreflabel="secondary">
    <title>Schema secondary</title>
    <para>Esquema donde se colocaran tablas de apoyo o que no son parte fundamental de Open Monitoring System</para>


      <section id="secondary.table.i-eta-rm-matriz-articulos-201708"
               xreflabel="secondary.i_eta_rm_matriz_articulos_201708">
        <title id="secondary.table.i-eta-rm-matriz-articulos-201708-title">
         Table:
         
         <structname>i_eta_rm_matriz_articulos_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_articulos_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_articulos_201708</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;articulos&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_articulos_201708</title>

          <varlistentry>
            <term>i_eta_rm_matriz_articulos_201708_compania</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_articulos_201708_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_articulos_201_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_61dfdf55597cd63f7cc0974af03927da</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_6c8efe3162c5841d2f32362c4fdb76fa</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-articulos-201709"
               xreflabel="secondary.i_eta_rm_matriz_articulos_201709">
        <title id="secondary.table.i-eta-rm-matriz-articulos-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_articulos_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_articulos_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_articulos_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;articulos&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_articulos_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_articulos_201709_compania</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_articulos_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_articulos_201_nameinterface_idaccount_data_idx1</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_741f35f0682b53825d7a3ff0e157c1e1</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_a7b440ad2766d5ce3a6c3401a4e9e6cf</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-articulosauxiliar-201708"
               xreflabel="secondary.i_eta_rm_matriz_articulosauxiliar_201708">
        <title id="secondary.table.i-eta-rm-matriz-articulosauxiliar-201708-title">
         Table:
         
         <structname>i_eta_rm_matriz_articulosauxiliar_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_articulosauxiliar_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_articulosauxiliar_201708</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;articulosauxiliar&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_articulosauxiliar_201708</title>

          <varlistentry>
            <term>i_eta_rm_matriz_articulosauxi_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_articulosauxiliar_201708_compania</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_articulosauxiliar_20_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_2d1e6deef50b93cf3d867c9292c8d4b8</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_c6b2ff33feffb4dbb964d618d6a2159c</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-articulosauxiliar-201709"
               xreflabel="secondary.i_eta_rm_matriz_articulosauxiliar_201709">
        <title id="secondary.table.i-eta-rm-matriz-articulosauxiliar-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_articulosauxiliar_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_articulosauxiliar_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_articulosauxiliar_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;articulosauxiliar&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_articulosauxiliar_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_articulosauxi_nameinterface_idaccount_data_idx1</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_articulosauxiliar_201709_compania</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_articulosauxiliar_2_nameinterface_enmatriz_idx1</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_3816773015998b06d313957ddde55ee6</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_8f3053896a7077717025243608d265f3</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-clientes-190001"
               xreflabel="secondary.i_eta_rm_matriz_clientes_190001">
        <title id="secondary.table.i-eta-rm-matriz-clientes-190001-title">
         Table:
         
         <structname>i_eta_rm_matriz_clientes_190001</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_clientes_190001</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_clientes_190001</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;clientes&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_clientes_190001</title>

          <varlistentry>
            <term>i_eta_rm_matriz_clientes_190001_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_clientes_190001_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_clientes_1900_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_7925aea4ecf093b004081496bf7935b0</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_9a9f85ac1ca2bdc0ac605ea5f02fc0fd</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-clientes-201709"
               xreflabel="secondary.i_eta_rm_matriz_clientes_201709">
        <title id="secondary.table.i-eta-rm-matriz-clientes-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_clientes_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_clientes_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_clientes_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;clientes&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_clientes_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_clientes_201709_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_clientes_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_clientes_2017_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_8b5139eaace39c6a32e54472fade0d5e</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_e3280d442ecf8c66a835b567bc276dc1</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-direcciones-190001"
               xreflabel="secondary.i_eta_rm_matriz_direcciones_190001">
        <title id="secondary.table.i-eta-rm-matriz-direcciones-190001-title">
         Table:
         
         <structname>i_eta_rm_matriz_direcciones_190001</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_direcciones_190001</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_direcciones_190001</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;direcciones&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_direcciones_190001</title>

          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_190001_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_190001_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_1_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_82e9acc8909bb3fa6cac65a030a33654</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_ce80aa2ff52fb6a6ca703260074c3e07</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-direcciones-198912"
               xreflabel="secondary.i_eta_rm_matriz_direcciones_198912">
        <title id="secondary.table.i-eta-rm-matriz-direcciones-198912-title">
         Table:
         
         <structname>i_eta_rm_matriz_direcciones_198912</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_direcciones_198912</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_direcciones_198912</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;direcciones&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_direcciones_198912</title>

          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_198912_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_198912_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_1_nameinterface_idaccount_data_idx1</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_7bafa5982d372b96c536b398c65abcc8</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_ca0b3efb110b8220e43f8c055508c7da</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-direcciones-201709"
               xreflabel="secondary.i_eta_rm_matriz_direcciones_201709">
        <title id="secondary.table.i-eta-rm-matriz-direcciones-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_direcciones_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_direcciones_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_direcciones_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;direcciones&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_direcciones_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_201709_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_direcciones_2_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_9c49973cf676087ecb3393e4877b3df5</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_cbabb347db92a9b84cad06a843e01c52</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-docvxmp-201708"
               xreflabel="secondary.i_eta_rm_matriz_docvxmp_201708">
        <title id="secondary.table.i-eta-rm-matriz-docvxmp-201708-title">
         Table:
         
         <structname>i_eta_rm_matriz_docvxmp_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_docvxmp_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_docvxmp_201708</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;docvxmp&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_docvxmp_201708</title>

          <varlistentry>
            <term>i_eta_rm_matriz_docvxmp_201708_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_docvxmp_20170_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_60ff85c569483d8312d9e2dde511ac6a</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_a832adba0ccd4b11fccdfd19524c4056</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-docvxmp-201709"
               xreflabel="secondary.i_eta_rm_matriz_docvxmp_201709">
        <title id="secondary.table.i-eta-rm-matriz-docvxmp-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_docvxmp_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_docvxmp_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_docvxmp_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;docvxmp&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_docvxmp_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_docvxmp_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_docvxmp_20170_nameinterface_idaccount_data_idx1</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_3b395bb21f99f0d24a836f060275d054</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_caa9821e6298e3b0d5861aee08a8b188</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-empleados-201709"
               xreflabel="secondary.i_eta_rm_matriz_empleados_201709">
        <title id="secondary.table.i-eta-rm-matriz-empleados-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_empleados_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_empleados_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_empleados_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;empleados&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_empleados_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_empleados_201709_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_empleados_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_empleados_201_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_517c3b1f1fbe297af401cc68187548e0</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_d64e070ca83ea94c9bb34ca70fbec214</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-fechapago-190001"
               xreflabel="secondary.i_eta_rm_matriz_fechapago_190001">
        <title id="secondary.table.i-eta-rm-matriz-fechapago-190001-title">
         Table:
         
         <structname>i_eta_rm_matriz_fechapago_190001</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_fechapago_190001</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_fechapago_190001</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;fechapago&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_fechapago_190001</title>

          <varlistentry>
            <term>i_eta_rm_matriz_fechapago_190001_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_fechapago_190001_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_fechapago_190_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_7b155d385cc7ab4d9b91d06a45b986ca</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_a915c19941986f9528527d5875abde41</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-fechapago-201709"
               xreflabel="secondary.i_eta_rm_matriz_fechapago_201709">
        <title id="secondary.table.i-eta-rm-matriz-fechapago-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_fechapago_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_fechapago_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_fechapago_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;fechapago&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_fechapago_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_fechapago_201709_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_fechapago_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_fechapago_201_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_0824fb17c1ae9077b392a8f1d7b7e89e</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_8afaf3f0415406e3bccbe2f531274db1</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-fmapago-190001"
               xreflabel="secondary.i_eta_rm_matriz_fmapago_190001">
        <title id="secondary.table.i-eta-rm-matriz-fmapago-190001-title">
         Table:
         
         <structname>i_eta_rm_matriz_fmapago_190001</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_fmapago_190001</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_fmapago_190001</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;fmapago&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_fmapago_190001</title>

          <varlistentry>
            <term>i_eta_rm_matriz_fmapago_190001_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_fmapago_190001_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_fmapago_19000_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_31fe6fb5c373565e071c1f4a8133c0c9</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_bec571fdcbbc1bb4bc0f6ea740c97d42</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-fmapago-201709"
               xreflabel="secondary.i_eta_rm_matriz_fmapago_201709">
        <title id="secondary.table.i-eta-rm-matriz-fmapago-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_fmapago_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_fmapago_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_fmapago_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;fmapago&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_fmapago_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_fmapago_201709_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_fmapago_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_fmapago_20170_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_c3dca31f806005192ce95b070bd8e786</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_faffbb761f753d3f320232a51bad755d</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-movinv-201708"
               xreflabel="secondary.i_eta_rm_matriz_movinv_201708">
        <title id="secondary.table.i-eta-rm-matriz-movinv-201708-title">
         Table:
         
         <structname>i_eta_rm_matriz_movinv_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_movinv_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_movinv_201708</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;movinv&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_movinv_201708</title>

          <varlistentry>
            <term>i_eta_rm_matriz_movinv_201708_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_movinv_201708_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_1ab1c5699a527eff51479b7e5777e3e8</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_1f92925bd5ef117b81aeecc463e32e61</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-movinv-201709"
               xreflabel="secondary.i_eta_rm_matriz_movinv_201709">
        <title id="secondary.table.i-eta-rm-matriz-movinv-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_movinv_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_movinv_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_movinv_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;movinv&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_movinv_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_movinv_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_movinv_201709_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_4f068d401f842973f53ac79e3aa05d61</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_df9f02bd2f1d8a2254f577663ef2df4f</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-proveedores-201709"
               xreflabel="secondary.i_eta_rm_matriz_proveedores_201709">
        <title id="secondary.table.i-eta-rm-matriz-proveedores-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_proveedores_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_proveedores_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_proveedores_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;proveedores&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_proveedores_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_proveedores_201709_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_proveedores_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_proveedores_2_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_4f0ef5a1c64b20fc845cfd17b21d75fb</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_a674cf8e75424621e08809b70d3425cf</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-saldocli-190001"
               xreflabel="secondary.i_eta_rm_matriz_saldocli_190001">
        <title id="secondary.table.i-eta-rm-matriz-saldocli-190001-title">
         Table:
         
         <structname>i_eta_rm_matriz_saldocli_190001</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_saldocli_190001</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_saldocli_190001</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;saldocli&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_saldocli_190001</title>

          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_190001_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_190001_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_1900_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_6fd6376034faf319d3de4a76be06cb41</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_cc313c0e5129ad7d2fa675faa7cdacb8</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-saldocli-198912"
               xreflabel="secondary.i_eta_rm_matriz_saldocli_198912">
        <title id="secondary.table.i-eta-rm-matriz-saldocli-198912-title">
         Table:
         
         <structname>i_eta_rm_matriz_saldocli_198912</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_saldocli_198912</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_saldocli_198912</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;saldocli&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_saldocli_198912</title>

          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_198912_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_198912_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_1989_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_8ea0aab629b7cec28b1abd27b0a3a876</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_e605ab1761c2371b12afadf6db9630aa</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-saldocli-201709"
               xreflabel="secondary.i_eta_rm_matriz_saldocli_201709">
        <title id="secondary.table.i-eta-rm-matriz-saldocli-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_saldocli_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_saldocli_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_saldocli_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;saldocli&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_saldocli_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_201709_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_saldocli_2017_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_3396ff21629f63531a64849e660848db</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_699b0bfa162fea482abe42557f09437e</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-tipotxs-190001"
               xreflabel="secondary.i_eta_rm_matriz_tipotxs_190001">
        <title id="secondary.table.i-eta-rm-matriz-tipotxs-190001-title">
         Table:
         
         <structname>i_eta_rm_matriz_tipotxs_190001</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_tipotxs_190001</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_tipotxs_190001</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;tipotxs&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_tipotxs_190001</title>

          <varlistentry>
            <term>i_eta_rm_matriz_tipotxs_190001_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_tipotxs_190001_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_tipotxs_19000_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_5cb5320f11e30c82f19f7354ff08e29a</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_954592b8743e3c57791b1afb14806fec</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.i-eta-rm-matriz-tipotxs-201709"
               xreflabel="secondary.i_eta_rm_matriz_tipotxs_201709">
        <title id="secondary.table.i-eta-rm-matriz-tipotxs-201709-title">
         Table:
         
         <structname>i_eta_rm_matriz_tipotxs_201709</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>i_eta_rm_matriz_tipotxs_201709</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on i_eta_rm_matriz_tipotxs_201709</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;tipotxs&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on i_eta_rm_matriz_tipotxs_201709</title>

          <varlistentry>
            <term>i_eta_rm_matriz_tipotxs_201709_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_tipotxs_201709_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>i_eta_rm_matriz_tipotxs_20170_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_3c39c13ef99a7f712c09757374897148</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_5618b8db1e7d1f653784210946d50c6c</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.interfaces-eta-rm-matriz"
               xreflabel="secondary.interfaces_eta_rm_matriz">
        <title id="secondary.table.interfaces-eta-rm-matriz-title">
         Table:
         
         <structname>interfaces_eta_rm_matriz</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>interfaces_eta_rm_matriz</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigserial</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE</literal>





                      <literal>UNIQUE#1</literal>












              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on interfaces_eta_rm_matriz</title>

          <varlistentry>
            <term>interfaces_eta_rm_matriz_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_expr_idx</term>
            <listitem><para>((datas -&gt;&gt; &apos;Compania&apos;::text))</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_nameinterface_idaccount_datas_idx</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.interfaces-eta-rm-matriz-201707"
               xreflabel="secondary.interfaces_eta_rm_matriz_201707">
        <title id="secondary.table.interfaces-eta-rm-matriz-201707-title">
         Table:
         
         <structname>interfaces_eta_rm_matriz_201707</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>interfaces_eta_rm_matriz_201707</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on interfaces_eta_rm_matriz_201707</title>

          <varlistentry>
            <term>index_interfaces_eta_rm_matriz_201707_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_201707_nameinterface_idaccount_datas_i</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.interfaces-eta-rm-matriz-201708"
               xreflabel="secondary.interfaces_eta_rm_matriz_201708">
        <title id="secondary.table.interfaces-eta-rm-matriz-201708-title">
         Table:
         
         <structname>interfaces_eta_rm_matriz_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>interfaces_eta_rm_matriz_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on interfaces_eta_rm_matriz_201708</title>

          <varlistentry>
            <term>index_interfaces_eta_rm_matriz_201708_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_201708_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_201708_nameinterface_idaccount_datas_i</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.interfaces-eta-rm-matriz-articulos-201708"
               xreflabel="secondary.interfaces_eta_rm_matriz_articulos_201708">
        <title id="secondary.table.interfaces-eta-rm-matriz-articulos-201708-title">
         Table:
         
         <structname>interfaces_eta_rm_matriz_articulos_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>interfaces_eta_rm_matriz_articulos_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on interfaces_eta_rm_matriz_articulos_201708</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;articulos&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on interfaces_eta_rm_matriz_articulos_201708</title>

          <varlistentry>
            <term>index_d02d49591029948d5d90e1b0d5ef2e56</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_f7ff275ceb5ed234608349fae25fc200</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_interfaces_eta_rm_matriz_articulos_201708_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_articulos_201708_nameinterface_idaccou</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_articulos_2_nameinterface_enmatriz_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.interfaces-eta-rm-matriz-articulosauxiliar-201708"
               xreflabel="secondary.interfaces_eta_rm_matriz_articulosauxiliar_201708">
        <title id="secondary.table.interfaces-eta-rm-matriz-articulosauxiliar-201708-title">
         Table:
         
         <structname>interfaces_eta_rm_matriz_articulosauxiliar_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>interfaces_eta_rm_matriz_articulosauxiliar_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on interfaces_eta_rm_matriz_articulosauxiliar_201708</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;articulosauxiliar&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on interfaces_eta_rm_matriz_articulosauxiliar_201708</title>

          <varlistentry>
            <term>index_27a30a1a7957f0271d7f00a793c5b6cf</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_c4c5d008ed264c37416886cf50aab110</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.interfaces-eta-rm-matriz-docvxmp-201707"
               xreflabel="secondary.interfaces_eta_rm_matriz_docvxmp_201707">
        <title id="secondary.table.interfaces-eta-rm-matriz-docvxmp-201707-title">
         Table:
         
         <structname>interfaces_eta_rm_matriz_docvxmp_201707</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>interfaces_eta_rm_matriz_docvxmp_201707</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on interfaces_eta_rm_matriz_docvxmp_201707</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;docvxmp&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on interfaces_eta_rm_matriz_docvxmp_201707</title>

          <varlistentry>
            <term>index_interfaces_eta_rm_matriz_docvxmp_201707_idx</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_docvxmp_201707_nameinterface_idaccount</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>interfaces_eta_rm_matriz_docvxmp_20_nameinterface_enmatriz_idx1</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.interfaces-eta-rm-matriz-docvxmp-201708"
               xreflabel="secondary.interfaces_eta_rm_matriz_docvxmp_201708">
        <title id="secondary.table.interfaces-eta-rm-matriz-docvxmp-201708-title">
         Table:
         
         <structname>interfaces_eta_rm_matriz_docvxmp_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>interfaces_eta_rm_matriz_docvxmp_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on interfaces_eta_rm_matriz_docvxmp_201708</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;docvxmp&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on interfaces_eta_rm_matriz_docvxmp_201708</title>

          <varlistentry>
            <term>index_1de8496c88084be4bfa4246050a9c74d</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_a18e9a2d1e1cedb880c9c089a98fbbeb</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.interfaces-eta-rm-matriz-movinv-201708"
               xreflabel="secondary.interfaces_eta_rm_matriz_movinv_201708">
        <title id="secondary.table.interfaces-eta-rm-matriz-movinv-201708-title">
         Table:
         
         <structname>interfaces_eta_rm_matriz_movinv_201708</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>interfaces_eta_rm_matriz_movinv_201708</structname>
            </title>


            <varlistentry>
              <term><structfield>idreginterfacesmatriz</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;eta_materiales_idregmat_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimeload</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>namefile</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;file&apos;::text</literal>





              </para>

              <para>
                Nombre del archivo
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetimefile</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>fileline</structfield></term>
              <listitem><para>
                <type>integer</type>




                      <literal>UNIQUE#1</literal>






                <literal>DEFAULT &apos;-1&apos;::integer</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>nameinterface</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;none&apos;::text</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datas</structfield></term>
              <listitem><para>
                <type>jsonb</type>




                      <literal>UNIQUE#1</literal>










              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enmatriz_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>entienda_revisado</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;interfaces_eta_rm_matriz_idaccount_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>isvalid</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>observations</structfield></term>
              <listitem><para>
                <type>jsonb</type>





                <literal>DEFAULT &apos;&quot;&quot;&apos;::jsonb</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ignore</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddata</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>file_fingerprint</structfield></term>
              <listitem><para>
                <type>uuid</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>



        <variablelist>
          <title>Constraints on interfaces_eta_rm_matriz_movinv_201708</title>

          <varlistentry>
            <term>check_nameinterface</term>
            <listitem><para>CHECK ((nameinterface = &apos;movinv&apos;::text))</para></listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on interfaces_eta_rm_matriz_movinv_201708</title>

          <varlistentry>
            <term>index_1e8d798c831052dae0e71929bc9b9117</term>
            <listitem><para>nameinterface, enmatriz) WHERE (((enmatriz = false) OR (isvalid = false)) AND (ignore = false)</para></listitem>
          </varlistentry>



          <varlistentry>
            <term>index_a89d1daed6c131332bc8f7c0cb5b062b</term>
            <listitem><para>nameinterface, idaccount, datas</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.table.lista-precios-oficinas"
               xreflabel="secondary.lista_precios_oficinas">
        <title id="secondary.table.lista-precios-oficinas-title">
         Table:
         
         <structname>lista_precios_oficinas</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>lista_precios_oficinas</structname>
            </title>


            <varlistentry>
              <term><structfield>idlista_precios</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>principal</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>activa</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>productos</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT &apos;-1&apos;::integer</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>status</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts_lista_farmacia</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>srv159_activa</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>srv159_productos</structfield></term>
              <listitem><para>
                <type>integer</type>





                <literal>DEFAULT &apos;-1&apos;::integer</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>srv159_principal</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts_lista_srv159</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sincronizado</structfield></term>
              <listitem><para>
                <type>text</type>





                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>provincia</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ip</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>





        <variablelist>
          <title>Indexes on lista_precios_oficinas</title>

          <varlistentry>
            <term>index_farma_lista_precios_idaccount</term>
            <listitem><para>idaccount</para></listitem>
          </varlistentry>

        </variablelist>








      </para>
    </section>

      <section id="secondary.view.view-lista-precios-oficinas"
               xreflabel="secondary.view_lista_precios_oficinas">
        <title id="secondary.view.view-lista-precios-oficinas-title">
         View:
         
         <structname>view_lista_precios_oficinas</structname>
        </title>
 

        <para>
          

        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>view_lista_precios_oficinas</structname>
            </title>


            <varlistentry>
              <term><structfield>idaccount</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddivision</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>account</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts_farmacia</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts_server159</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>account_name</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>address</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>tecnico</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>note</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>srv159_principal</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>srv159_activa</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>srv159_productos</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>principal</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>activa</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>productos</structfield></term>
              <listitem><para>
                <type>integer</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>estado</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>sincronizado</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>provincia</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ip</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>








        <figure>
         <title>Definition of view view_lista_precios_oficinas</title>
         <programlisting>
SELECT fun_view_farma_lista_precios.idaccount
,
    fun_view_farma_lista_precios.iddivision
,
    fun_view_farma_lista_precios.account
,
    fun_view_farma_lista_precios.ts_farmacia
,
    fun_view_farma_lista_precios.ts_server159
,
    fun_view_farma_lista_precios.account_name
,
    fun_view_farma_lista_precios.address
,
    fun_view_farma_lista_precios.tecnico
,
    fun_view_farma_lista_precios.note
,
    fun_view_farma_lista_precios.srv159_principal
,
    fun_view_farma_lista_precios.srv159_activa
,
    fun_view_farma_lista_precios.srv159_productos
,
    fun_view_farma_lista_precios.principal
,
    fun_view_farma_lista_precios.activa
,
    fun_view_farma_lista_precios.productos
,
    fun_view_farma_lista_precios.estado
,
    fun_view_farma_lista_precios.sincronizado
,
    fun_view_farma_lista_precios.provincia
,
    fun_view_farma_lista_precios.ip
   
FROM secondary.fun_view_lista_precios_oficinas
() fun_view_farma_lista_precios
(idaccount
     , iddivision
     , account
     , ts_farmacia
     , ts_server159
     , account_name
     , address
     , tecnico
     , note
     , srv159_principal
     , srv159_activa
     , srv159_productos
     , principal
     , activa
     , productos
     , estado
     , sincronizado
     , provincia
     , ip
);</programlisting>
        </figure>



      </para>
    </section>



<!-- Function _fun_insertupdate_interface(iobservations text, ienmatriz timestamp with time zone, idatas integer, inameinterface text, ifileline jsonb, idatetimefile boolean, inamefile jsonb) -->
    <section id="secondary.function.-fun-insertupdate-interface-iobservations-text-ienmatriz-timestamp-with-time-zone-idatas-integer-inameinterface-text-ifileline-jsonb-idatetimefile-boolean-inamefile-jsonb"
             xreflabel="secondary_fun_insertupdate_interface(iobservations text, ienmatriz timestamp with time zone, idatas integer, inameinterface text, ifileline jsonb, idatetimefile boolean, inamefile jsonb)">
      <title id="secondary.function.-fun-insertupdate-interface-iobservations-text-ienmatriz-timestamp-with-time-zone-idatas-integer-inameinterface-text-ifileline-jsonb-idatetimefile-boolean-inamefile-jsonb-title">
       _fun_insertupdate_interface(iobservations text, ienmatriz timestamp with time zone, idatas integer, inameinterface text, ifileline jsonb, idatetimefile boolean, inamefile jsonb)
      </title>
      <titleabbrev id="secondary.function.-fun-insertupdate-interface-iobservations-text-ienmatriz-timestamp-with-time-zone-idatas-integer-inameinterface-text-ifileline-jsonb-idatetimefile-boolean-inamefile-jsonb-titleabbrev">
       _fun_insertupdate_interface(iobservations text, ienmatriz timestamp with time zone, idatas integer, inameinterface text, ifileline jsonb, idatetimefile boolean, inamefile jsonb)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>bigint</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R BIGINT DEFAULT -100;
id BIGINT DEFAULT 0;

BEGIN

SELECT idreginterfacesmatriz INTO id FROM secondary.interfaces_eta_rm_matriz WHERE namefile = inamefile AND datetimefile = idatetimefile AND fileline = ifileline AND nameinterface = inameinterface AND datas = idatas AND observations = iobservations;

IF id IS NOT NULL AND id &gt; 0 THEN

UPDATE secondary.interfaces_eta_rm_matriz SET enmatriz = ienmatriz WHERE idreginterfacesmatriz = id;
R := id;

ELSE

INSERT INTO secondary.interfaces_eta_rm_matriz(
             namefile, datetimefile, fileline, nameinterface,  datas, enmatriz, observations)
    VALUES ( inamefile, idatetimefile, ifileline, inameinterface, idatas, ienmatriz, iobservations);

    R := 99999999;

END IF;


RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function eta_rm_interfaces_before_insert() -->
    <section id="secondary.function.eta-rm-interfaces-before-insert"
             xreflabel="secondaryeta_rm_interfaces_before_insert()">
      <title id="secondary.function.eta-rm-interfaces-before-insert-title">
       eta_rm_interfaces_before_insert()
      </title>
      <titleabbrev id="secondary.function.eta-rm-interfaces-before-insert-titleabbrev">
       eta_rm_interfaces_before_insert()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
_idaccount BIGINT DEFAULT -1;
_iddivision BIGINT DEFAULT -1;
_tienda TEXT DEFAULT &#39;&#39;;
table_part TEXT DEFAULT &#39;1990&#39;; 
id BIGINT DEFAULT 0;

BEGIN

table_part := secondary.fun_create_table_partition_interfaces_eta_rm_matriz(NEW.nameinterface, NEW.datetimefile:: timestamp WITH TIME zone);

CASE
----------------------------------------
WHEN  NEW.nameinterface = &#39;movinv&#39; THEN
_tienda := NEW.datas -&gt;&gt; &#39;Werks&#39;;

IF NEW.datas -&gt;&gt; &#39;Bukrs&#39; = &#39;E001&#39; THEN
_iddivision := 6;
END IF;

IF NEW.datas -&gt;&gt; &#39;Bukrs&#39; = &#39;E002&#39; THEN
_iddivision := 7;
END IF;

IF NEW.datas -&gt;&gt; &#39;Bukrs&#39; = &#39;E004&#39; THEN
_iddivision := 8;
END IF;
------------------------------------------
WHEN  NEW.nameinterface = &#39;articulos&#39; THEN
IF NEW.datas -&gt;&gt; &#39;Compania&#39; = &#39;E001&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;Compania&#39; = &#39;E002&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;Compania&#39; = &#39;E004&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;

--------------------------------------------------
WHEN  NEW.nameinterface = &#39;articulosauxiliar&#39; THEN
IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E001&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E002&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E004&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;

--------------------------------------------------
WHEN  NEW.nameinterface = &#39;clientes&#39; THEN
IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E001&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E002&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E004&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;


--------------------------------------------------
WHEN  NEW.nameinterface = &#39;empleados&#39; THEN
IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E001&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E002&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;compania&#39; = &#39;E004&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;


--------------------------------------------------
WHEN  NEW.nameinterface = &#39;fmapago&#39; THEN
IF NEW.observations = &#39;&quot;ETA&quot;&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.observations = &#39;&quot;RM&quot;&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.observations = &#39;&quot;CR&quot;&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;

--------------------------------------------------
WHEN  NEW.nameinterface = &#39;proveedores&#39; THEN
IF NEW.datas -&gt;&gt; &#39;Compania&#39; = &#39;E001&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;Compania&#39; = &#39;E002&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.datas -&gt;&gt; &#39;Compania&#39; = &#39;E004&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;

--------------------------------------------------
WHEN  NEW.nameinterface = &#39;tipotxs&#39; THEN
IF NEW.observations = &#39;&quot;ETA&quot;&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.observations = &#39;&quot;RM&quot;&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.observations = &#39;&quot;CR&quot;&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;

--------------------------------------------------
WHEN  NEW.nameinterface = &#39;fechapago&#39; THEN
IF NEW.observations = &#39;&quot;ETA&quot;&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.observations = &#39;&quot;RM&quot;&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.observations = &#39;&quot;CR&quot;&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;

--------------------------------------------------
WHEN  NEW.nameinterface = &#39;direcciones&#39; THEN
IF NEW.observations = &#39;&quot;ETA&quot;&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.observations = &#39;&quot;RM&quot;&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.observations = &#39;&quot;CR&quot;&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;

--------------------------------------------------
WHEN  NEW.nameinterface = &#39;saldocli&#39; THEN
IF NEW.observations = &#39;&quot;ETA&quot;&#39; THEN
_iddivision := 6;
_tienda = &#39;CD01&#39;;
END IF;

IF NEW.observations = &#39;&quot;RM&quot;&#39; THEN
_iddivision := 7;
_tienda = &#39;CD02&#39;;
END IF;

IF NEW.observations = &#39;&quot;CR&quot;&#39; THEN
_iddivision := 8;
_tienda = &#39;ETACR&#39;;
END IF;




ELSE
_iddivision := -1;
_tienda = &#39;&#39;;
--
END CASE;

--IF NEW.idaccount IS NULL OR NEW.idaccount &lt; 1 THEN

SELECT idaccount INTO _idaccount FROM accounts WHERE  iddivision = _iddivision AND identification = _tienda;

NEW.idaccount  := COALESCE(_idaccount, 0);

--END IF;







--IF NEW.xblnr IS NULL OR length(NEW.xblnr) &lt;= 0 THEN
--NEW.xblnr := &#39;&#39;;
--END IF;

--NEW.firma := md5(NEW.budat||NEW.bukrs||NEW.bwart||NEW.cpudt||NEW.cputm||NEW.matnr||NEW.mblnr||NEW.menge||NEW.usnam||NEW.werks||NEW.xblnr);

--RETURN NEW; 

/*
SELECT idreginterfacesmatriz INTO id FROM secondary.interfaces_eta_rm_matriz WHERE namefile = NEW.namefile AND fileline = NEW.fileline AND nameinterface = NEW.nameinterface AND datas = NEW.datas;

IF id IS NULL OR id &lt; 1 THEN
    EXECUTE &#39;INSERT INTO secondary.&#39; 
    || quote_ident(table_part) 
    || &#39; SELECT ($1).*&#39; USING NEW; 
ELSE
-- Actualiza solo el campo que le corresponde
    EXECUTE &#39;UPDATE secondary.interfaces_eta_rm_matriz SET enmatriz = &#39;||NEW.enmatriz
    ||&#39; AND enmatriz_revisado = now() AND idreginterfacesmatriz = &#39; 
    || id||&#39; AND ignore = FALSE;&#39;; 

END IF;
*/

NEW.iddata := md5(NEW.idaccount::TEXT|| NEW.nameinterface||NEW.fileline::TEXT||NEW.datas::TEXT||NEW.observations::TEXT||NEW.file_fingerprint::TEXT);

    EXECUTE &#39;INSERT INTO secondary.&#39; 
    || quote_ident(table_part) 
    || &#39; SELECT ($1).*&#39; USING NEW; 

  RETURN NULL; 
END;</programlisting>
      </para>
    </section>

<!-- Function fun_create_table_partition_interfaces_eta_rm_matriz(idatetime text, interface timestamp with time zone) -->
    <section id="secondary.function.fun-create-table-partition-interfaces-eta-rm-matriz-idatetime-text-interface-timestamp-with-time-zone"
             xreflabel="secondaryfun_create_table_partition_interfaces_eta_rm_matriz(idatetime text, interface timestamp with time zone)">
      <title id="secondary.function.fun-create-table-partition-interfaces-eta-rm-matriz-idatetime-text-interface-timestamp-with-time-zone-title">
       fun_create_table_partition_interfaces_eta_rm_matriz(idatetime text, interface timestamp with time zone)
      </title>
      <titleabbrev id="secondary.function.fun-create-table-partition-interfaces-eta-rm-matriz-idatetime-text-interface-timestamp-with-time-zone-titleabbrev">
       fun_create_table_partition_interfaces_eta_rm_matriz(idatetime text, interface timestamp with time zone)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

part TEXT DEFAULT &#39;19000101&#39;;
nameindex TEXT DEFAULT &#39;&#39;;

BEGIN

IF idatetime &lt; &#39;1900-01-01&#39;::TIMESTAMP WITH TIME ZONE THEN
idatetime := &#39;1900-01-01&#39;::TIMESTAMP WITH TIME ZONE;
END IF;

part := &#39;i_eta_rm_matriz_&#39;||interface||&#39;_&#39;||to_char(idatetime, &#39;YYYYMM&#39;)::TEXT;


IF NOT EXISTS(SELECT table_name FROM information_schema.tables WHERE  table_schema = &#39;secondary&#39; AND table_name = part LIMIT 1) THEN

EXECUTE &#39;CREATE TABLE IF NOT EXISTS secondary.&#39;||part::TEXT||&#39;(
   LIKE secondary.interfaces_eta_rm_matriz INCLUDING DEFAULTS INCLUDING CONSTRAINTS INCLUDING INDEXES INCLUDING STORAGE INCLUDING COMMENTS
) 
INHERITS (secondary.interfaces_eta_rm_matriz)
WITH (
  OIDS = FALSE,
   FILLFACTOR=75, 
  toast.autovacuum_enabled=true
);&#39;;


-- Trigger: on_changed_table on events

-- DROP TRIGGER on_changed_table ON events;

EXECUTE &#39;CREATE TRIGGER on_changed_table
  AFTER INSERT OR UPDATE OR DELETE
  ON secondary.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_changed_table();&#39;;

-- Trigger: on_insert_event on events

-- DROP TRIGGER on_insert_event ON events;
/*
EXECUTE &#39;CREATE TRIGGER on_insert_event
  AFTER INSERT
  ON &#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE events_on_insert();&#39;;
  */

-- Trigger: on_update_row on events

-- DROP TRIGGER on_update_row ON events;

EXECUTE &#39;CREATE TRIGGER on_update_row
  BEFORE UPDATE
  ON secondary.&#39;||part::TEXT||&#39;
  FOR EACH ROW
  EXECUTE PROCEDURE on_update_row_update_ts();&#39;;

END IF;


  ---------------------- 
  nameindex := fun_gen_md5_by_schema_table_obj(&#39;index&#39;, &#39;secondary&#39;, part, &#39;nameinterface, enmatriz =&gt; WHERE (enmatriz = false OR isvalid = false) AND ignore = false&#39;);
  
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   pg_indexes 
           WHERE  tablename = part 
           AND schemaname = &#39;secondary&#39;
           AND    indexname = nameindex) THEN 
    EXECUTE &#39; CREATE INDEX &#39; 
    ||nameindex 
    ||&#39; ON secondary.&#39; 
    ||part 
    ||&#39; USING btree (nameinterface, enmatriz)
  WHERE (enmatriz = false OR isvalid = false) AND ignore = false;&#39;; 
  END IF; 

/*
CREATE INDEX interfaces_eta_rm_matriz_2017_nameinterface_idaccount_datas_idx
  ON secondary.interfaces_eta_rm_matriz_201706
  USING btree
  (nameinterface COLLATE pg_catalog.&quot;default&quot;, idaccount, datas);
*/
  ---------------------- 


nameindex := fun_gen_md5_by_schema_table_obj(&#39;index&#39;, &#39;secondary&#39;, part, &#39;nameinterface, idaccount, datas&#39;);
    
  IF NOT EXISTS 
    ( 
           SELECT * 
           FROM   pg_indexes 
           WHERE  tablename = part 
           AND schemaname = &#39;secondary&#39;
           AND    indexname = nameindex) THEN 
    EXECUTE &#39; CREATE INDEX &#39; 
    ||nameindex 
    ||&#39; ON secondary.&#39; 
    ||part 
    ||&#39; USING btree (nameinterface COLLATE pg_catalog.&quot;default&quot;, idaccount, datas)&#39;; 
  END IF; 





PERFORM create_constraint_if_not_exists(
        &#39;secondary&#39;,
        part,
        &#39;check_nameinterface&#39;,
        &#39;CHECK (nameinterface = &#39;&#39;&#39;||interface||&#39;&#39;&#39;)&#39;);


RETURN part;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_gen_resume_mov_inv(idevent_on_restore bigint, idevent_on_alarm bigint) -->
    <section id="secondary.function.fun-gen-resume-mov-inv-idevent-on-restore-bigint-idevent-on-alarm-bigint"
             xreflabel="secondaryfun_gen_resume_mov_inv(idevent_on_restore bigint, idevent_on_alarm bigint)">
      <title id="secondary.function.fun-gen-resume-mov-inv-idevent-on-restore-bigint-idevent-on-alarm-bigint-title">
       fun_gen_resume_mov_inv(idevent_on_restore bigint, idevent_on_alarm bigint)
      </title>
      <titleabbrev id="secondary.function.fun-gen-resume-mov-inv-idevent-on-restore-bigint-idevent-on-alarm-bigint-titleabbrev">
       fun_gen_resume_mov_inv(idevent_on_restore bigint, idevent_on_alarm bigint)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
message TEXT;
cantidad INTEGER;
eventtype BIGINT;
details TEXT;
minutes_last INTEGER;
priority INTEGER;
R BOOLEAN DEFAULT FALSE;
procesos INTEGER DEFAULT 0;

cursor1 CURSOR FOR SELECT &#39;ETA&#39; as empresa, (SELECT count(*) FROM secondary.view_mov_inv_sin_cargar_eta WHERE enmatriz = false) as cantidad, (SELECT datetimefile FROM secondary.view_mov_inv_sin_cargar_eta WHERE enmatriz = false ORDER BY datetimefile  LIMIT 1) as fecha_mov_ini, (SELECT datetimefile FROM secondary.view_mov_inv_sin_cargar_eta WHERE enmatriz = false ORDER BY datetimefile DESC LIMIT 1) as fecha_mov_fin
    UNION ALL
    SELECT &#39;RM&#39; as empresa, (SELECT count(*) FROM secondary.view_mov_inv_sin_cargar_rm WHERE enmatriz = false) as cantidad, (SELECT datetimefile FROM secondary.view_mov_inv_sin_cargar_rm WHERE enmatriz = false ORDER BY datetimefile  LIMIT 1) as fecha_mov_ini, (SELECT datetimefile FROM secondary.view_mov_inv_sin_cargar_rm WHERE enmatriz = false ORDER BY datetimefile DESC LIMIT 1) as fecha_mov_fin
    UNION ALL
    SELECT &#39;CR&#39; as empresa, (SELECT count(*) FROM secondary.view_mov_inv_sin_cargar_cr WHERE enmatriz = false) as cantidad, (SELECT datetimefile FROM secondary.view_mov_inv_sin_cargar_cr WHERE enmatriz = false ORDER BY datetimefile  LIMIT 1) as fecha_mov_ini, (SELECT datetimefile FROM secondary.view_mov_inv_sin_cargar_cr WHERE enmatriz = false ORDER BY datetimefile DESC LIMIT 1) as fecha_mov_fin;
  
cursor1_row RECORD;

BEGIN

SELECT COUNT(*) INTO procesos FROM pg_stat_activity WHERE query = &#39;SELECT secondary.fun_gen_resume_mov_inv($1::bigint, $2::bigint);&#39;;

RAISE NOTICE &#39;fun_gen_resume_mov_inv(%)&#39;, procesos;

IF procesos = 1 THEN

  FOR cursor1_row IN cursor1 LOOP

minutes_last := (EXTRACT(&#39;epoch&#39; FROM now() - cursor1_row.fecha_mov_ini) / 60)::INTEGER;

CASE 
WHEN minutes_last &gt; 120 THEN
priority := 1;
WHEN minutes_last &gt; 60 THEN
priority := 3;
WHEN minutes_last &gt; 30 THEN
priority := 5;
WHEN minutes_last &gt; 20 THEN
priority := 7;
WHEN minutes_last &lt;= 20 THEN
priority := 10;
ELSE
priority := 100;
END CASE;

IF cursor1_row.cantidad &gt; 0 THEN
eventtype := idevent_on_alarm;
ELSE
eventtype := idevent_on_restore;
priority := 10;
END IF;


CASE 
WHEN cursor1_row.empresa = &#39;ETA&#39; THEN
details := &#39;{&quot;iddivision&quot;: 6}&#39;;
WHEN cursor1_row.empresa = &#39;RM&#39; THEN
message := &#39;RM...&#39;;
details := &#39;{&quot;iddivision&quot;: 7}&#39;;
WHEN cursor1_row.empresa = &#39;CR&#39; THEN
message := &#39;CR...&#39;;
details := &#39;{&quot;iddivision&quot;: 8}&#39;;
ELSE
message := &#39;???...&#39;;
END CASE;

--message := &#39;&lt;b&gt;Sin cargar: &lt;/b&gt; &#39;||cursor1_row.cantidad::TEXT||&#39;&lt;br&gt;&lt;b&gt;Mas anterior: &lt;/b&gt;&#39;||cursor1_row.fecha_mov_ini::TEXT||&#39;&lt;br&gt;&lt;b&gt;Mas reciente: &lt;/b&gt;&#39;||cursor1_row.fecha_mov_fin::TEXT;
message := &#39;&lt;b&gt;Sin cargar: &lt;/b&gt; &#39;||cursor1_row.cantidad::TEXT;

INSERT INTO events.datas(idaccount, ideventtype, source, description, details, priority) VALUES(0, eventtype, md5(cursor1_row.empresa)::UUID, message, details::JSONB, priority);
R := TRUE;
 END LOOP;
   
ELSE
R := FALSE;
END IF;


RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_gen_resumen_vxmp() -->
    <section id="secondary.function.fun-gen-resumen-vxmp"
             xreflabel="secondaryfun_gen_resumen_vxmp()">
      <title id="secondary.function.fun-gen-resumen-vxmp-title">
       fun_gen_resumen_vxmp()
      </title>
      <titleabbrev id="secondary.function.fun-gen-resumen-vxmp-titleabbrev">
       fun_gen_resumen_vxmp()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>integer</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE 
sin_cargar_sap INTEGER DEFAULT 0;
--sin_cargar_sap INTEGER DEFAULT 0;


BEGIN
--------------------}
----------------
IF (SELECT COUNT(*) FROM pg_stat_activity WHERE query = &#39;SELECT secondary.fun_gen_resumen_vxmp();&#39;) = 1 THEN

-- ETA
SELECT COUNT(*) INTO sin_cargar_sap FROM secondary.view_docvxmp WHERE iddivision = 6 AND num_documento = &#39;&#39; AND valor &gt; 0;

IF sin_cargar_sap &gt; 0 THEN

INSERT INTO events.datas (ideventtype, idaccount, description, details, source) VALUES (65, 0, &#39;Hay &#39;||sin_cargar_sap::TEXT||&#39; documentos sin cargar.&#39;, json_build_object(&#39;iddivision&#39;, 6), md5(6::TEXT)::UUID);
ELSE
INSERT INTO events.datas (ideventtype, idaccount, description, details, source) VALUES (64, 0, &#39;Todos los documentos estan cargados&#39;, json_build_object(&#39;iddivision&#39;, 6), md5(6::TEXT)::UUID);
END IF;

-- RM
sin_cargar_sap:=0;
SELECT COUNT(*) INTO sin_cargar_sap FROM secondary.view_docvxmp WHERE iddivision = 7 AND num_documento = &#39;&#39; AND valor &gt; 0;
--SELECT iddivision INTO iiddivision  FROM accounts WHERE idaccount = iidaccount LIMIT 1;

IF sin_cargar_sap &gt; 0 THEN

INSERT INTO events.datas (ideventtype, idaccount, description, details, source) VALUES (65, 0, &#39;Hay &#39;||sin_cargar_sap::TEXT||&#39; documentos sin cargar.&#39;, json_build_object(&#39;iddivision&#39;, 7), md5(7::TEXT)::UUID);
ELSE
INSERT INTO events.datas (ideventtype, idaccount, description, details, source) VALUES (64, 0, &#39;Todos los documentos estan cargados&#39;, json_build_object(&#39;iddivision&#39;, 7), md5(7::TEXT)::UUID);
END IF;

END IF;

RETURN 0;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_insert_ventasxmp(list_doc bigint, iidaccount json) -->
    <section id="secondary.function.fun-insert-ventasxmp-list-doc-bigint-iidaccount-json"
             xreflabel="secondaryfun_insert_ventasxmp(list_doc bigint, iidaccount json)">
      <title id="secondary.function.fun-insert-ventasxmp-list-doc-bigint-iidaccount-json-title">
       fun_insert_ventasxmp(list_doc bigint, iidaccount json)
      </title>
      <titleabbrev id="secondary.function.fun-insert-ventasxmp-list-doc-bigint-iidaccount-json-titleabbrev">
       fun_insert_ventasxmp(list_doc bigint, iidaccount json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text[]</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R TEXT[];
doc JSON;
isvalid BOOLEAN DEFAULT FALSE;
--docisvalid BOOLEAN DEFAULT FALSE;
fecha_doc timestamptz;
nombre_doc TEXT;
doc_type TEXT;
valor_doc DECIMAL;
num_doc TEXT;
idreg BIGINT;
sin_cargar_sap INTEGER DEFAULT 0;
--iiddivision BIGINT;

BEGIN
--


FOR doc IN SELECT * FROM json_array_elements(list_doc) LOOP 

fecha_doc := ((doc-&gt;&gt;&#39;cvmp_fecha&#39;)::timestamp)::timestamptz;
nombre_doc := doc-&gt;&gt;&#39;cvmp_headertext&#39;::TEXT;
doc_type :=  doc -&gt;&gt; &#39;cvmp_doctype&#39;::TEXT;
valor_doc := (doc -&gt;&gt; &#39;cvmp_value&#39;::TEXT)::DECIMAL; 
num_doc := doc -&gt;&gt; &#39;cvmp_objkey&#39;::TEXT; 

IF num_doc IS NOT NULL AND LENGTH(num_doc) &gt; 5 THEN
isvalid := true;
ELSE
isvalid := false;
END IF;

SELECT idreginterfacesmatriz INTO idreg FROM secondary.view_docvxmp  WHERE idaccount = iidaccount AND namefile = nombre_doc AND datetimefile = fecha_doc AND doctype = doc_type AND valor = valor_doc;

IF idreg IS NOT NULL AND idreg &gt; 0 THEN

IF isvalid THEN
UPDATE secondary.interfaces_eta_rm_matriz SET datas = doc::JSONB, enmatriz = true, isvalid = true WHERE secondary.interfaces_eta_rm_matriz.idreginterfacesmatriz = idreg AND secondary.interfaces_eta_rm_matriz.isvalid = false;
END IF;

ELSE

--BEGIN
INSERT INTO secondary.interfaces_eta_rm_matriz(
            namefile, datetimefile, 
            nameinterface, datas, idaccount, isvalid, enmatriz)
    VALUES (nombre_doc, fecha_doc, 
            &#39;docvxmp&#39;, doc::JSONB, iidaccount, isvalid, isvalid); -- No funciona el on conflict, reimplementar
       --     EXCEPTION WHEN unique_violation THEN
 -- do nothing
     --END;   

END IF;

R := array_append(R, (doc-&gt;&gt;&#39;cvmp_objkey&#39;)::TEXT);

END LOOP;



RETURN R;
END
</programlisting>
      </para>
    </section>

<!-- Function fun_insertupdate_interface(ifirma text, iobservations timestamp with time zone, ienmatriz integer, idatas text, inameinterface jsonb, ifileline boolean, idatetimefile jsonb, inamefile text) -->
    <section id="secondary.function.fun-insertupdate-interface-ifirma-text-iobservations-timestamp-with-time-zone-ienmatriz-integer-idatas-text-inameinterface-jsonb-ifileline-boolean-idatetimefile-jsonb-inamefile-text"
             xreflabel="secondaryfun_insertupdate_interface(ifirma text, iobservations timestamp with time zone, ienmatriz integer, idatas text, inameinterface jsonb, ifileline boolean, idatetimefile jsonb, inamefile text)">
      <title id="secondary.function.fun-insertupdate-interface-ifirma-text-iobservations-timestamp-with-time-zone-ienmatriz-integer-idatas-text-inameinterface-jsonb-ifileline-boolean-idatetimefile-jsonb-inamefile-text-title">
       fun_insertupdate_interface(ifirma text, iobservations timestamp with time zone, ienmatriz integer, idatas text, inameinterface jsonb, ifileline boolean, idatetimefile jsonb, inamefile text)
      </title>
      <titleabbrev id="secondary.function.fun-insertupdate-interface-ifirma-text-iobservations-timestamp-with-time-zone-ienmatriz-integer-idatas-text-inameinterface-jsonb-ifileline-boolean-idatetimefile-jsonb-inamefile-text-titleabbrev">
       fun_insertupdate_interface(ifirma text, iobservations timestamp with time zone, ienmatriz integer, idatas text, inameinterface jsonb, ifileline boolean, idatetimefile jsonb, inamefile text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>bigint</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R BIGINT DEFAULT -100;
id BIGINT DEFAULT 0;

BEGIN

SELECT idreginterfacesmatriz INTO id FROM secondary.interfaces_eta_rm_matriz WHERE namefile = inamefile AND datetimefile = idatetimefile AND fileline = ifileline AND nameinterface = inameinterface AND datas = idatas AND observations = iobservations AND file_fingerprint = ifirma::uuid;

IF id IS NOT NULL AND id &gt; 0 THEN

UPDATE secondary.interfaces_eta_rm_matriz SET enmatriz = ienmatriz WHERE idreginterfacesmatriz = id;
R := id;

ELSE

INSERT INTO secondary.interfaces_eta_rm_matriz(
             namefile, datetimefile, fileline, nameinterface,  datas, enmatriz, observations, file_fingerprint)
    VALUES ( inamefile, idatetimefile, ifileline, inameinterface, idatas, ienmatriz, iobservations, ifirma::uuid);

    R := 99999999;

END IF;


RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_update_lista_precios_oficinas(fun_msg integer, fun_return text, iip text, iprovincia integer, iproductos text, iactiva inet) -->
    <section id="secondary.function.fun-update-lista-precios-oficinas-fun-msg-integer-fun-return-text-iip-text-iprovincia-integer-iproductos-text-iactiva-inet"
             xreflabel="secondaryfun_update_lista_precios_oficinas(fun_msg integer, fun_return text, iip text, iprovincia integer, iproductos text, iactiva inet)">
      <title id="secondary.function.fun-update-lista-precios-oficinas-fun-msg-integer-fun-return-text-iip-text-iprovincia-integer-iproductos-text-iactiva-inet-title">
       fun_update_lista_precios_oficinas(fun_msg integer, fun_return text, iip text, iprovincia integer, iproductos text, iactiva inet)
      </title>
      <titleabbrev id="secondary.function.fun-update-lista-precios-oficinas-fun-msg-integer-fun-return-text-iip-text-iprovincia-integer-iproductos-text-iactiva-inet-titleabbrev">
       fun_update_lista_precios_oficinas(fun_msg integer, fun_return text, iip text, iprovincia integer, iproductos text, iactiva inet)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

istatus TEXT DEFAULT &#39;INDEFINIDO&#39;;
isincro TEXT DEFAULT &#39;INDEFINIDO&#39;;

BEGIN

fun_return := -100;
fun_msg := &#39;Error desconocido&#39;;

IF (iprincipal = iactiva)  AND  iproductos &gt; 0 THEN
istatus := &#39;OK&#39;;
ELSE
istatus := &#39;ERROR&#39;;
END IF;

/*
IF iprincipal = i159principal AND iactiva = i159activa  THEN
--IF EXISTS(SELECT * FROM farma_lista_precios_farmacias WHERE idaccount=iidaccount AND srv159_activa = activa AND productos = srv159_productos AND srv159_principal = principal)  THEN
isincro := &#39;OK&#39;;
ELSE
isincro := &#39;ERROR&#39;;
END IF;
*/

--select ip INTO iip from view_account_network_devices where idcontact = iidaccount AND  equipment ILIKE &#39;%SQL%&#39; LIMIT 1;

RAISE NOTICE &#39;(%) (%) &#39;, iprincipal, iactiva;
--RAISE NOTICE &#39;(%) (%) &#39;, i159principal, i159activa;


--
UPDATE secondary.lista_precios_oficinas
SET principal=iprincipal, 
activa=iactiva, 
productos=iproductos,
--srv159_principal=i159principal, 
--srv159_activa=i159activa, 
--srv159_productos=i159productos, 
status = istatus,
sincronizado = isincro, 
ip = iip::text, 
--provincia = iprovincia,
ts_lista_farmacia = now()
--ts_lista_srv159 = now()
 WHERE idaccount=iidaccount;

RAISE NOTICE &#39;(%) (%) &#39;, iprincipal, iactiva;
--RAISE NOTICE &#39;(%) (%) &#39;, i159principal, i159activa;

fun_return := 1;
fun_msg := &#39;Registro actualizado&#39;;

        IF NOT found THEN
/*
INSERT INTO farma_lista_precios_farmacias(
            idaccount, principal, activa, productos, status, sincronizado, ts_lista_farmacia, ip)
    VALUES (iidaccount, iprincipal, iactiva, iproductos, istatus, isincro, now(), iip::text) RETURNING idlista_precios INTO fun_return;
*/
INSERT INTO secondary.lista_precios_oficinas(
            idaccount, principal, activa, productos, status, 
            ts, ts_lista_farmacia, sincronizado, provincia, ip)
    VALUES (iidaccount, iprincipal, iactiva, iproductos, istatus, 
           now(), now(), isincro, iprovincia, iip);
fun_msg := &#39;Nuevo registro insertado&#39;;
        END IF;
 

RETURN;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_view_lista_precios_oficinas() -->
    <section id="secondary.function.fun-view-lista-precios-oficinas"
             xreflabel="secondaryfun_view_lista_precios_oficinas()">
      <title id="secondary.function.fun-view-lista-precios-oficinas-title">
       fun_view_lista_precios_oficinas()
      </title>
      <titleabbrev id="secondary.function.fun-view-lista-precios-oficinas-titleabbrev">
       fun_view_lista_precios_oficinas()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>SET OF record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
DECLARE myrow accounts%ROWTYPE;
DECLARE mylista secondary.lista_precios_oficinas%ROWTYPE;
BEGIN
   FOR myrow IN SELECT * FROM accounts where accounts.enabled = true
   LOOP
iddivision :=  myrow.iddivision;
SELECT * INTO mylista FROM secondary.lista_precios_oficinas WHERE secondary.lista_precios_oficinas.idaccount = myrow.idaccount;
--SELECT contact_name INTO tecnico FROM view_accounts_oams_assigned WHERE view_accounts_oams_assigned.idaccount = myrow.idaccount;


idaccount := myrow.idaccount;
account := myrow.account;
account_name:= myrow.account_name;
address:=myrow.address;
note:=myrow.note;
--tecnico := &#39;???&#39;;


srv159_principal := mylista.srv159_principal;
srv159_activa := mylista.srv159_activa;
srv159_productos := mylista.srv159_productos;

ip := mylista.ip;
provincia := mylista.provincia;


principal := mylista.principal;
activa := mylista.activa;
productos := mylista.productos;
estado := mylista.status;
sincronizado := mylista.sincronizado;

ts_farmacia:= mylista.ts_lista_farmacia;
ts_server159:= mylista.ts_lista_srv159;

   RETURN NEXT;
   END LOOP;
   RETURN;
END;
</programlisting>
      </para>
    </section>

<!-- Function funjs_mensaje_ayuda_dashboard(ipriority text, iideventtype bigint, iddivision integer) -->
    <section id="secondary.function.funjs-mensaje-ayuda-dashboard-ipriority-text-iideventtype-bigint-iddivision-integer"
             xreflabel="secondaryfunjs_mensaje_ayuda_dashboard(ipriority text, iideventtype bigint, iddivision integer)">
      <title id="secondary.function.funjs-mensaje-ayuda-dashboard-ipriority-text-iideventtype-bigint-iddivision-integer-title">
       funjs_mensaje_ayuda_dashboard(ipriority text, iideventtype bigint, iddivision integer)
      </title>
      <titleabbrev id="secondary.function.funjs-mensaje-ayuda-dashboard-ipriority-text-iideventtype-bigint-iddivision-integer-titleabbrev">
       funjs_mensaje_ayuda_dashboard(ipriority text, iideventtype bigint, iddivision integer)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var R = &quot;SIN NOVEDADES&quot;;
var Empresa = &#39;-&#39;;

switch(iddivision){
case &#39;6&#39;:
Empresa = &#39;ETAFASHION&#39;
break;
case &#39;7&#39;:
Empresa = &#39;RM&#39;
break;
case &#39;8&#39;:
Empresa = &#39;RM COSTARICA&#39;
break;
}

if(ipriority &lt; 4){

R = &#39;EXISTEN NOVEDADES.&#39;

switch(iideventtype){
case 39:
R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; MOVIMIENTOS DE INVENTARIOS &gt; SIN CARGAR&#39;;
break;
case 83:
R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
break;
case 139:
// Materiales sin marca
//R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
R = &#39;EXISTEN NOVEDADES.&#39;
break;
case 139:
// Movimientos de inventario sin materiales
//R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
break;
case 68:
// Generacion de archivos de ventas por materiales
R = &#39;Revisar en la carpeta compartida del servidor 172.16.106.19 en las carpetas que corresponden a cada tienda.&#39;;


break;
case 137:
// Carga de archivo de artculos
R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; ARTICULOS&#39;;
break;
case 63:
// &quot;Carga de archivo de artculos auxiliar&quot;
R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; ARTICULOS AUX&#39;;
break;
case 88:
// Carga de archivo de Proveedores
//R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
break;
case 82:
// Carga de archivo Formas de pago Crdito
//R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
break;
case 89:
// Carga archivo Tipo Transaccin Crdito
//R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
break;
case 95:
// Carga archivo Fecha Pago Crdito
//R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
break;
case 103:
// Clientes
R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; CLIENTES&#39;;
break;
case 126:
// Direcciones
R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
break;
case 133:
// Saldos
//R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; EMPLEADOS&#39;;
break;
case 64:
// Ventas x medios pago
R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+Empresa+&#39; &gt; VENTAS X MEDIOS PAGO&#39;;
break;


default:
//R = &#39;Ver el detalle en el men: ANEXOS &gt; &#39;+ipriority+&#39; &gt; VENTAS X MEDIOS PAGO &#39;+iideventtype;
R = &#39;EXISTEN NOVEDADES *&#39;
break;
}
}


return R;</programlisting>
      </para>
    </section>

<!-- Function secondary_on_changed_table() -->
    <section id="secondary.function.secondary-on-changed-table"
             xreflabel="secondarysecondary_on_changed_table()">
      <title id="secondary.function.secondary-on-changed-table-title">
       secondary_on_changed_table()
      </title>
      <titleabbrev id="secondary.function.secondary-on-changed-table-titleabbrev">
       secondary_on_changed_table()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE

parent_table TEXT DEFAULT &#39;&#39;;

BEGIN

CASE
WHEN TG_TABLE_NAME ILIKE &#39;datas_%&#39; AND TG_TABLE_SCHEMA = &#39;events&#39; THEN
parent_table:= &#39;datas&#39;;

WHEN TG_TABLE_NAME ILIKE &#39;comments_%&#39; AND TG_TABLE_SCHEMA = &#39;events&#39;  THEN
parent_table:= &#39;comments&#39;;

WHEN TG_TABLE_NAME ILIKE &#39;interfaces_eta_rm_matriz_%&#39; AND TG_TABLE_SCHEMA = &#39;secondary&#39; THEN
parent_table:= &#39;interfaces_eta_rm_matriz&#39;;

ELSE
parent_table:= TG_TABLE_NAME;

END CASE;
    

INSERT INTO table_modification_log(
            table_name, schema_name)
    VALUES (parent_table, TG_TABLE_SCHEMA);

/*

RAISE NOTICE &#39;1) Inicia Trigger on_changed_table&#39;;

UPDATE sys_table_ts SET ts = now() WHERE table_name = TG_TABLE_NAME;
RAISE NOTICE &#39;2) Se ha actualizado&#39;;

        IF NOT found THEN
RAISE NOTICE &#39;3) Registro no encontrado, se crea uno nuevo&#39;;
INSERT INTO sys_table_ts (table_name) VALUES (TG_TABLE_NAME);
        END IF;

RAISE NOTICE &#39;4) Termina on_changed_table&#39;;


BEGIN

CASE
WHEN TG_TABLE_NAME ILIKE &#39;events_%&#39; THEN
parent_table:= &#39;events&#39;;
WHEN TG_TABLE_NAME ILIKE &#39;event_comments_%&#39; THEN
parent_table:= &#39;event_comments&#39;;
ELSE

END CASE;


IF LENGTH(parent_table) &gt; 0 THEN

UPDATE sys_table_ts SET ts = now() WHERE table_name = parent_table;
RAISE NOTICE &#39;A) Se ha actualizado tabla padre %&#39;,parent_table;

        IF NOT found THEN
RAISE NOTICE &#39;B) Registro no encontrado, se crea uno nuevo %&#39;,parent_table;
INSERT INTO sys_table_ts (table_name) VALUES (parent_table);
        END IF;

END IF;



END;
*/

RETURN NULL;
END;</programlisting>
      </para>
    </section>

  </chapter>

  <chapter id="services.schema"
           xreflabel="services">
    <title>Schema services</title>
    <para>Schema para servicios, por ejemplo servicio para recepcion de eventos.	 </para>


      <section id="services.table.-input-buffer"
               xreflabel="services._input_buffer">
        <title id="services.table.-input-buffer-title">
         Table:
         
         <structname>_input_buffer</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>_input_buffer</structname>
            </title>


            <varlistentry>
              <term><structfield>idreg</structfield></term>
              <listitem><para>
                <type>uuid</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>loaded</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>data</structfield></term>
              <listitem><para>
                <type>jsonb</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ip</structfield></term>
              <listitem><para>
                <type>inet</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;0.0.0.0&apos;::inet</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idstatusraw</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="services.table.-statusraw"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcommunicator</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="services.table.communicators"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idservice</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>iddevice</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="services.table.-statusraw"
               xreflabel="services._statusraw">
        <title id="services.table.-statusraw-title">
         Table:
         
         <structname>_statusraw</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>_statusraw</structname>
            </title>


            <varlistentry>
              <term><structfield>idstatusraw</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>status_label</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing services._input_buffer via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="services.table.-input-buffer"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="services.table.datas"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="services.table.communicators"
               xreflabel="services.communicators">
        <title id="services.table.communicators-title">
         Table:
         
         <structname>communicators</structname>
        </title>
 

        <para>
          Lista de comunicadores (Agentes)
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>communicators</structname>
            </title>


            <varlistentry>
              <term><structfield>idcommunicator</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pwd</structfield></term>
              <listitem><para>
                <type>text</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT md5((now())::text)</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>







        <itemizedlist>
          <title>
            Tables referencing services._input_buffer via Foreign Key Constraints
          </title>

          <listitem>
            <para>
              <xref linkend="services.table.-input-buffer"/>
            </para>
          </listitem>



          <listitem>
            <para>
              <xref linkend="services.table.datas"/>
            </para>
          </listitem>

        </itemizedlist>






      </para>
    </section>

      <section id="services.table.datas"
               xreflabel="services.datas">
        <title id="services.table.datas-title">
         Table:
         
         <structname>datas</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>datas</structname>
            </title>


            <varlistentry>
              <term><structfield>idevent</structfield></term>
              <listitem><para>
                <type>uuid</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>loaded</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>dateevent</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>












                <literal>REFERENCES</literal> <xref linkend="contacts.table.contacts"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>data</structfield></term>
              <listitem><para>
                <type>jsonb</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>key</structfield></term>
              <listitem><para>
                <type>uuid</type>







                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;00000000-0000-0000-0000-000000000000&apos;::uuid</literal>




                <literal>REFERENCES</literal> <xref linkend="public.table.-devices"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ip</structfield></term>
              <listitem><para>
                <type>inet</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT &apos;0.0.0.0&apos;::inet</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idstatusraw</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="services.table.-statusraw"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcommunicator</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="services.table.communicators"/>


              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="services.table.services"
               xreflabel="services.services">
        <title id="services.table.services-title">
         Table:
         
         <structname>services</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>services</structname>
            </title>


            <varlistentry>
              <term><structfield>idservice</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>service_name</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>description</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>is_public</structfield></term>
              <listitem><para>
                <type>boolean</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT false</literal>



              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>



<!-- Function __funjs_point(service_request json) -->
    <section id="services.function.-funjs-point-service-request-json"
             xreflabel="services__funjs_point(service_request json)">
      <title id="services.function.-funjs-point-service-request-json-title">
       __funjs_point(service_request json)
      </title>
      <titleabbrev id="services.function.-funjs-point-service-request-json-titleabbrev">
       __funjs_point(service_request json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>text</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
var R = [];

/*
	{
		header: {
			ip: X,
			token: Y,
			user_agent: X
		},
		request:[
		{service: &quot;A&quot;, content: [
			{key: &quot;asm&quot;, datas: {}}
		]}
		]
	}
	*/

	if(service_request.request &amp;&amp; service_request.header){

		var token = service_request.header.token||&#39;&#39;;

		if(service_request.header.service &amp;&amp; service_request.header.service.length &gt; 0){


			try{

// Revisa que la funcion exista
var fun_service = plv8.find_function(&#39;services.funjs_&#39;+service_request.header.service);
// Revisa que el servicio este habilitado para ser consumido				
var service = plv8.execute( &#39;SELECT services.fun_check_service($1::TEXT, $2::TEXT);&#39;, [ service_request.header.service, token ] )[0].fun_check_service;

switch(service.error){
	case 0:
R = fun_service(service_request.header, service_request.request);	
/*
	service_request.request.forEach(function(req){
		plv8.elog(NOTICE, &quot;req = &quot;, JSON.stringify(req));
		
	});
	*/

	break;
	default:
	r.message = service.message;
	r.error = service.error+4;
	R.response.push(r);
	break;
}

}catch(e){
	R.message = e.message;
	R.error = 2;
}

}else{
	R.message = &#39;Did not specify the service&#39;;
	R.error = 1;
}


}else{
	R.message = &#39;Did not specify the request o header&#39;;
	R.error = 3;
}

return JSON.stringify(R, function(key, value){

		if(typeof value === &quot;string&quot;){
			return value.split(&quot;\n&quot;).join(&#39; &#39;);
		}else if(value === null) {
			return undefined;
		}
		return value;
	}).replace(/(\&quot;&lt;jsfunction&gt;|&lt;\/jsfunction&gt;\&quot;)/ig,&#39;&#39;);


</programlisting>
      </para>
    </section>

<!-- Function _fun_login(ip bigint, pass text, id inet) -->
    <section id="services.function.-fun-login-ip-bigint-pass-text-id-inet"
             xreflabel="services_fun_login(ip bigint, pass text, id inet)">
      <title id="services.function.-fun-login-ip-bigint-pass-text-id-inet-title">
       _fun_login(ip bigint, pass text, id inet)
      </title>
      <titleabbrev id="services.function.-fun-login-ip-bigint-pass-text-id-inet-titleabbrev">
       _fun_login(ip bigint, pass text, id inet)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>boolean</seg>
        </seglistitem>
       </segmentedlist>
 
       No estoy seguro si se usa en otro lado
        <programlisting>DECLARE
R BOOLEAN DEFAULT FALSE;

BEGIN
--SELECT idcommunicator, ts, footprint_row, pwd, enabled, datetime_start, datetime_end, description FROM services.communicators where idcommunicator = 1 AND enabled = true AND now() BETWEEN datetime_start AND datetime_end AND pwd = &#39;a7f1f965a9c5e6f3f4666af038763418&#39;;
IF EXISTS(SELECT * FROM services.communicators where idcommunicator = id AND enabled = true AND now() BETWEEN datetime_start AND datetime_end AND pwd = pass) THEN
R := TRUE;
-- Ingresar como evento el ingreso del comunicador 
INSERT INTO events.datas(
            idaccount, ideventtype, description)
    VALUES (0, 1006, ip::TEXT);
ELSE
-- Ingresar como evento el inetnto de acceso
R := FALSE;
INSERT INTO events.datas(
            idaccount, ideventtype, description)
    VALUES (0, 1007, ip::TEXT);

END IF;

RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function _fun_service_point(service_request json) -->
    <section id="services.function.-fun-service-point-service-request-json"
             xreflabel="services_fun_service_point(service_request json)">
      <title id="services.function.-fun-service-point-service-request-json-title">
       _fun_service_point(service_request json)
      </title>
      <titleabbrev id="services.function.-fun-service-point-service-request-json-titleabbrev">
       _fun_service_point(service_request json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var R = {response: []};

if(service_request.requests &amp;&amp; service_request.header){

	service_request.requests.forEach(function(req){

		plv8.elog(NOTICE, &quot;req = &quot;, JSON.stringify(req));

		if(req.service &amp;&amp; req.service.length &gt; 0){

			R.error = 0;
			plv8.elog(NOTICE, &quot;req = &quot;, 1);

			try{

				var token = service_request.header.token||&#39;&#39;;
				var fun_service = plv8.find_function(&#39;services.funjs_&#39;+req.service);
				var service = plv8.execute( &#39;SELECT services.fun_check_service($1::TEXT, $2::TEXT);&#39;, [ req.service, token ] )[0].fun_check_service;

				var r = {service: req.service, response: []};

				switch(service.error){
					case 0:
					r.response = fun_service(service_request.header, req);
					R.response.push(r);
					break;
					default:
					r.message = service.message;
					r.error = service.error+4;
					R.response.push(r);
					break;
				}

			}catch(e){
				R.message = e.message;
				R.error = 2;
			}


		}else{
			R.message = &#39;Did not specify the service&#39;;
			R.error = 1;
		}

	});
	
}else{
	R.message = &#39;Did not specify the request o header&#39;;
	R.error = 3;
}


return R;</programlisting>
      </para>
    </section>

<!-- Function _funjs_login_user(user_credentials json) -->
    <section id="services.function.-funjs-login-user-user-credentials-json"
             xreflabel="services_funjs_login_user(user_credentials json)">
      <title id="services.function.-funjs-login-user-user-credentials-json-title">
       _funjs_login_user(user_credentials json)
      </title>
      <titleabbrev id="services.function.-funjs-login-user-user-credentials-json-titleabbrev">
       _funjs_login_user(user_credentials json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var R = {iduser: 0, token: &#39;&#39;, error: 0, message: &#39;&#39;};

if(user_credentials &amp;&amp; user_credentials.user &amp;&amp; user_credentials.pwd &amp;&amp; user_credentials.ip &amp;&amp; user_credentials.user_agent){

/*
//SELECT iduser, username, ts, footprint_row, idcontact, enabled, user_start, 
       user_end, pwd, user_role, divisions, accounts, locked_date, failed_access_attempts, 
       email_notification, xmpp_notification, admin_attention_group
  FROM users.users;
*/

var user = plv8.execute( &#39;SELECT * FROM users.users WHERE username = $1 AND pwd = md5($2) LIMIT 1;&#39;, [user_credentials.user, user_credentials.pwd]);

//plv8.elog(NOTICE, &quot;U = &quot;, JSON.stringify(user));

if(user.length &gt; 0){

R.iduser = user[0].iduser;
plv8.execute( &#39;DELETE FROM users.tokens WHERE isuser = true AND id = $1;&#39;, [R.iduser]);
var token = plv8.execute( &#39;INSERT INTO users.tokens(token, isuser, id, first_heartbeat, last_heartbeat) VALUES ($1, true, $2, now(), now()) RETURNING token;&#39;, [plv8.find_function(&quot;funjs_md5&quot;)(JSON.stringify(user)+Date.now()), R.iduser]);
if(token.length &gt; 0){
R.token = token[0].token;
}

//plv8.elog(NOTICE, &quot;t = &quot;, JSON.stringify(token));

}else{
R.error = 2;
R.message = &#39;Usuario o clave invalida&#39;;
}

}else{
R.error = 1;
R.message = &#39;Las credenciales no estan completas&#39;;
plv8.elog(NOTICE, &quot;Error = &quot;, &#39;Sin credeneciles No valido&#39;);
}

return R;</programlisting>
      </para>
    </section>

<!-- Function create_uuid_reg() -->
    <section id="services.function.create-uuid-reg"
             xreflabel="servicescreate_uuid_reg()">
      <title id="services.function.create-uuid-reg-title">
       create_uuid_reg()
      </title>
      <titleabbrev id="services.function.create-uuid-reg-titleabbrev">
       create_uuid_reg()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN

NEW.idreg := md5(NEW.data::TEXT)::UUID;

RETURN NEW;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_check_service(itoken text, service text) -->
    <section id="services.function.fun-check-service-itoken-text-service-text"
             xreflabel="servicesfun_check_service(itoken text, service text)">
      <title id="services.function.fun-check-service-itoken-text-service-text-title">
       fun_check_service(itoken text, service text)
      </title>
      <titleabbrev id="services.function.fun-check-service-itoken-text-service-text-titleabbrev">
       fun_check_service(itoken text, service text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R json;
ispublic boolean default false;
id BIGINT DEFAULT -100;

BEGIN

SELECT idservice, is_public INTO id, ispublic FROM services.services WHERE service_name = service AND enabled = true;

IF id &lt; 1 OR id IS NULL THEN

--IF EXISTS(SELECT * FROM information_schema.routines WHERE  specific_schema LIKE &#39;services&#39; AND routine_name LIKE &#39;funjs_&#39;||service) AND NOT EXISTS(SELECT * FROM services.services WHERE service_name = service) THEN
--INSERT INTO services.services (service_name) VALUES (service);
--END IF;

R := json_build_object(&#39;idservice&#39;,-1,&#39;error&#39;,1, &#39;message&#39;, &#39;El servicio no existe o no esta habilitado&#39;);

ELSE

R := json_build_object(&#39;idservice&#39;,id,&#39;error&#39;,0, &#39;message&#39;, &#39;&#39;);

IF ispublic = FALSE AND NOT EXISTS(SELECT * FROM users.tokens WHERE users.tokens.token::TEXT = itoken) THEN
	R := json_build_object(&#39;idservice&#39;,-2,&#39;error&#39;,2, &#39;message&#39;, &#39;Es requerido un token valido para este servicio&#39;);
END IF;


END IF;

RETURN R;
END;</programlisting>
      </para>
    </section>

<!-- Function fun_eta_interface_txt(message text, delivery_status json) -->
    <section id="services.function.fun-eta-interface-txt-message-text-delivery-status-json"
             xreflabel="servicesfun_eta_interface_txt(message text, delivery_status json)">
      <title id="services.function.fun-eta-interface-txt-message-text-delivery-status-json-title">
       fun_eta_interface_txt(message text, delivery_status json)
      </title>
      <titleabbrev id="services.function.fun-eta-interface-txt-message-text-delivery-status-json-titleabbrev">
       fun_eta_interface_txt(message text, delivery_status json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>SET OF record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R TEXT[];
e JSON;
ideq BIGINT;
--id BIGINT;
interface TEXT;
iiddivision BIGINT;
iidaccount BIGINT;

BEGIN

-- Valida que exista el id del equipo
--SELECT idequipment INTO ideq FROM equipments WHERE report_validator = devicekey;
SELECT idequipment, iddivision, idaccount INTO ideq, iiddivision, iidaccount FROM view_account_network_devices WHERE report_validator = devicekey;


IF ideq &gt; 0 THEN

FOR e IN SELECT * FROM json_array_elements(list) LOOP 

interface := (e-&gt;&gt;&#39;Interface&#39;)::TEXT;
idqueue := (e-&gt;&gt;&#39;idQueue&#39;)::TEXT;
delivery_status := -1;
message := &#39;&#39;;

RAISE NOTICE &#39;NombreArchivo(%)&#39;, (e-&gt;&gt;&#39;NombreArchivo&#39;)::TEXT;
RAISE NOTICE &#39;FechaCreacionArchivo(%)&#39;, (e-&gt;&gt;&#39;FechaCreacionArchivo&#39;)::TEXT;
RAISE NOTICE &#39;NombreArchivo(%)&#39;, (e-&gt;&gt;&#39;NombreArchivo&#39;)::TEXT;
RAISE NOTICE &#39;NumLinea(%)&#39;, (e-&gt;&gt;&#39;NumLinea&#39;)::TEXT;
RAISE NOTICE &#39;Interface(%)&#39;, interface;
RAISE NOTICE &#39;DatosLinea(%)&#39;, (e-&gt;&gt;&#39;DatosLinea&#39;)::TEXT;

IF interface IS NOT NULL THEN

BEGIN 
INSERT INTO secondary.interfaces_eta_rm_matriz(
            namefile, datetimefile, 
            fileline, nameinterface, 
            datas, enmatriz, isvalid, idaccount)
VALUES ((e-&gt;&gt;&#39;NombreArchivo&#39;)::TEXT, 
(e-&gt;&gt;&#39;FechaCreacionArchivo&#39;)::TIMESTAMP WITH TIME ZONE, 
            (e-&gt;&gt;&#39;NumLinea&#39;)::INTEGER, interface, 
            (e-&gt;&gt;&#39;DatosLinea&#39;)::JSONB, (e-&gt;&gt;&#39;EnMatriz&#39;)::BOOLEAN, (e-&gt;&gt;&#39;EsValido&#39;)::BOOLEAN, iidaccount);

            idreg:= currval(&#39;secondary.eta_materiales_idregmat_seq&#39;::regclass);
            delivery_status := 0;
            
RAISE NOTICE &#39;idreg(%)&#39;, idreg::text;
RETURN NEXT;

        EXCEPTION WHEN unique_violation THEN
         delivery_status := 1;
message := &#39;unique_violation&#39;;
            -- Do nothing, and loop to try the UPDATE again.
            --R := array_append(R, (e-&gt;&gt;&#39;idQueue&#39;)::TEXT);
END;

ELSE
delivery_status := 2;
message := &#39;No contiene interface&#39;;


              END IF;
     

      

END LOOP;

END IF;


-- RETURN NEXT;

--RETURN R;
END
</programlisting>
      </para>
    </section>

<!-- Function fun_eta_resultado_validacion_txt_interfaces(message text, delivery_status json) -->
    <section id="services.function.fun-eta-resultado-validacion-txt-interfaces-message-text-delivery-status-json"
             xreflabel="servicesfun_eta_resultado_validacion_txt_interfaces(message text, delivery_status json)">
      <title id="services.function.fun-eta-resultado-validacion-txt-interfaces-message-text-delivery-status-json-title">
       fun_eta_resultado_validacion_txt_interfaces(message text, delivery_status json)
      </title>
      <titleabbrev id="services.function.fun-eta-resultado-validacion-txt-interfaces-message-text-delivery-status-json-titleabbrev">
       fun_eta_resultado_validacion_txt_interfaces(message text, delivery_status json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>SET OF record</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R TEXT[];
e JSON;
ideq BIGINT;
--id BIGINT;
PrefijoArchivo TEXT;
ipriority INTEGER DEFAULT 10;
iideventtype BIGINT DEFAULT  0;
iiddivision BIGINT DEFAULT  -1;

BEGIN

-- Valida que exista el id del equipo
SELECT idequipment, iddivision INTO ideq, iiddivision FROM view_account_network_devices WHERE report_validator = devicekey;

--SELECT idequipment INTO ideq FROM equipments WHERE report_validator = devicekey;

IF ideq &gt; 0 THEN

FOR e IN SELECT * FROM json_array_elements(list) LOOP 


PrefijoArchivo := (e-&gt;&gt;&#39;PrefijoArchivo&#39;)::TEXT;
idqueue := (e-&gt;&gt;&#39;idQueue&#39;)::TEXT;

delivery_status := -1;
message := &#39;&#39;;
/*
RAISE NOTICE &#39;NombreArchivo(%)&#39;, (e-&gt;&gt;&#39;NombreArchivo&#39;)::TEXT;
RAISE NOTICE &#39;FechaCreacionArchivo(%)&#39;, (e-&gt;&gt;&#39;FechaCreacionArchivo&#39;)::TEXT;
RAISE NOTICE &#39;NombreArchivo(%)&#39;, (e-&gt;&gt;&#39;NombreArchivo&#39;)::TEXT;
RAISE NOTICE &#39;NumLinea(%)&#39;, (e-&gt;&gt;&#39;NumLinea&#39;)::TEXT;
RAISE NOTICE &#39;Interface(%)&#39;, interface;
RAISE NOTICE &#39;DatosLinea(%)&#39;, (e-&gt;&gt;&#39;DatosLinea&#39;)::TEXT;
*/

IF PrefijoArchivo IS NOT NULL THEN

BEGIN 

CASE

WHEN PrefijoArchivo = &#39;empleados&#39; THEN
iideventtype := 83;
WHEN PrefijoArchivo = &#39;proveedores&#39; THEN
iideventtype := 88;
WHEN PrefijoArchivo = &#39;fmapago&#39; THEN
iideventtype := 82;
WHEN PrefijoArchivo = &#39;tipotxs&#39; THEN
iideventtype := 89;
WHEN PrefijoArchivo = &#39;fechapago&#39; THEN
iideventtype := 95;
WHEN PrefijoArchivo = &#39;clientes&#39; THEN
iideventtype := 103;
WHEN PrefijoArchivo = &#39;direcciones&#39; THEN
iideventtype := 126;
WHEN PrefijoArchivo = &#39;saldocli&#39; THEN
iideventtype := 133;
WHEN PrefijoArchivo = &#39;articulos&#39; THEN
iideventtype := 63;
WHEN PrefijoArchivo = &#39;articulosauxiliar&#39; THEN
iideventtype := 137;
WHEN PrefijoArchivo = &#39;ventasxmateriales&#39; THEN
iideventtype := 68;


ELSE
iideventtype := 0;
END CASE;

IF (e-&gt;&gt;&#39;Resultado&#39;)::TEXT = &#39;false&#39; THEN
ipriority:= 1;
ELSE
ipriority:= 10;
END IF;




INSERT INTO events.datas(
            idaccount, priority, 
            ideventtype, description, details, source)
    VALUES (0, ipriority, 
            iideventtype, (e-&gt;&gt;&#39;Mensaje&#39;)::TEXT, json_build_object(&#39;iddivision&#39;,iiddivision)::JSONB, md5(e-&gt;&gt;&#39;Archivo&#39;::TEXT)::uuid);
            --iideventtype, (e-&gt;&gt;&#39;Mensaje&#39;)::TEXT, &#39;{&quot;iddivision&quot;: 6}&#39;::jsonb, md5(&#39;ETA&#39;)::uuid);

/*
INSERT INTO secondary.interfaces_eta_rm_matriz(
            namefile, datetimefile, 
            fileline, nameinterface, 
            datas, enmatriz, isvalid)
VALUES ((e-&gt;&gt;&#39;NombreArchivo&#39;)::TEXT, 
(e-&gt;&gt;&#39;FechaCreacionArchivo&#39;)::TIMESTAMP WITH TIME ZONE, 
            (e-&gt;&gt;&#39;NumLinea&#39;)::INTEGER, interface, 
            (e-&gt;&gt;&#39;DatosLinea&#39;)::JSONB, (e-&gt;&gt;&#39;EnMatriz&#39;)::BOOLEAN, (e-&gt;&gt;&#39;EsValido&#39;)::BOOLEAN);

            idreg:= currval(&#39;secondary.eta_materiales_idregmat_seq&#39;::regclass);
            delivery_status := 0;
            */
            
RAISE NOTICE &#39;idreg(%)&#39;, idreg::text;
RETURN NEXT;

        EXCEPTION WHEN unique_violation THEN
         delivery_status := 1;
message := &#39;unique_violation&#39;;
            -- Do nothing, and loop to try the UPDATE again.
            --R := array_append(R, (e-&gt;&gt;&#39;idQueue&#39;)::TEXT);
END;

ELSE
delivery_status := 2;
message := &#39;No contiene interface&#39;;


              END IF;
     

      

END LOOP;

END IF;


-- RETURN NEXT;

--RETURN R;
END
</programlisting>
      </para>
    </section>

<!-- Function fun_event_receiver(list_events text, devicekey json) -->
    <section id="services.function.fun-event-receiver-list-events-text-devicekey-json"
             xreflabel="servicesfun_event_receiver(list_events text, devicekey json)">
      <title id="services.function.fun-event-receiver-list-events-text-devicekey-json-title">
       fun_event_receiver(list_events text, devicekey json)
      </title>
      <titleabbrev id="services.function.fun-event-receiver-list-events-text-devicekey-json-titleabbrev">
       fun_event_receiver(list_events text, devicekey json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>text[]</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
R TEXT[];
e JSON;
id BIGINT;

BEGIN

SELECT idequipment INTO id FROM equipments WHERE report_validator = devicekey;

FOR e IN SELECT * FROM json_array_elements(list_events) LOOP 


        BEGIN

INSERT INTO events.datas(
            dateevent, ideventtype, description, idequipment, source, details)
VALUES ((e-&gt;&gt;&#39;dateevent&#39;)::timestamptz, (e-&gt;&gt;&#39;ideventtype&#39;)::BIGINT, e-&gt;&gt;&#39;description&#39;::TEXT, id, (e-&gt;&gt;&#39;source&#39;)::UUID, (e-&gt;&gt;&#39;details_json&#39;)::JSONB);

R := array_append(R, (e-&gt;&gt;&#39;idQueue&#39;)::TEXT);

        EXCEPTION WHEN unique_violation THEN
            -- Do nothing, and loop to try the UPDATE again.
            R := array_append(R, (e-&gt;&gt;&#39;idQueue&#39;)::TEXT);
        END;



END LOOP;

RETURN R;
END
</programlisting>
      </para>
    </section>

<!-- Function funjs_dbstructure(request json, header json) -->
    <section id="services.function.funjs-dbstructure-request-json-header-json"
             xreflabel="servicesfunjs_dbstructure(request json, header json)">
      <title id="services.function.funjs-dbstructure-request-json-header-json-title">
       funjs_dbstructure(request json, header json)
      </title>
      <titleabbrev id="services.function.funjs-dbstructure-request-json-header-json-titleabbrev">
       funjs_dbstructure(request json, header json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
var R = [];
// Aqui el header es unicamente para obtener informacion que pueda ser necesaria para el request
if(request &amp;&amp; header){

	try{

		if(Array.isArray(request)){

			var plan = plv8.prepare( &#39;SELECT gui.funjs_db_structure($1) as return;&#39;, [&#39;TEXT&#39;] );

			request.forEach(function(item) {
				var ritem = {};
				var service = plan.execute([item.datas.tschema_tname] )[0].return;

				ritem.key = item.key;
				ritem.datas = service;
				R.push(ritem);
			});
			
			plan.free();
		}else{
			R.message = &#39;content not is array&#39;;
			R.error = 3;
		}


//R.response.push({idrequest: &#39;ASSASJBBJ767862J312B&#39;, idevent: 0});
//R.response.push({idrequest: &#39;000ASSASJBBJ767862J312B&#39;, idevent: 20});

}catch(Error){
	R.message = Error.message;
	R.error = 2;
}

}else{
	R.message = &#39;No esta definido request o header&#39;;
	R.Error = 1;
}



return R;
</programlisting>
      </para>
    </section>

<!-- Function funjs_login_comunicator(credentials json) -->
    <section id="services.function.funjs-login-comunicator-credentials-json"
             xreflabel="servicesfunjs_login_comunicator(credentials json)">
      <title id="services.function.funjs-login-comunicator-credentials-json-title">
       funjs_login_comunicator(credentials json)
      </title>
      <titleabbrev id="services.function.funjs-login-comunicator-credentials-json-titleabbrev">
       funjs_login_comunicator(credentials json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var R = {id: 0, token: &#39;&#39;, error: 0, message: &#39;&#39;};

if(credentials &amp;&amp; credentials.idcommunicator &amp;&amp; credentials.pwd &amp;&amp; credentials.ip){

/*
SELECT idcommunicator, ts, footprint_row, pwd, enabled, datetime_start, 
       datetime_end, description
  FROM services.communicators;
*/

var communicators = plv8.execute( &#39;SELECT * FROM services.communicators WHERE idcommunicator = $1 AND pwd = $2;&#39;, [credentials.idcommunicator, credentials.pwd]);

//plv8.elog(NOTICE, &quot;U = &quot;, JSON.stringify(communicators));

if(communicators.length &gt; 0){

R.id = communicators[0].idcommunicator;
plv8.execute( &#39;DELETE FROM users.tokens WHERE isuser = FALSE AND id = $1;&#39;, [R.id]);
var token = plv8.execute( &#39;INSERT INTO users.tokens(token, isuser, id, first_heartbeat, last_heartbeat) VALUES ($1, FALSE, $2, now(), now()) RETURNING token;&#39;, [plv8.find_function(&quot;funjs_md5&quot;)(JSON.stringify(communicators)+Date.now()), R.id]);
if(token.length &gt; 0){
R.token = token[0].token;
}

//plv8.elog(NOTICE, &quot;t = &quot;, JSON.stringify(token));

}else{
R.error = 2;
R.message = &#39;Usuario o clave invalida&#39;;
}

}else{
R.error = 1;
R.message = &#39;Las credenciales no estan completas&#39;;
plv8.elog(NOTICE, &quot;Error = &quot;, &#39;Sin credeneciles No valido&#39;);
}

return R;</programlisting>
      </para>
    </section>

<!-- Function funjs_login_user(params json) -->
    <section id="services.function.funjs-login-user-params-json"
             xreflabel="servicesfunjs_login_user(params json)">
      <title id="services.function.funjs-login-user-params-json-title">
       funjs_login_user(params json)
      </title>
      <titleabbrev id="services.function.funjs-login-user-params-json-titleabbrev">
       funjs_login_user(params json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var R = {return: {iduser: 0, token: &#39;&#39;}, error: 0, message: &#39;&#39;};

var Puser = &#39;&#39;;
var Ppwd = &#39;&#39;;

plv8.elog(NOTICE, &quot;1&quot;);

if(params.body){
	Puser = params.body.user||&#39;&#39;;
	Ppwd = params.body.pwd||&#39;&#39;;
}

plv8.elog(NOTICE, &quot;2&quot;);

if(Puser.length &gt; 0 &amp;&amp; Ppwd.length &gt; 0){

plv8.elog(NOTICE, &quot;3&quot;);

  var user = plv8.execute(&#39;SELECT users.user_login($1::text, $2::text, $3::inet, $4::text, $5::text)&#39;, [Puser, Ppwd, params.remoteAddress, params.headers[&#39;user-agent&#39;], &#39;&#39;]);

plv8.elog(NOTICE, &quot;4&quot;);
plv8.elog(NOTICE, &quot;U = &quot;, JSON.stringify(user));

if(user.length &gt; 0){
	
    R = user[0].user_login; 
    
}else{
	R.error = 2;
	R.message = &#39;Error desconocido&#39;;
}

}else{
	R.error = 1;
	R.message = &#39;Las credenciales no estan completas&#39;;
	plv8.elog(NOTICE, &quot;Error = &quot;, &#39;Sin credenciales - No valido&#39;);
}

return R;</programlisting>
      </para>
    </section>

<!-- Function funjs_logout_user(params json) -->
    <section id="services.function.funjs-logout-user-params-json"
             xreflabel="servicesfunjs_logout_user(params json)">
      <title id="services.function.funjs-logout-user-params-json-title">
       funjs_logout_user(params json)
      </title>
      <titleabbrev id="services.function.funjs-logout-user-params-json-titleabbrev">
       funjs_logout_user(params json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
var R = {error: 999, message: &#39;&#39;};

plv8.elog(NOTICE, &quot;1&quot;);

/*
SELECT users.user_logout(&lt;itoken uuid&gt;, &lt;iip inet&gt;, &lt;iuser_agent text&gt;, &lt;inotes text&gt;)
*/

  var user = plv8.execute(&#39;SELECT users.user_logout($1::uuid, $2::inet, $3::text, $4::text);&#39;, [params.cookies.sessionIDSystem, params.remoteAddress, params.headers[&#39;user-agent&#39;], &#39;&#39;]);

plv8.elog(NOTICE, &quot;U = &quot;, JSON.stringify(user));

if(user.length &gt; 0){
	
    R = user[0].user_logout; 
    
}else{
	R.error = 1;
	R.message = &#39;Error desconocido&#39;;
}

return R;
</programlisting>
      </para>
    </section>

<!-- Function funjs_menu_master(params json) -->
    <section id="services.function.funjs-menu-master-params-json"
             xreflabel="servicesfunjs_menu_master(params json)">
      <title id="services.function.funjs-menu-master-params-json-title">
       funjs_menu_master(params json)
      </title>
      <titleabbrev id="services.function.funjs-menu-master-params-json-titleabbrev">
       funjs_menu_master(params json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>
var R = {error: 999, message: &#39;&#39;};

  var user = plv8.execute(&#39;SELECT idmenu as id, name, url, parent, type, nameeventonclick, appname FROM gui.menus WHERE enabled = true AND show = true order by name;&#39;, []);

plv8.elog(NOTICE, &quot;U = &quot;, JSON.stringify(user));

if(user.length &gt; 0){

	R.error = 0;
	R.message = &#39;&#39;;
    R.return = user; 
    
}else{
	R.error = 1;
	R.message = &#39;No hay datos que mostrar&#39;;
}

plv8.elog(NOTICE, &quot;U = &quot;, JSON.stringify(R));

return R;

</programlisting>
      </para>
    </section>

<!-- Function funjs_point(service_request json) -->
    <section id="services.function.funjs-point-service-request-json"
             xreflabel="servicesfunjs_point(service_request json)">
      <title id="services.function.funjs-point-service-request-json-title">
       funjs_point(service_request json)
      </title>
      <titleabbrev id="services.function.funjs-point-service-request-json-titleabbrev">
       funjs_point(service_request json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var R = []; // Esta es una matriz porque es posible que se reciba una serie de requerimientos en la misma solicitud
var r = {service: &#39;service_point&#39;}; // Esta es una respuesta que devolvera esta funcion, en la mayoria de los casos esta variable no deberia usarse y deberia ser parte de la respuesta del servicio final
	if(service_request.body &amp;&amp; service_request.cookies){
plv8.elog(NOTICE, &quot;Revisa body y cokoies&quot;);
		if(service_request.service &amp;&amp; service_request.service.length &gt; 0){
plv8.elog(NOTICE, &quot;servicions&quot;);
r.service = service_request.service;
var token = &#39;&#39;;
if(service_request.cookies &amp;&amp; service_request.cookies.sessionIDSystem){
token = service_request.cookies;
}
plv8.elog(NOTICE, &quot;Obtuvo Tokken&quot;);
			try{

// Revisa que la funcion exista
var fun_service = plv8.find_function(&#39;services.funjs_&#39;+service_request.service);
// Revisa que el servicio este habilitado para ser consumido				
var service = plv8.execute( &#39;SELECT services.fun_check_service($1::TEXT, $2::TEXT);&#39;, [ service_request.service, token ] )[0].fun_check_service;

plv8.elog(NOTICE, &quot;Termina de hacer la consulta fun_check_service&quot;);
switch(service.error){
	case 0:
R.push(fun_service(service_request));	
/*
	service_request.request.forEach(function(req){
		plv8.elog(NOTICE, &quot;req = &quot;, JSON.stringify(req));
		
	});
	*/

	break;
	default:
	r.message = service.message;
	r.error = service.error+4;
	R.push(r);
	break;
}

}catch(e){
	r.message = e.message;
	r.error = 2;
    R.push(r);
}

}else{
plv8.elog(NOTICE, &quot;Did not specify the service&quot;);
	r.message = &#39;Did not specify the service&#39;;
	r.error = 1;
    R.push(r);
}


}else{
	r.message = &#39;Did not specify the body or cookies&#39;;
	r.error = 3;
    R.push(r);
}


return R;</programlisting>
      </para>
    </section>

<!-- Function funjs_test(request json, header json) -->
    <section id="services.function.funjs-test-request-json-header-json"
             xreflabel="servicesfunjs_test(request json, header json)">
      <title id="services.function.funjs-test-request-json-header-json-title">
       funjs_test(request json, header json)
      </title>
      <titleabbrev id="services.function.funjs-test-request-json-header-json-titleabbrev">
       funjs_test(request json, header json)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLV8</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>var R = {response: []};

if(request &amp;&amp; header){

try{

R.response.push({idrequest: &#39;ASSASJBBJ767862J312B&#39;, idevent: 0});
R.response.push({idrequest: &#39;000ASSASJBBJ767862J312B&#39;, idevent: 20});

}catch(Error){
R.message = Error.message;
R.error = 2;
}

}else{
R.message = &#39;No esta definido request o header&#39;;
R.Error = 1;
}













/*
 plv8.elog(NOTICE, &quot;servicio = &quot;, service);
plv8.elog(NOTICE, &quot;request = &quot;, request.chao);

plan = plv8.prepare(&quot;SELECT md5($1) as x;&quot;);
  var res = plan.execute([JSON.stringify(request)]);

  plv8.elog(NOTICE, &quot;md5 = &quot;, JSON.stringify(res));

var funcmd5 = plv8.find_function(&quot;fun_md5&quot;);

plv8.elog(NOTICE, &quot;requestmd5 = &quot;, funcmd5(JSON.stringify(request)));
*/





return R;

</programlisting>
      </para>
    </section>

  </chapter>

  <chapter id="users.schema"
           xreflabel="users">
    <title>Schema users</title>
    <para></para>


      <section id="users.table.devices"
               xreflabel="users.devices">
        <title id="users.table.devices-title">
         Table:
         
         <structname>devices</structname>
        </title>
 

        <para>
          Lista de dispositivos que tiene acceso a consumir servicios
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>devices</structname>
            </title>


            <varlistentry>
              <term><structfield>iduser</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>username</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE#1</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>




                      <literal>UNIQUE#1</literal>








                <literal>NOT NULL</literal>








                <literal>REFERENCES</literal> <xref linkend="contacts.table.contacts"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>user_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>user_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pwd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>user_role</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>divisions</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>accounts</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>locked_date</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>failed_access_attempts</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>email_notification</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>xmpp_notification</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_attention_group</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="users.table.login"
               xreflabel="users.login">
        <title id="users.table.login-title">
         Table:
         
         <structname>login</structname>
        </title>
 

        <para>
          Almacena el historial de los accesos al sistema.
        </para>


        <para>
          <variablelist>
            <title>
              Structure of <structname>login</structname>
            </title>


            <varlistentry>
              <term><structfield>idlogin</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>serial</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notes</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>motive</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

              <para>
                0 - Login normal
1 - Logout normal
2 - Logout por inactividad
3 - Logout forzado por el sistema
4 - Logout forzado por usuario
              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="users.table.tokens"
               xreflabel="users.tokens">
        <title id="users.table.tokens-title">
         Table:
         
         <structname>tokens</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>tokens</structname>
            </title>


            <varlistentry>
              <term><structfield>token</structfield></term>
              <listitem><para>
                <type>uuid</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>last_heartbeat</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idlogin</structfield></term>
              <listitem><para>
                <type>bigint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>token_agent</structfield></term>
              <listitem><para>
                <type>uuid</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="users.table.user-login"
               xreflabel="users.user_login">
        <title id="users.table.user-login-title">
         Table:
         
         <structname>user_login</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>user_login</structname>
            </title>


            <varlistentry>
              <term><structfield>idlogin</structfield></term>
              <listitem><para>
                <type>bigint</type>


                <literal>PRIMARY KEY</literal>









                <literal>DEFAULT nextval(&apos;users.login_idlogin_seq&apos;::regclass)</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_lm_</structfield></term>
              <listitem><para>
                <type>last_modification</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>_foot_print_</structfield></term>
              <listitem><para>
                <type>foot_print</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>id</structfield></term>
              <listitem><para>
                <type>integer</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT nextval(&apos;users.login_id_seq&apos;::regclass)</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>datetime</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>notes</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>motive</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

              <para>
                0 - Login normal
1 - Logout normal
2 - Logout por inactividad
3 - Logout forzado por el sistema
4 - Logout forzado por usuario
              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ip</structfield></term>
              <listitem><para>
                <type>inet</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>user_agent</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>

      <section id="users.table.users"
               xreflabel="users.users">
        <title id="users.table.users-title">
         Table:
         
         <structname>users</structname>
        </title>
 


        <para>
          <variablelist>
            <title>
              Structure of <structname>users</structname>
            </title>


            <varlistentry>
              <term><structfield>iduser</structfield></term>
              <listitem><para>
                <type>bigserial</type>


                <literal>PRIMARY KEY</literal>













              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>username</structfield></term>
              <listitem><para>
                <type>text</type>




                      <literal>UNIQUE</literal>




                <literal>NOT NULL</literal>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>ts</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>footprint_row</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>idcontact</structfield></term>
              <listitem><para>
                <type>bigint</type>







                <literal>NOT NULL</literal>






                <literal>REFERENCES</literal> <xref linkend="contacts.table.contacts"/>


              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>enabled</structfield></term>
              <listitem><para>
                <type>boolean</type>





                <literal>DEFAULT true</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>user_start</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>



                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>user_end</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>



                <literal>NOT NULL</literal>





              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>pwd</structfield></term>
              <listitem><para>
                <type>text</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>user_role</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>divisions</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>accounts</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>locked_date</structfield></term>
              <listitem><para>
                <type>timestamp with time zone</type>





                <literal>DEFAULT now()</literal>



              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>failed_access_attempts</structfield></term>
              <listitem><para>
                <type>smallint</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>email_notification</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>xmpp_notification</structfield></term>
              <listitem><para>
                <type>bigint[]</type>







              </para>

            </listitem>
          </varlistentry>

            <varlistentry>
              <term><structfield>admin_attention_group</structfield></term>
              <listitem><para>
                <type>integer[]</type>







              </para>

            </listitem>
          </varlistentry>

        </variablelist>










      </para>
    </section>



<!-- Function user_login(inotes text, iuser_agent text, iip inet, ipwd text, iuser text) -->
    <section id="users.function.user-login-inotes-text-iuser-agent-text-iip-inet-ipwd-text-iuser-text"
             xreflabel="usersuser_login(inotes text, iuser_agent text, iip inet, ipwd text, iuser text)">
      <title id="users.function.user-login-inotes-text-iuser-agent-text-iip-inet-ipwd-text-iuser-text-title">
       user_login(inotes text, iuser_agent text, iip inet, ipwd text, iuser text)
      </title>
      <titleabbrev id="users.function.user-login-inotes-text-iuser-agent-text-iip-inet-ipwd-text-iuser-text-titleabbrev">
       user_login(inotes text, iuser_agent text, iip inet, ipwd text, iuser text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
_iduser BIGINT;
_idlogin BIGINT;
_token_agent UUID;
_token UUID;
R JSON;
BEGIN

SELECT iduser INTO _iduser FROM users.users WHERE username = iuser AND pwd = md5(ipwd) AND enabled = TRUE;

IF _iduser IS NOT NULL OR _iduser &gt; 0  THEN
	--R := json_build_object(&#39;iduser&#39;, _iduser,&#39;bar&#39;,2);
    _token_agent := md5(iip::TEXT||iuser_agent)::UUID;
    
-- SELECT l.idlogin, l.id, l.motive, t.token, t.token_agent FROM users.login l, users.tokens t WHERE l.idlogin = t.idlogin;    

IF EXISTS(SELECT COUNT(*) FROM users.login l, users.tokens t WHERE l.idlogin = t.idlogin AND l.id = _iduser AND motive = 0) THEN
-- Elimina el token y hace un logout de ese usuario
	DELETE FROM users.tokens WHERE users.tokens.idlogin = (SELECT l.idlogin FROM users.login l, users.tokens t WHERE l.idlogin = t.idlogin AND l.id = _iduser AND motive = 0 LIMIT 1);
-- Revisar cual mismo seria el motivo
    INSERT INTO users.user_login (id, motive, ip, user_agent, notes) VALUES (_iduser, 7, iip, iuser_agent, &#39;Logout by relogin&#39;);
END IF;

    INSERT INTO users.user_login (id, motive, ip, user_agent) VALUES (_iduser, 0, iip, iuser_agent) RETURNING idlogin INTO _idlogin;

IF _idlogin IS NOT NULL OR _idlogin &gt; 0  THEN
    _token := md5(_idlogin::TEXT||iuser_agent||now()::TEXT)::UUID;
	INSERT INTO users.tokens(token, idlogin, token_agent, last_heartbeat) VALUES (_token, _idlogin, _token_agent, now());    
	R := json_build_object(&#39;return&#39;, json_build_object(&#39;iduser&#39;,_iduser,&#39;token&#39;, _token), &#39;error&#39;, 0, &#39;message&#39;, &#39;&#39;);
    
    --var R = {return: {iduser: 0, token: &#39;&#39;}, error: 0, message: &#39;&#39;};
ELSE
	R := json_build_object(&#39;error&#39;,2,&#39;message&#39;,&#39;No se pudo insertar en user_login&#39;);
END IF;
    
ELSE
	R := json_build_object(&#39;error&#39;,1,&#39;message&#39;,&#39;Invalid username or password&#39;);
END IF;

RETURN R;
END;
</programlisting>
      </para>
    </section>

<!-- Function user_logout(inotes uuid, iuser_agent inet, iip text, itoken text) -->
    <section id="users.function.user-logout-inotes-uuid-iuser-agent-inet-iip-text-itoken-text"
             xreflabel="usersuser_logout(inotes uuid, iuser_agent inet, iip text, itoken text)">
      <title id="users.function.user-logout-inotes-uuid-iuser-agent-inet-iip-text-itoken-text-title">
       user_logout(inotes uuid, iuser_agent inet, iip text, itoken text)
      </title>
      <titleabbrev id="users.function.user-logout-inotes-uuid-iuser-agent-inet-iip-text-itoken-text-titleabbrev">
       user_logout(inotes uuid, iuser_agent inet, iip text, itoken text)
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>json</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>DECLARE
_token_agent UUID;
_idlogin BIGINT;
_iduser BIGINT;
R JSON;
BEGIN
  _token_agent := md5(iip::TEXT||iuser_agent)::UUID;
  SELECT l.idlogin, l.id INTO _idlogin, _iduser FROM users.login l, users.tokens t WHERE l.idlogin = t.idlogin AND t.token = itoken AND token_agent = _token_agent LIMIT 1;
DELETE FROM users.tokens WHERE users.tokens.idlogin = _idlogin;
    INSERT INTO users.user_login (id, motive, ip, user_agent, notes) VALUES (_iduser, 1, iip, iuser_agent, inotes);
R := json_build_object(&#39;return&#39;, true, &#39;error&#39;, 0, &#39;message&#39;, &#39;&#39;);
RETURN R;
END;

</programlisting>
      </para>
    </section>

<!-- Function user_on_insert_update() -->
    <section id="users.function.user-on-insert-update"
             xreflabel="usersuser_on_insert_update()">
      <title id="users.function.user-on-insert-update-title">
       user_on_insert_update()
      </title>
      <titleabbrev id="users.function.user-on-insert-update-titleabbrev">
       user_on_insert_update()
      </titleabbrev>

      <para>
       <segmentedlist>
        <title>Function Properties</title>
        <?dbhtml list-presentation="list"?>
        <segtitle>Language</segtitle>
        <segtitle>Return Type</segtitle>
        <seglistitem>
         <seg>PLPGSQL</seg>
         <seg>trigger</seg>
        </seglistitem>
       </segmentedlist>
 
       
        <programlisting>BEGIN


--  Creamos un username si no es proporcionado
IF NEW.username IS NULL OR LENGTH(NEW.username) &lt; 1 THEN
SELECT identification INTO NEW.username FROM contacts.contacts WHERE idcontact = NEW.idcontact;
END IF;

-- creamos una clave igual al md5 del user_name si no es proporcionada.
IF NEW.pwd IS NULL OR LENGTH(NEW.pwd) &lt; 1 THEN
 NEW.pwd := md5(NEW.username::TEXT); 
END IF;

/*
-- Clave como md5
IF TG_OP = &#39;UPDATE&#39; THEN
NEW.admin_pwd := md5(NEW.admin_pwd::TEXT);
END IF;
*/

-- setea end_date = a start_date si la fecha end_date es menor que start_date
IF NEW.user_end &lt; NEW.user_start OR NEW.user_end IS NULL THEN  
NEW.user_end := NEW.user_start + interval &#39;5 year&#39;;
END IF;  

RETURN NEW;
END;
</programlisting>
      </para>
    </section>

  </chapter>

</book>

